<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Lightflow Admin Ω.11.1 — Plus</title>
<meta name="theme-color" content="#070c1a" />
<style>
:root{--bg:#070c1a;--panel:#0b1020;--soft:#10182d;--fg:#e8edf7;--muted:#9fa8c0;--accent:#d4b97a;--ok:#74e0a1;--bad:#ff6b6b;--border:#1e2744;--r:14px}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,system-ui,"Apple SD Gothic Neo","Noto Sans KR",sans-serif}
.header{position:sticky;top:0;z-index:100;background:linear-gradient(180deg,#0a0f1f,transparent);padding:12px 14px 10px;border-bottom:1px solid var(--border)}
h1{margin:0;color:var(--accent);font-weight:800;font-size:22px}
.sub{font-size:13px;color:var(--muted);margin-top:4px}
.admin-nav{position:sticky;top:56px;z-index:90;background:rgba(10,16,34,.92);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
.admin-nav .bar{max-width:980px;margin:0 auto;display:flex;gap:8px;overflow-x:auto;padding:8px 12px}
.admin-nav a{flex:0 0 auto;text-decoration:none;font-weight:700;font-size:14px;padding:8px 12px;border-radius:999px;background:#0d142b;color:#cfe0ff;border:1px solid var(--border)}
.admin-nav a.active{background:var(--accent);color:#000}
.container{max-width:980px;margin:0 auto;padding:12px 12px 120px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--r);padding:14px;margin:12px 0}
.card h3{margin:0 0 12px;color:var(--accent)}
input,textarea,select,button{width:100%;padding:10px;font-size:15px;border-radius:10px;border:1px solid var(--border);background:var(--soft);color:var(--fg)}
button{border:none;font-weight:800;cursor:pointer}
.btn{background:var(--accent);color:#07101f}
.btn-ghost{background:#1b2748;color:var(--fg)}
.btn-ok{background:var(--ok);color:#06251a}
.btn-bad{background:var(--bad);color:#200}
.btn-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#0b1223;border:1px solid var(--border);padding:10px 14px;border-radius:10px;color:var(--fg);opacity:0;transition:.2s;pointer-events:none;z-index:999}
.toast.show{opacity:1}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
</style>
</head>
<body>
<div class="header">
  <h1>✨ Lightflow Admin Ω.11.1 — Plus</h1>
  <div class="sub">등작 燈酌 DUNGZAK CESTLAVIE × Lumera · Quick DCAR & Pages Touch</div>
</div>

<nav class="admin-nav">
  <div class="bar">
    <a href="/admin/admin.html#home" data-k="home">Home</a>
    <a href="/admin/admin.html#artworks" data-k="artworks">Artworks</a>
    <a href="/admin/admin.html#dcar" data-k="dcar">DCAR</a>
    <a href="/admin/batch.html" data-k="upload">Upload</a>
    <a href="/admin/admin-plus.html#tools" data-k="settings">Settings</a>
  </div>
</nav>

<div class="container">

  <section class="card" id="quick">
    <h3>1️⃣ DCAR 빠른 붙여넣기 저장</h3>
    <div class="grid2">
      <div>
        <label>Report ID</label>
        <select id="qid"></select>
      </div>
      <div>
        <label>자동 저장</label>
        <select id="qauto"><option value="on" selected>ON (1.5s)</option><option value="off">OFF</option></select>
      </div>
    </div>
    <textarea id="qtext" placeholder="여기에 DCAR 본문(한·영 무제한)을 붙여넣으세요."></textarea>
    <div class="btn-row">
      <button class="btn" onclick="saveQuick()">📝 붙여넣기 저장</button>
      <button class="btn-ghost" onclick="pagesTouch()">🚀 Pages 캐시 무효화</button>
    </div>
    <div id="qprev" style="margin-top:8px;border:1px solid var(--border);padding:8px;border-radius:10px;font-size:14px"></div>
  </section>

  <section class="card" id="tools">
    <h3>2️⃣ 도구</h3>
    <div class="btn-row">
      <button class="btn-ghost" onclick="window.location='/admin/trigger.html'">Trigger 열기</button>
      <button class="btn-bad" onclick="localStorage.removeItem(KEY);location.reload()">localStorage 초기화</button>
    </div>
  </section>
</div>

<div id="toast" class="toast"></div>

<script>
const $=q=>document.querySelector(q), $$=q=>document.querySelectorAll(q);
const toast=(m,e=false)=>{const t=$("#toast");t.textContent=m;t.style.borderColor=e?"#ff6b6b":"#22304f";t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1800);}
const KEY="lf_admin_cfg_v101";
const cfg=k=>JSON.parse(localStorage.getItem(KEY)||"{}")[k]||"";
function md2html(md){return md.replace(/</g,"&lt;").replace(/>/g,"&gt;").split(/\n{2,}/).map(p=>`<p>${p.replace(/\n/g,"<br>")}</p>`).join("")}

/* GH */
async function gh(m,p,b=null,j=true){const t=cfg("token"); if(!t) throw Error("토큰 없음"); const r=await fetch(`https://api.github.com/${p}`,{method:m,headers:{Accept:"application/vnd.github+json",Authorization:`token ${t}`},body:b?(j?JSON.stringify(b):b):null}); if(!r.ok) throw Error(await r.text()); return r.json();}
const b64=s=>btoa(unescape(encodeURIComponent(s)));
async function stat(p){try{const o=cfg("owner"),r=cfg("repo"),b=cfg("branch")||"main";const j=await gh("GET",`repos/${o}/${r}/contents/${encodeURIComponent(p)}?ref=${b}`);return {sha:j.sha,txt:j.content?atob(j.content.replace(/\n/g,"")):""}}catch{return{}}}
async function put(p,txt,msg){const o=cfg("owner"),r=cfg("repo"),b=cfg("branch")||"main";const old=await stat(p);const body={message:msg,content:b64(txt),branch:b};if(old.sha) body.sha=old.sha;return gh("PUT",`repos/${o}/${r}/contents/${encodeURIComponent(p)}`,body);}

/* Quick */
const IDS=["dcar01","dcar02","dcar03","dcar04","dcar05","dcar06","dcar07","dcar08"]; let reports={};
async function load(){ $("#qid").innerHTML=IDS.map(i=>`<option>${i}</option>`).join(""); const f=await stat("data/reports.json"); if(f.txt) reports=JSON.parse(f.txt); $("#qtext").addEventListener("input",()=>{ $("#qprev").innerHTML=md2html($("#qtext").value); if($("#qauto").value==="on"){ clearTimeout(window.__qs); window.__qs=setTimeout(saveQuick,1500);} }); }
async function saveQuick(){ try{ const id=$("#qid").value,txt=$("#qtext").value; if(!txt.trim()) return toast("내용 없음",true); await put(`reports/${id}.md`,txt,`save ${id}.md`); reports[id]={id,text:txt,updated:new Date().toISOString()}; await put("data/reports.json",JSON.stringify(reports,null,2),"update reports"); toast("저장 완료"); }catch(e){toast(e.message,true);} }
async function pagesTouch(){ try{const t=new Date().toISOString(); await put("data/.touch","touch "+t,`touch ${t}`); toast("Pages 캐시 무효화 OK");}catch(e){toast(e.message,true);} }

window.addEventListener("load",load);
</script>
</body>
</html>