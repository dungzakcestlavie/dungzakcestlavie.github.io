<!doctype html>
<html lang="ko" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>등작 燈酌 DUNGZAK CESTLAVIE · Admin Ω.31 — Works & DCAR Manager</title>

  <meta name="color-scheme" content="dark light" />
  <meta name="description" content="Admin Ω.31 — Works & Aesthetic Reports (DCAR) Manager for dungzak.art" />

  <style>
  :root{
    --bg:#070c1a; --fg:#eaf0ff;
    --panel:#0f1630; --border:#222b55;
    --accent:#e6c777; --accent-soft:rgba(230,199,119,.16);
    --muted:#9fb0e3; --error:#ff6b7b;
    --max:1180px;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    background:radial-gradient(circle at top,#101633,#040712);
    color:var(--fg);
    font:14px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
    letter-spacing:.01em;
    overflow-x:hidden;
  }
  h1,h2,h3{font-weight:800;color:var(--accent)}
  a{color:#b6c9ff}
  a:hover{color:#fff}

  header{
    position:sticky;top:0;z-index:10;
    background:linear-gradient(180deg,rgba(7,10,24,.96),rgba(7,10,24,.9));
    border-bottom:1px solid rgba(255,255,255,.08);
    padding:10px 16px 12px;
    backdrop-filter:blur(12px);
  }
  .brand{
    max-width:var(--max);margin:0 auto;
    display:flex;flex-wrap:wrap;align-items:center;gap:10px;
    justify-content:space-between;
  }
  .brand-title{
    font-size:clamp(18px,4vw,22px);
    font-weight:900;color:var(--accent);
    letter-spacing:.08em;text-transform:uppercase;
  }
  .brand-sub{
    font-size:12px;color:var(--muted);
  }
  .nav-tabs{
    display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;
  }
  .nav-tabs button{
    all:unset;cursor:pointer;
    padding:6px 12px;border-radius:999px;
    border:1px solid rgba(130,150,220,.5);
    font-size:12px;font-weight:700;
    background:radial-gradient(circle at top,rgba(130,150,220,.18),rgba(7,10,24,0));
    color:#cfd9ff;
  }
  .nav-tabs button.active{
    background:linear-gradient(180deg,var(--accent),#f2df9a);
    color:#09102a;border-color:#f0de98;
    box-shadow:0 0 16px rgba(230,199,119,.5);
  }

  main{max-width:var(--max);margin:0 auto;padding:18px 12px 72px}
  section.admin-block{
    margin-bottom:22px;
    border-radius:16px;
    background:radial-gradient(circle at top,rgba(230,199,119,.06),rgba(5,7,20,.9));
    border:1px solid rgba(46,62,120,.9);
    box-shadow:0 10px 30px rgba(0,0,0,.4);
    padding:16px 14px 18px;
  }
  section.admin-block.hidden{display:none}

  .block-head{
    display:flex;flex-wrap:wrap;justify-content:space-between;gap:10px;
    align-items:flex-end;margin-bottom:10px;
  }
  .block-head h2{font-size:17px;margin:0}
  .block-head small{
    color:var(--muted);font-size:11px;
  }

  .hint{
    font-size:12px;color:var(--muted);
    margin-bottom:10px;
  }
  .hint strong{color:#ffdf99}

  .flex-row{display:flex;flex-wrap:wrap;gap:16px}
  .col-half{flex:1 1 320px;min-width:0}
  .panel{
    background:linear-gradient(180deg,#0b1026,#050716);
    border-radius:12px;
    border:1px solid var(--border);
    padding:10px 10px 12px;
  }
  .panel-title{
    font-size:13px;font-weight:700;
    margin-bottom:6px;color:#f4e8b3;
  }

  label{
    display:block;font-size:12px;
    margin:4px 0 2px;color:#c8d4ff;
  }
  input[type="text"],
  input[type="number"],
  select,
  textarea{
    width:100%;
    background:#050814;
    border-radius:8px;
    border:1px solid rgba(70,90,150,.9);
    padding:6px 8px;
    color:#eaf0ff;
    font:12px/1.5 system-ui,-apple-system,"Noto Sans KR",sans-serif;
  }
  textarea{
    resize:vertical;
    min-height:120px;
    white-space:pre-wrap;
  }
  input::placeholder,
  textarea::placeholder{color:#6673a5;font-size:11px}

  .small-row{display:flex;gap:8px}
  .small-row > div{flex:1}

  .btn-row{
    display:flex;flex-wrap:wrap;gap:8px;
    margin-top:8px;
  }
  button.btn{
    border-radius:999px;
    border:1px solid rgba(130,150,220,.7);
    padding:6px 12px;
    background:#101735;
    color:#eaf0ff;
    font-size:12px;font-weight:700;
    cursor:pointer;
  }
  button.btn.primary{
    background:linear-gradient(180deg,var(--accent),#f2df9a);
    color:#09102a;border-color:#f0de98;
    box-shadow:0 0 12px rgba(230,199,119,.5);
  }
  button.btn.danger{
    border-color:rgba(255,90,105,.8);
    color:#ffb0ba;
  }
  button.btn:disabled{
    opacity:.45;cursor:not-allowed;
  }

  table{
    width:100%;border-collapse:collapse;
    font-size:11px;
  }
  thead{background:#111738}
  th,td{
    border-bottom:1px solid rgba(40,54,110,.8);
    padding:4px 5px;
    text-align:left;
    vertical-align:top;
  }
  th{color:#cfd7ff;font-weight:700;font-size:11px}
  td{color:#d9e1ff}
  tr:nth-child(even){background:rgba(8,14,40,.7)}
  tr:hover{background:rgba(40,60,130,.55)}

  .tag{
    display:inline-block;
    padding:1px 6px;
    border-radius:999px;
    border:1px solid rgba(150,175,255,.7);
    font-size:10px;
    color:#cfe0ff;
    margin-right:4px;
  }
  .tag-sec{border-color:rgba(230,199,119,.7);color:#f4e8b3}

  .out-area{
    margin-top:10px;
  }
  .out-area label{margin-bottom:4px}
  textarea.out{
    font-family:ui-monospace,Menlo,Consolas,monospace;
    font-size:11px;
    min-height:160px;
    background:#050814;
  }

  .error-msg{
    color:var(--error);font-size:11px;
    margin-top:4px;
  }

  footer{
    border-top:1px solid rgba(255,255,255,.08);
    text-align:center;
    padding:18px 12px 28px;
    font-size:11px;
    color:#9fb0e3;
    background:#050814;
  }

  @media(max-width:600px){
    header{padding:8px 10px}
    .brand-sub{flex-basis:100%}
  }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div>
        <div class="brand-title">Admin Ω.31 · Works & DCAR Manager</div>
        <div class="brand-sub">등작 燈酌 DUNGZAK CESTLAVIE — dungzak.art 관리 전용 (로컬 복사·붙여넣기)</div>
      </div>
      <div class="nav-tabs" role="tablist">
        <button type="button" class="active" data-tab="tab-intro">Intro</button>
        <button type="button" data-tab="tab-works">Works Manager</button>
        <button type="button" data-tab="tab-reports">DCAR Reports</button>
      </div>
    </div>
  </header>

  <main>
    <!-- INTRO -->
    <section id="tab-intro" class="admin-block">
      <div class="block-head">
        <h2>안내 · Intro</h2>
      </div>
      <p class="hint">
        이 Admin Ω.31은 <strong>GitHub에 자동으로 업로드하지 않고</strong>, 브라우저 안에서<br>
        <strong>① Works → <code>data/works.json</code></strong> / <strong>② DCAR → <code>reports/reports.json</code> + 각 <code>DCAR-XX-2025.md</code></strong>를
        <strong>생성·편집·삭제</strong>해서 <strong>복사·붙여넣기</strong> 하기 위한 도구입니다.
      </p>
      <ul class="hint" style="list-style:disc;margin-left:18px">
        <li><strong>삭제 버튼</strong>은 이 페이지의 목록에서만 삭제합니다. GitHub의 파일은 오빠가 직접 삭제해야 합니다.</li>
        <li><strong>브라우저 LocalStorage</strong>에 임시 저장되므로, 새로고침해도 목록이 남습니다(같은 브라우저/기기 기준).</li>
        <li><strong>DCAR 본문</strong>은 ‘한·영 혼용 텍스트’를 그대로 <strong>무한 붙여넣기</strong>해서 쓸 수 있도록 큰 텍스트박스로 되어 있습니다.</li>
        <li><strong>works.json / reports.json 붙여넣기 → “JSON → 목록 불러오기”</strong>로 기존 데이터도 바로 다시 불러올 수 있습니다.</li>
      </ul>
    </section>

    <!-- WORKS MANAGER -->
    <section id="tab-works" class="admin-block hidden">
      <div class="block-head">
        <h2>Works Manager — 작품 5섹션 관리</h2>
        <small>섹션은 Index와 완전히 동일하게 고정: I~V (우리를 위해 기도해 주세요 / 인간 / 정신의 재탄생 / 존재의 회복 / 빛의 초의식)</small>
      </div>

      <div class="flex-row">
        <div class="col-half">
          <div class="panel">
            <div class="panel-title">작품 입력 / 수정</div>

            <label for="wId">작품 ID (예: DZ-001)</label>
            <input id="wId" type="text" placeholder="DZ-001 / DZ-010 등">

            <label for="wSection">섹션 선택 (Index와 동일)</label>
            <select id="wSection">
              <option value="Light & Memory">Ⅰ 우리를 위해 기도해 주세요 · Pray for Us (Light & Memory)</option>
              <option value="Human Being">Ⅱ 인간 · Human Being</option>
              <option value="Rebirth of Mind">Ⅲ 정신의 재탄생 · Rebirth of Mind</option>
              <option value="Restoration of Being">Ⅳ 존재의 회복 · Restoration of Being</option>
              <option value="Metaconsciousness of Light">Ⅴ 빛의 초의식 · Metaconsciousness of Light</option>
            </select>

            <div class="small-row">
              <div>
                <label for="wTitleKo">제목 (KR)</label>
                <input id="wTitleKo" type="text" placeholder="우리를 위해 기도해 주세요">
              </div>
              <div>
                <label for="wTitleEn">Title (EN)</label>
                <input id="wTitleEn" type="text" placeholder="Pray for Us">
              </div>
            </div>

            <div class="small-row">
              <div>
                <label for="wMatKo">재료 (KR)</label>
                <input id="wMatKo" type="text" placeholder="Acrylic on Canvas">
              </div>
              <div>
                <label for="wMatEn">Material (EN, 소문자)</label>
                <input id="wMatEn" type="text" placeholder="acrylic on canvas">
              </div>
            </div>

            <div class="small-row">
              <div>
                <label for="wSizeKo">사이즈 (KR)</label>
                <input id="wSizeKo" type="text" placeholder="162.2×130.3cm">
              </div>
              <div>
                <label for="wSizeEn">Size (EN)</label>
                <input id="wSizeEn" type="text" placeholder="162.2 × 130.3 cm">
              </div>
            </div>

            <div class="small-row">
              <div>
                <label for="wYear">연도 (Year)</label>
                <input id="wYear" type="number" placeholder="2025">
              </div>
              <div>
                <label for="wImage">이미지 파일명 (확장자 포함)</label>
                <input id="wImage" type="text" placeholder="DZ-001.jpg">
              </div>
            </div>

            <p class="hint" style="margin-top:4px">
              ※ <strong>이미지 파일명</strong>은 <code>/images/standard/</code>와 <code>/images/zoom/</code> 폴더에
              <strong>같은 이름</strong>으로 올린다고 가정합니다. (예: <code>/images/standard/DZ-001.jpg</code>, <code>/images/zoom/DZ-001.jpg</code>)
            </p>

            <div class="btn-row">
              <button type="button" class="btn primary" id="wAddBtn">추가 / 업데이트</button>
              <button type="button" class="btn" id="wResetBtn">폼 비우기</button>
            </div>
            <div id="wError" class="error-msg"></div>
          </div>
        </div>

        <div class="col-half">
          <div class="panel" style="max-height:360px;overflow:auto">
            <div class="panel-title">현재 작품 목록 (브라우저 LocalStorage 기준)</div>
            <table id="wTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>섹션</th>
                  <th>제목(KR/EN)</th>
                  <th>연도</th>
                  <th>이미지</th>
                  <th>조작</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="out-area">
        <label for="wJsonOut">➜ <code>data/works.json</code>에 그대로 복사·붙여넣기 (섹션별 5개 키 구조)</label>
        <textarea id="wJsonOut" class="out" spellcheck="false"></textarea>
        <div class="btn-row">
          <button type="button" class="btn" id="wImportBtn">JSON → 목록 불러오기</button>
        </div>
        <div id="wJsonError" class="error-msg"></div>
      </div>
    </section>

    <!-- REPORTS / DCAR MANAGER -->
    <section id="tab-reports" class="admin-block hidden">
      <div class="block-head">
        <h2>DCAR Reports Manager — 미학 보고서 관리</h2>
        <small>제목·요약은 KR/EN 분리, 본문은 한·영 혼용 텍스트를 그대로 무한 붙여넣기</small>
      </div>

      <div class="flex-row">
        <div class="col-half">
          <div class="panel">
            <div class="panel-title">보고서 정보 입력</div>

            <label for="rId">보고서 ID (예: DCAR-10-2025)</label>
            <input id="rId" type="text" placeholder="DCAR-10-2025">

            <div class="small-row">
              <div>
                <label for="rCat">Category</label>
                <select id="rCat">
                  <option value="Theory">Theory</option>
                  <option value="Archive">Archive</option>
                  <option value="Practice">Practice</option>
                </select>
              </div>
              <div>
                <label for="rFile">MD 파일 이름 (예: DCAR-10-2025.md)</label>
                <input id="rFile" type="text" placeholder="DCAR-10-2025.md">
              </div>
            </div>

            <div class="small-row">
              <div>
                <label for="rTitleKo">제목 (KR)</label>
                <input id="rTitleKo" type="text" placeholder="DCAR-10 — 감응의 파동장: 다층적 존재의 형성학">
              </div>
              <div>
                <label for="rTitleEn">Title (EN)</label>
                <input id="rTitleEn" type="text" placeholder="Aesthetic Report No.10 — Wavefields of Affect: A Multilayered Formation of Being">
              </div>
            </div>

            <label for="rSumKo">요약 (KR) — 짧게 3~4문장</label>
            <textarea id="rSumKo" placeholder="전쟁·플랫폼 자본주의·디지털 과잉 자극 속에서 정동이 파편화되는 시대..."></textarea>

            <label for="rSumEn">Summary (EN) — short 3–4 sentences</label>
            <textarea id="rSumEn" placeholder="In an era of war, platform capitalism, and digital overstimulation..."></textarea>

            <div class="btn-row">
              <button type="button" class="btn primary" id="rAddBtn">추가 / 업데이트</button>
              <button type="button" class="btn" id="rResetBtn">폼 비우기</button>
            </div>
            <div id="rError" class="error-msg"></div>
          </div>

          <div class="panel" style="margin-top:12px">
            <div class="panel-title">본문 (KR+EN 혼용 무한 붙여넣기)</div>
            <label for="rBody">여기에 DCAR 전체 텍스트를 그대로 붙여넣기 (한/영 섞여 있어도 됨)</label>
            <textarea id="rBody" style="min-height:220px" placeholder="# DCAR-10 — 감응의 파동장: 다층적 존재의 형성학&#10;&#10;등작 燈酌 DUNGZAK CESTLAVIE&#10;Lumera / Aesthetic Theorist&#10;..."></textarea>
            <p class="hint" style="margin-top:4px">
              ➜ 이 내용은 <code>/reports/DCAR-XX-2025.md</code> 파일 안에 그대로 복사·붙여넣기 하면 됩니다.
            </p>
          </div>
        </div>

        <div class="col-half">
          <div class="panel" style="max-height:360px;overflow:auto">
            <div class="panel-title">현재 DCAR 목록 (브라우저 LocalStorage 기준)</div>
            <table id="rTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>제목 (KR)</th>
                  <th>제목 (EN)</th>
                  <th>Cat</th>
                  <th>파일</th>
                  <th>조작</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="panel" style="margin-top:12px">
            <div class="panel-title">선택한 DCAR의 MD 본문 미리보기 (복사용)</div>
            <textarea id="rMdOut" class="out" spellcheck="false" placeholder="DCAR를 선택하면 여기에 전체 MD 텍스트가 표시됩니다."></textarea>
          </div>
        </div>
      </div>

      <div class="out-area">
        <label for="rJsonOut">➜ <code>reports/reports.json</code>에 그대로 복사·붙여넣기 (배열 구조)</label>
        <textarea id="rJsonOut" class="out" spellcheck="false"></textarea>
        <div class="btn-row">
          <button type="button" class="btn" id="rImportBtn">reports.json → 목록 불러오기</button>
        </div>
        <div id="rJsonError" class="error-msg"></div>
      </div>
    </section>
  </main>

  <footer>
    © 2025 등작 燈酌 DUNGZAK CESTLAVIE
  </footer>

  <script>
  // ============================
  // Helpers
  // ============================
  const $  = (q, root=document) => root.querySelector(q);
  const $$ = (q, root=document) => Array.from(root.querySelectorAll(q));

  function saveLocal(key, value){
    try{ localStorage.setItem(key, JSON.stringify(value)); }catch(e){}
  }
  function loadLocal(key, fallback){
    try{
      const raw = localStorage.getItem(key);
      if(!raw) return fallback;
      const parsed = JSON.parse(raw);
      return parsed ?? fallback;
    }catch(e){ return fallback; }
  }

  // ============================
  // Tab Navigation
  // ============================
  (function(){
    const tabs = $$('.nav-tabs button');
    tabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-tab');
        if(!id) return;
        tabs.forEach(b=>b.classList.toggle('active', b===btn));
        $$('main > section').forEach(sec=>{
          sec.classList.toggle('hidden', sec.id !== id);
        });
      });
    });
  })();

  // ============================
  // Works Manager
  // ============================
  const WORKS_STORAGE_KEY = 'dz_admin_works_v1';

  // flat list: {id,section,title_kr,...}
  let works = loadLocal(WORKS_STORAGE_KEY, []);

  const wId      = $('#wId');
  const wSection = $('#wSection');
  const wTitleKo = $('#wTitleKo');
  const wTitleEn = $('#wTitleEn');
  const wMatKo   = $('#wMatKo');
  const wMatEn   = $('#wMatEn');
  const wSizeKo  = $('#wSizeKo');
  const wSizeEn  = $('#wSizeEn');
  const wYear    = $('#wYear');
  const wImage   = $('#wImage');
  const wTableBody = $('#wTable tbody');
  const wJsonOut = $('#wJsonOut');
  const wError   = $('#wError');
  const wJsonError = $('#wJsonError');

  const WORK_SECTION_KEYS = [
    "Light & Memory",
    "Human Being",
    "Rebirth of Mind",
    "Restoration of Being",
    "Metaconsciousness of Light"
  ];

  function clearWorkForm(){
    wId.value = '';
    wTitleKo.value = '';
    wTitleEn.value = '';
    wMatKo.value = '';
    wMatEn.value = '';
    wSizeKo.value = '';
    wSizeEn.value = '';
    wYear.value = '';
    wImage.value = '';
    wError.textContent = '';
  }

  function renderWorksTable(){
    if(!Array.isArray(works)) works = [];
    wTableBody.innerHTML = works.map((w,i)=>`
      <tr>
        <td>${(w.id||'').replace(/</g,'&lt;')}</td>
        <td><span class="tag tag-sec">${(w.section||'').replace(/</g,'&lt;')}</span></td>
        <td>
          ${(w.title_kr||'').replace(/</g,'&lt;')}<br>
          <span style="color:#9fb0e3">${(w.title_en||'').replace(/</g,'&lt;')}</span>
        </td>
        <td>${(w.year||'').toString().replace(/</g,'&lt;')}</td>
        <td>${(w.image||'').replace(/</g,'&lt;')}</td>
        <td>
          <button type="button" class="btn" data-w-edit="${i}">편집</button>
          <button type="button" class="btn danger" data-w-del="${i}">삭제</button>
        </td>
      </tr>
    `).join('');

    // JSON 구조: { "Light & Memory":[...], "Human Being":[...], ... }
    const bySection = {
      "Light & Memory": [],
      "Human Being": [],
      "Rebirth of Mind": [],
      "Restoration of Being": [],
      "Metaconsciousness of Light": []
    };
    works.forEach(w=>{
      const key = WORK_SECTION_KEYS.includes(w.section) ? w.section : "Light & Memory";
      if(!bySection[key]) bySection[key] = [];
      bySection[key].push({
        id: w.id || '',
        title_kr: w.title_kr || '',
        title_en: w.title_en || '',
        material_kr: w.material_kr || '',
        material_en: w.material_en || '',
        size_kr: w.size_kr || '',
        size_en: w.size_en || '',
        year: w.year || '',
        image: w.image || ''
      });
    });
    wJsonOut.value = JSON.stringify(bySection, null, 2);
  }

  function upsertWork(){
    wError.textContent = '';
    wJsonError.textContent = '';

    const id = (wId.value || '').trim();
    const sec = wSection.value || 'Light & Memory';
    const title_kr = (wTitleKo.value||'').trim();
    const title_en = (wTitleEn.value||'').trim();
    const mat_kr   = (wMatKo.value||'').trim();
    const mat_en   = (wMatEn.value||'').trim();
    const size_kr  = (wSizeKo.value||'').trim();
    const size_en  = (wSizeEn.value||'').trim();
    const year     = (wYear.value||'').toString().trim();
    const image    = (wImage.value||'').trim();

    if(!id){
      wError.textContent = '작품 ID는 반드시 입력해야 합니다.';
      return;
    }
    if(!image){
      wError.textContent = '이미지 파일명을 입력해야 합니다. (예: DZ-001.jpg)';
      return;
    }

    const idx = works.findIndex(x=>x.id === id);
    const obj = {
      id,
      section: sec,
      title_kr,
      title_en,
      material_kr: mat_kr,
      material_en: mat_en,
      size_kr,
      size_en,
      year,
      image
    };

    if(idx >= 0){
      works[idx] = obj;
    }else{
      works.push(obj);
    }

    saveLocal(WORKS_STORAGE_KEY, works);
    renderWorksTable();
  }

  function importWorksFromJson(){
    wJsonError.textContent = '';
    wError.textContent = '';
    try{
      const txt = (wJsonOut.value || '').trim();
      if(!txt){
        wJsonError.textContent = '불러올 JSON이 없습니다. GitHub의 works.json을 붙여넣고 다시 시도하세요.';
        return;
      }
      const obj = JSON.parse(txt);
      const list = [];

      WORK_SECTION_KEYS.forEach(sec=>{
        const arr = Array.isArray(obj[sec]) ? obj[sec] : [];
        arr.forEach(item=>{
          list.push({
            id: item.id || '',
            section: sec,
            title_kr: item.title_kr || '',
            title_en: item.title_en || '',
            material_kr: item.material_kr || '',
            material_en: item.material_en || '',
            size_kr: item.size_kr || '',
            size_en: item.size_en || '',
            year: item.year || '',
            image: item.image || ''
          });
        });
      });

      works = list;
      saveLocal(WORKS_STORAGE_KEY, works);
      renderWorksTable();
      wJsonError.textContent = 'JSON에서 작품 목록을 불러왔습니다.';
    }catch(err){
      wJsonError.textContent = 'JSON 파싱에 실패했습니다. 형식을 다시 확인하세요.';
    }
  }

  $('#wAddBtn').addEventListener('click', upsertWork);
  $('#wResetBtn').addEventListener('click', clearWorkForm);
  $('#wImportBtn').addEventListener('click', importWorksFromJson);

  wTableBody.addEventListener('click', e=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const editIdx = btn.getAttribute('data-w-edit');
    const delIdx  = btn.getAttribute('data-w-del');

    if(editIdx !== null && editIdx !== undefined && editIdx !== ''){
      const i = Number(editIdx);
      const w = works[i];
      if(!w) return;
      wId.value      = w.id || '';
      wSection.value = w.section || 'Light & Memory';
      wTitleKo.value = w.title_kr || '';
      wTitleEn.value = w.title_en || '';
      wMatKo.value   = w.material_kr || '';
      wMatEn.value   = w.material_en || '';
      wSizeKo.value  = w.size_kr || '';
      wSizeEn.value  = w.size_en || '';
      wYear.value    = w.year || '';
      wImage.value   = w.image || '';
      wError.textContent = '선택한 작품 정보를 불러왔습니다. 수정 후 "추가 / 업데이트"를 누르면 덮어씁니다.';
    }

    if(delIdx !== null && delIdx !== undefined && delIdx !== ''){
      const i = Number(delIdx);
      const w = works[i];
      if(!w) return;
      const ok = confirm('이 작품을 목록에서 삭제할까요?\nID: '+(w.id||'')+'\n※ GitHub의 실제 파일은 직접 삭제해야 합니다.');
      if(!ok) return;
      works.splice(i,1);
      saveLocal(WORKS_STORAGE_KEY, works);
      renderWorksTable();
    }
  });

  renderWorksTable();

  // ============================
  // DCAR / Reports Manager
  // ============================
  const REPORTS_STORAGE_KEY = 'dz_admin_reports_v1';

  // 초기값: 로컬에 아무것도 없을 때만 DCAR-10 메타 하나 기본 세팅
  let reports = loadLocal(REPORTS_STORAGE_KEY, [
    {
      id: 'DCAR-10-2025',
      category: 'Theory',
      md_filename: 'DCAR-10-2025.md',
      title_ko: 'DCAR-10 — 감응의 파동장: 다층적 존재의 형성학',
      title_en: 'Aesthetic Report No.10 — Wavefields of Affect: A Multilayered Formation of Being',
      summary_ko: '전쟁·기아·플랫폼 자본주의·디지털 과잉 자극 속에서 정동은 파편화된 파동층으로 분열된다. DCAR-10은 등작의 회화를 “감응의 파동장”으로 읽으며, 기저 파동층·교차층·응축 핵·존재 축·상부 떨림층을 통해 존재가 관계적 파동으로 다시 서는 과정을 신경미학·철학·정신의학의 언어로 분석한다.',
      summary_en: 'In an age of war, famine, platform capitalism, and digital overstimulation, affect fractures into layered waves. DCAR-10 reads DUNGZAK CESTLAVIE’s painting as an “affective wavefield,” tracing primary layers, cross-disruptions, affective cores, and an axis of presence through which being is rebuilt as relational vibration across aesthetic, neuropsychiatric, and philosophical frames.',
      body: ''
    }
  ]);

  const rId     = $('#rId');
  const rCat    = $('#rCat');
  const rFile   = $('#rFile');
  const rTitleK = $('#rTitleKo');
  const rTitleE = $('#rTitleEn');
  const rSumK   = $('#rSumKo');
  const rSumE   = $('#rSumEn');
  const rBody   = $('#rBody');
  const rTableBody = $('#rTable tbody');
  const rJsonOut   = $('#rJsonOut');
  const rMdOut     = $('#rMdOut');
  const rError     = $('#rError');
  const rJsonError = $('#rJsonError');

  function clearReportForm(){
    rId.value = '';
    rCat.value = 'Theory';
    rFile.value = '';
    rTitleK.value = '';
    rTitleE.value = '';
    rSumK.value = '';
    rSumE.value = '';
    rBody.value = '';
    rError.textContent = '';
  }

  function renderReportsTable(){
    if(!Array.isArray(reports)) reports = [];
    rTableBody.innerHTML = reports.map((r,i)=>`
      <tr>
        <td>${(r.id||'').replace(/</g,'&lt;')}</td>
        <td>${(r.title_ko||'').replace(/</g,'&lt;')}</td>
        <td style="color:#9fb0e3">${(r.title_en||'').replace(/</g,'&lt;')}</td>
        <td><span class="tag">${(r.category||'').replace(/</g,'&lt;')}</span></td>
        <td>${(r.md_filename||'').replace(/</g,'&lt;')}</td>
        <td>
          <button type="button" class="btn" data-r-edit="${i}">편집</button>
          <button type="button" class="btn" data-r-md="${i}">MD</button>
          <button type="button" class="btn danger" data-r-del="${i}">삭제</button>
        </td>
      </tr>
    `).join('');

    // reports.json용 출력
    const outList = reports.map(r=>({
      id: r.id || '',
      category: r.category || 'Theory',
      title_ko: r.title_ko || '',
      title_en: r.title_en || '',
      summary_ko: r.summary_ko || '',
      summary_en: r.summary_en || '',
      md_path: '/reports/' + (r.md_filename || '')
    }));
    rJsonOut.value = JSON.stringify({ reports: outList }, null, 2);
  }

  function upsertReport(){
    rError.textContent = '';
    rJsonError.textContent = '';

    const id    = (rId.value||'').trim();
    const cat   = rCat.value || 'Theory';
    const file  = (rFile.value||'').trim();
    const tKo   = (rTitleK.value||'').trim();
    const tEn   = (rTitleE.value||'').trim();
    const sKo   = (rSumK.value||'').trim();
    const sEn   = (rSumE.value||'').trim();
    const body  = rBody.value || '';

    if(!id){
      rError.textContent = '보고서 ID는 반드시 입력해야 합니다. (예: DCAR-10-2025)';
      return;
    }
    if(!file){
      rError.textContent = 'MD 파일 이름을 입력해야 합니다. (예: DCAR-10-2025.md)';
      return;
    }

    const idx = reports.findIndex(x=>x.id === id);
    const obj = { id, category:cat, md_filename:file, title_ko:tKo, title_en:tEn, summary_ko:sKo, summary_en:sEn, body };

    if(idx >= 0){ reports[idx] = obj; }
    else{ reports.push(obj); }

    saveLocal(REPORTS_STORAGE_KEY, reports);
    renderReportsTable();

    rError.textContent = '저장되었습니다. (reports.json과 MD 내용은 아래 출력 영역에서 복사하세요.)';
  }

  function importReportsFromJson(){
    rJsonError.textContent = '';
    rError.textContent = '';
    try{
      const txt = (rJsonOut.value || '').trim();
      if(!txt){
        rJsonError.textContent = '불러올 JSON이 없습니다. GitHub의 reports.json을 붙여넣고 다시 시도하세요.';
        return;
      }
      const obj = JSON.parse(txt);
      const arr = Array.isArray(obj.reports) ? obj.reports : [];
      reports = arr.map(item=>({
        id: item.id || '',
        category: item.category || 'Theory',
        md_filename: (item.md_path || '').replace(/^\/?reports\//,''),
        title_ko: item.title_ko || '',
        title_en: item.title_en || '',
        summary_ko: item.summary_ko || '',
        summary_en: item.summary_en || '',
        body: '' // 본문은 개별 MD 파일에 붙여넣기
      }));
      saveLocal(REPORTS_STORAGE_KEY, reports);
      renderReportsTable();
      rMdOut.value = '';
      rJsonError.textContent = 'reports.json에서 목록을 불러왔습니다.';
    }catch(err){
      rJsonError.textContent = 'JSON 파싱에 실패했습니다. 형식을 다시 확인하세요.';
    }
  }

  $('#rAddBtn').addEventListener('click', upsertReport);
  $('#rResetBtn').addEventListener('click', clearReportForm);
  $('#rImportBtn').addEventListener('click', importReportsFromJson);

  rTableBody.addEventListener('click', e=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const editIdx = btn.getAttribute('data-r-edit');
    const delIdx  = btn.getAttribute('data-r-del');
    const mdIdx   = btn.getAttribute('data-r-md');

    if(editIdx !== null && editIdx !== undefined && editIdx !== ''){
      const i = Number(editIdx);
      const r = reports[i]; if(!r) return;
      rId.value     = r.id || '';
      rCat.value    = r.category || 'Theory';
      rFile.value   = r.md_filename || '';
      rTitleK.value = r.title_ko || '';
      rTitleE.value = r.title_en || '';
      rSumK.value   = r.summary_ko || '';
      rSumE.value   = r.summary_en || '';
      rBody.value   = r.body || '';
      rError.textContent = '선택한 DCAR 정보를 불러왔습니다. 수정 후 "추가 / 업데이트"를 누르면 덮어씁니다.';
    }

    if(mdIdx !== null && mdIdx !== undefined && mdIdx !== ''){
      const i = Number(mdIdx);
      const r = reports[i]; if(!r) return;
      const headerLines = [];
      if(r.title_ko) headerLines.push(`# ${r.title_ko}`);
      if(r.title_en) headerLines.push(`# ${r.title_en}`);
      if(r.id) headerLines.push('');
      const base = headerLines.join('\\n');
      const body = r.body || '';
      rMdOut.value = body ? (base + '\\n\\n' + body) : (base + '\\n\\n(여기에 본문을 붙여넣으세요)');
    }

    if(delIdx !== null && delIdx !== undefined && delIdx !== ''){
      const i = Number(delIdx);
      const r = reports[i]; if(!r) return;
      const ok = confirm('이 DCAR를 목록에서 삭제할까요?\nID: '+(r.id||'')+'\n※ GitHub의 실제 MD/JSON 파일은 직접 삭제해야 합니다.');
      if(!ok) return;
      reports.splice(i,1);
      saveLocal(REPORTS_STORAGE_KEY, reports);
      renderReportsTable();
      rMdOut.value = '';
    }
  });

  renderReportsTable();
  </script>
</body>
</html>