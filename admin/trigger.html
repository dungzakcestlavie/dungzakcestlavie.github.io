<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Lightflow Admin â€” Trigger (Î©.10.1 Â· iPhone-Stable)</title>
<meta name="theme-color" content="#070c1a">
<style>
:root{
 --bg:#070c1a;--panel:#0b1020;--soft:#0f1730;--fg:#e8edf7;--muted:#9fa8c0;
 --accent:#d4b97a;--ok:#74e0a1;--bad:#ff6b6b;--border:#1e2744;--radius:14px;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
 margin:0;background:var(--bg);color:var(--fg);
 font:16px/1.5 -apple-system,BlinkMacSystemFont,system-ui,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
}
header{
 position:sticky;top:0;z-index:10;
 background:linear-gradient(180deg,#0a1022e6,#0a102200);
 padding:14px 12px 10px;border-bottom:1px solid var(--border);
 backdrop-filter:saturate(130%) blur(8px);
}
h1{margin:0;font-size:26px;color:var(--accent);font-weight:800}
.sub{font-size:13px;color:var(--muted);margin-top:4px}
.container{max-width:860px;margin:0 auto;padding:14px 14px 120px}

.card{
 background:var(--panel);border:1px solid var(--border);
 padding:14px;margin:10px 0;border-radius:var(--radius)
}
.card h3{margin:4px 0 10px;color:var(--accent);font-size:1.05rem;font-weight:800}

button{
 width:100%;padding:14px;border-radius:12px;border:none;font-weight:800;
 font-size:15px;cursor:pointer;background:var(--accent);color:#09101f
}
.btn-ok{background:var(--ok);color:#081d12}
.btn-ghost{background:#203055;color:var(--fg);border:1px solid rgba(255,255,255,.08)}
.btn-bad{background:var(--bad);color:#200}
.btnbar{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}

small{font-size:12px;color:var(--muted)}

.kv{display:grid;grid-template-columns:120px 1fr;gap:6px;font-size:14px}
.k{color:var(--muted)}

.toast{
 position:fixed;left:50%;bottom:calc(18px + env(safe-area-inset-bottom));
 transform:translateX(-50%);
 background:#0b1223;border:1px solid var(--border);
 padding:10px 16px;border-radius:12px;color:var(--fg);
 opacity:0;transition:.22s;pointer-events:none;z-index:999;
}
.toast.show{opacity:1;transform:translate(-50%,-6px)}
</style>
</head>
<body>
<header>
 <h1>ğŸš€ Trigger Â· Î©.10.1</h1>
 <div class="sub">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Ã— Lumera Â· Pages Deploy Tools</div>
</header>

<div class="container">

 <div class="card">
  <h3>ì—°ê²° ìƒíƒœ</h3>
  <div class="kv">
   <div class="k">Owner</div><div id="sOwner">â€”</div>
   <div class="k">Repo</div><div id="sRepo">â€”</div>
   <div class="k">Branch</div><div id="sBranch">â€”</div>
   <div class="k">Token</div><div id="sToken">â€”</div>
   <div class="k">Last Check</div><div id="sCheck">â€”</div>
  </div>
  <div class="btnbar" style="margin-top:10px">
   <button type="button" class="btn-ghost" id="refresh">â†» ê°±ì‹ </button>
   <button type="button" class="btn-ok" id="test">ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸</button>
  </div>
  <small>ì„¤ì •ì€ admin í˜ì´ì§€(localStorage)ì™€ ë™ì¼í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</small>
 </div>

 <div class="card">
  <h3>ê°•ì œ íŠ¸ë¦¬ê±°</h3>
  <button type="button" id="touch">ğŸ“ Commit Touch (ìºì‹œ ë¬´íš¨)</button>
  <div class="btnbar">
   <button type="button" class="btn" id="pages">ğŸš€ Pages Build ìš”ì²­</button>
   <button type="button" class="btn-bad" id="clear">ğŸ§¹ localStorage ì´ˆê¸°í™”</button>
  </div>
  <small>touch íŒŒì¼ì´ ìƒì„±ë˜ë©° GitHub Pages ìµœì‹ í™”ê°€ ë™ì‘í•©ë‹ˆë‹¤.</small>
 </div>

</div>

<div id="toast" class="toast">Ready.</div>

<script>
/* helpers */
const $=q=>document.querySelector(q);
const say=(m,err=false)=>{const t=$("#toast");t.textContent=m;t.style.borderColor=err?"#ff6b6b":"#22304f";t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1800);};

const KEY="lf_admin_cfg_v101";
function cfg(k){try{return JSON.parse(localStorage.getItem(KEY)||"{}")[k]||"";}catch{return "";}}

function hydrate(){
 $("#sOwner").textContent=cfg("owner")||"â€”";
 $("#sRepo").textContent=cfg("repo")||"â€”";
 $("#sBranch").textContent=cfg("branch")||"â€”";
 $("#sToken").textContent=cfg("token")?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":"â€”";
 $("#sCheck").textContent=new Date().toLocaleTimeString();
}

/* GH */
async function gh(m,p,b=null,isJson=true){
 const token=cfg("token"); if(!token) throw new Error("í† í° ì—†ìŒ");
 const r=await fetch(`https://api.github.com/${p}`,{
  method:m,
  headers:{ "Accept":"application/vnd.github+json","Authorization":`token ${token}` },
  body:b?(isJson?JSON.stringify(b):b):null
 });
 if(!r.ok){const t=await r.text();throw new Error(`GitHub ${r.status}: ${t.slice(0,150)}`);}
 return r.json();
}
function b64(s){return btoa(unescape(encodeURIComponent(s)))}
async function putFile(p,data,msg){
 const o=cfg("owner"),r=cfg("repo"),b=cfg("branch")||"main";
 let old=null;
 try{old=await gh("GET",`repos/${o}/${r}/contents/${p}?ref=${b}`);}catch{}
 const body={message:msg,content:data,branch:b};
 if(old?.sha) body.sha=old.sha;
 return gh("PUT",`repos/${o}/${r}/contents/${p}`,body);
}

/* trigger functions */
async function testConn(){
 try{await gh("GET",`repos/${cfg("owner")}/${cfg("repo")}`);say("âœ… ì—°ê²° OK (200)");}
 catch(e){say("âš ï¸ ì—°ê²° ì‹¤íŒ¨: "+e.message,true);}
}

async function touch(){
 try{
  const stamp=new Date().toISOString();
  await putFile("data/.touch",b64("touch "+stamp),`touch ${stamp}`);
  say("ğŸ“ touch commit ì™„ë£Œ");
 }catch(e){say("touch ì‹¤íŒ¨: "+e.message,true);}
}

async function pagesBuild(){
 try{
  await gh("POST",`repos/${cfg("owner")}/${cfg("repo")}/pages/builds`,{});
  say("ğŸš€ Pages ë¹Œë“œ ìš”ì²­ ì™„ë£Œ");
 }catch(e){say("âš ï¸ Pages API ì‹¤íŒ¨: "+e.message,true);}
}

/* events */
window.addEventListener("load",()=>{
 hydrate();
 $("#refresh").onclick=hydrate;
 $("#test").onclick=testConn;
 $("#touch").onclick=touch;
 $("#pages").onclick=pagesBuild;
 $("#clear").onclick=()=>{localStorage.removeItem(KEY);say("localStorage ì‚­ì œ ì™„ë£Œ");hydrate();}
});
window.addEventListener("error",e=>say("JS ì˜¤ë¥˜: "+e.message,true));
</script>
</body>
</html>