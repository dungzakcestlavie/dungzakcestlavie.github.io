<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Lightflow Admin Ω.1 — DUNGZAK CESTLAVIE</title>
<style>
:root{
  --bg:#070c1a; --fg:#e6e6e6; --accent:#c6a86d; --soft:#1b2233;
}
body{
  background:var(--bg); color:var(--fg); font-family:-apple-system, "Pretendard", sans-serif;
  margin:0; padding:0; text-align:center;
}
h1{color:var(--accent); font-weight:600; font-size:1.4rem; margin:1rem 0;}
section{padding:1rem; border-bottom:1px solid #222;}
input,textarea,button,select{
  width:90%; max-width:400px; margin:6px auto; padding:10px;
  background:var(--soft); border:none; color:var(--fg); border-radius:6px;
  display:block; font-size:0.9rem;
}
button{background:var(--accent); color:#000; font-weight:600; cursor:pointer;}
.tabs{display:flex; flex-wrap:wrap; justify-content:center; gap:4px; margin-bottom:1rem;}
.tabs button{flex:1 1 auto; background:#111; color:var(--fg); border:1px solid #222;}
.tabs button.active{background:var(--accent); color:#000;}
.card{background:#0b0f18; margin:8px auto; padding:12px; border-radius:8px; max-width:450px;}
img.preview{max-width:100%; border-radius:4px; margin-top:6px;}
label{font-size:0.8rem; color:#aaa;}
hr{border:0; height:1px; background:#222; margin:20px 0;}
footer{font-size:0.7rem; color:#666; padding:1rem;}
</style>
</head>
<body>
<h1>✨ Lightflow Admin Ω.1</h1>

<section>
  <h3>GitHub 연결</h3>
  <input id="repo" placeholder="Repository (예: dungzakcestlavie.github.io)">
  <input id="branch" placeholder="Branch (예: main)">
  <input id="token" placeholder="Personal Access Token">
  <button onclick="saveConfig()">🔐 연결정보 저장</button>
  <button onclick="clearConfig()">❌ 토큰삭제</button>
</section>

<section>
  <h3>Ⅰ–Ⅴ 작품 아카이브 업로드</h3>
  <div class="tabs" id="workTabs"></div>
  <div id="workForm"></div>
</section>

<section>
  <h3>DCAR 1–8 미학 보고서 업로드</h3>
  <div id="reportContainer"></div>
</section>

<footer>© 2025 등작 燈酌 DUNGZAK CESTLAVIE · Orchestrated with Lumera</footer>

<script>
const sections=[
  {id:'light', name:'Ⅰ Light & Memory'},
  {id:'human', name:'Ⅱ Human Being'},
  {id:'rebirth', name:'Ⅲ Rebirth of Mind'},
  {id:'restoration', name:'Ⅳ Restoration of Being'},
  {id:'meta', name:'Ⅴ Metaconsciousness of Light'}
];
const repoEl=document.getElementById('repo');
const branchEl=document.getElementById('branch');
const tokenEl=document.getElementById('token');

function saveConfig(){
  localStorage.setItem('repo',repoEl.value);
  localStorage.setItem('branch',branchEl.value);
  localStorage.setItem('token',tokenEl.value);
  alert('✅ 저장되었습니다');
}
function clearConfig(){
  localStorage.clear();
  alert('🔒 토큰 및 설정이 삭제되었습니다');
}
window.onload=()=>{
  repoEl.value=localStorage.getItem('repo')||'';
  branchEl.value=localStorage.getItem('branch')||'';
  tokenEl.value=localStorage.getItem('token')||'';
  buildWorkTabs(); buildReports();
};

function buildWorkTabs(){
  const tabWrap=document.getElementById('workTabs');
  const formWrap=document.getElementById('workForm');
  sections.forEach((s,i)=>{
    const b=document.createElement('button');
    b.textContent=s.name;
    if(i===0)b.classList.add('active');
    b.onclick=()=>{
      document.querySelectorAll('.tabs button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      renderWorkForm(s.id,s.name);
    };
    tabWrap.appendChild(b);
  });
  renderWorkForm(sections[0].id,sections[0].name);
}

function renderWorkForm(id,name){
  const el=document.getElementById('workForm');
  el.innerHTML=`
  <div class="card">
    <h4>${name}</h4>
    <input id="artId" placeholder="Artwork ID (예: ${id}-01)">
    <input id="artTitle" placeholder="Title (예: Pray for Us)">
    <input id="artYear" placeholder="Year (예: 2025)">
    <input id="artMedium" placeholder="Medium (예: Acrylic on Canvas)">
    <input id="artSize" placeholder="Size (예: 162.2×130.3 cm)">
    <input id="artImage" type="file" accept="image/*">
    <textarea id="artDesc" placeholder="설명 (선택)"></textarea>
    <button onclick="uploadArtwork('${id}')">📤 업로드</button>
    <button onclick="deleteArtwork('${id}')">🗑 삭제</button>
  </div>`;
}

async function uploadArtwork(sectionId){
  const repo=localStorage.getItem('repo');
  const branch=localStorage.getItem('branch');
  const token=localStorage.getItem('token');
  const file=document.getElementById('artImage').files[0];
  if(!repo||!branch||!token){alert('⚠️ GitHub 연결정보를 입력하세요');return;}
  if(!file){alert('이미지를 선택하세요');return;}
  const reader=new FileReader();
  reader.onload=async()=>{
    const content=reader.result.split(',')[1];
    const path=`img/${sectionId}/${file.name}`;
    await fetch(`https://api.github.com/repos/${repo}/contents/${path}`,{
      method:'PUT',
      headers:{Authorization:`token ${token}`,'Content-Type':'application/json'},
      body:JSON.stringify({message:`Add ${path}`,content:content,branch:branch})
    });
    alert(`✅ ${sectionId} 업로드 완료`);
  };
  reader.readAsDataURL(file);
}

async function deleteArtwork(sectionId){
  alert(`🗑 ${sectionId} 작품 삭제 기능은 다음 버전에서 완성됩니다`);
}

function buildReports(){
  const c=document.getElementById('reportContainer');
  for(let i=1;i<=8;i++){
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`
      <h4>DCAR-${String(i).padStart(2,'0')}</h4>
      <input id="rTitle${i}" placeholder="Report Title">
      <textarea id="rText${i}" placeholder="보고서 내용 또는 요약"></textarea>
      <input id="rFile${i}" type="file" accept=".pdf,.txt,.docx">
      <button onclick="uploadReport(${i})">📤 업로드</button>
      <button onclick="deleteReport(${i})">🗑 삭제</button>`;
    c.appendChild(div);
  }
}

async function uploadReport(i){
  const repo=localStorage.getItem('repo');
  const branch=localStorage.getItem('branch');
  const token=localStorage.getItem('token');
  const file=document.getElementById(`rFile${i}`).files[0];
  if(!file){alert('파일을 선택하세요');return;}
  const reader=new FileReader();
  reader.onload=async()=>{
    const content=reader.result.split(',')[1];
    const path=`reports/DCAR-${String(i).padStart(2,'0')}-${file.name}`;
    await fetch(`https://api.github.com/repos/${repo}/contents/${path}`,{
      method:'PUT',
      headers:{Authorization:`token ${token}`,'Content-Type':'application/json'},
      body:JSON.stringify({message:`Add ${path}`,content:content,branch:branch})
    });
    alert(`✅ DCAR-${i} 업로드 완료`);
  };
  reader.readAsDataURL(file);
}

function deleteReport(i){
  alert(`🗑 DCAR-${i} 삭제 기능은 다음 버전에서 완성됩니다`);
}
</script>
</body>
</html>