<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE â€” Lightflow Î©.6.6Â·Hybrid</title>
<meta name="description" content="ë¹› Â· ê¸°ì–µ Â· ì¡´ì¬ â€” DUNGZAK CESTLAVIE Â· Lightflow Î©.6.6 Hybrid Â· Works Â· DCAR Reports" />
<meta property="og:title" content="DUNGZAK CESTLAVIE â€” Lightflow Î©.6.6 Hybrid">
<meta property="og:url" content="https://dungzak.art">
<meta name="theme-color" content="#060814">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='86'>âœ¨</text></svg>'>

<style>
:root{
  --bg:#060814;--fg:#eaf0ff;--gold:#e6c777;--muted:#a6b6e8;
  --panel:#0f1630;--line:#1b2652;--max:1180px;--headerH:70px;
}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
html,body{height:100%}
body{
  background:radial-gradient(1100px 780px at 70% -10%,#18224a 0,#0b1020 50%,#060814 100%);
  color:var(--fg);font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;
  overflow-x:hidden;
}

/* canvases */
#waves,#trail{position:fixed;inset:0;pointer-events:none}
#waves{z-index:0;opacity:.42;filter:blur(1px)}
#trail{z-index:1;opacity:.56;mix-blend-mode:screen}

/* header (Î©6.2 ìŠ¤íƒ€ì¼ ê°ì„±) */
header{
  position:sticky;top:0;z-index:8;display:flex;flex-wrap:wrap;gap:10px;
  background:rgba(10,14,28,.85);backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,.09);padding:10px 12px;
}
.brand{flex:1 1 100%;text-align:center;color:var(--gold);font-weight:900;
  font-size:clamp(16px,5vw,22px);letter-spacing:.3px}
nav.primary{width:100%;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
nav.primary button{all:unset;cursor:pointer;color:var(--fg);font-weight:800;
  padding:8px 14px;border-radius:14px;border:1px solid rgba(230,199,119,.5)}
nav.primary button.active,nav.primary button:hover{
  background:linear-gradient(180deg,#f7e4a5,#e6c777);color:#0a1230}
.lang{display:flex;gap:8px;justify-content:center;width:100%}
.lang button{all:unset;cursor:pointer;padding:6px 10px;border:1px solid #2a335f;border-radius:10px;color:#cfe0ff}
.lang button.active,.lang button:hover{background:#1b2348;color:var(--gold);border-color:#3a447a}

/* sections */
main{position:relative;z-index:2}
section{max-width:var(--max);margin:auto;padding:calc(var(--headerH) + 20px) 16px 72px}
h1,h2{color:var(--gold)}
.sub{color:var(--muted)}

/* hero + poem */
.hero{text-align:center;min-height:68vh}
.hero h1{font-size:clamp(36px,6vw,66px);margin-bottom:8px}
.hero p{opacity:.9;margin-bottom:16px}
.poem-wrap{max-width:820px;margin:12px auto 0;text-align:left;background:rgba(16,22,48,.35);
  border:1px solid #223;border-radius:12px}
.poem .row{padding:12px 14px}
.poem .row p{margin:4px 0}

/* bio */
#bio .box{max-width:820px;margin:6px auto 0;padding:12px 14px;background:rgba(16,22,48,.35);
  border:1px solid #223;border-radius:12px}

/* tabs (works) */
.tabs{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:12px 0 16px}
.tab{padding:9px 14px;border-radius:18px;border:1px solid var(--line);background:#0f1838;color:#bbcaf8;cursor:pointer;font-size:.92rem;white-space:nowrap}
.tab.active{background:linear-gradient(180deg,var(--gold),#f0df9e);color:#0a1230;border-color:#d9c16a}
.tabpanel{display:none}
.tabpanel.active{display:block}

/* grid */
.grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
@media(min-width:1024px){.grid{grid-template-columns:repeat(4,1fr)}}
.card{position:relative;background:var(--panel);border:1px solid var(--line);border-radius:10px;overflow:hidden;
  opacity:0;transform:translateY(8px);transition:opacity .6s,transform .6s,box-shadow .6s}
.card.visible{opacity:1;transform:translateY(0)}
.card:hover{box-shadow:0 0 18px 4px rgba(230,199,119,.28);border-color:var(--gold)}
.card img{width:100%;display:block;aspect-ratio:1/1;object-fit:cover;filter:brightness(1.03)}
.caption{padding:10px 12px;background:#0f1630;border-top:1px solid #1b2652;font-size:.85rem}
.caption strong{color:var(--gold)}
.caption em{opacity:.85}

/* reports */
.accordion{max-width:var(--max);margin:6px auto;border:1px solid #2a3a78;border-radius:12px;overflow:hidden}
.accordion-item{border-bottom:1px solid #2a3a78}
.accordion-header{background:#0f1838;color:var(--gold);padding:14px 16px;cursor:pointer;font-weight:700}
.accordion-content{display:none;background:#0b1020;padding:12px 16px;color:#cfe0ff}
.accordion-item.active .accordion-content{display:block}

/* lightbox */
#lightbox{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,.88);opacity:0;pointer-events:none;transition:.25s;z-index:9}
#lightbox.open{opacity:1;pointer-events:auto}
#lightbox .frame{position:relative;max-width:92vw;max-height:88vh;overflow:hidden;border:2px solid var(--gold);border-radius:10px}
#lightbox img{display:block;max-width:100%;max-height:100%;transform-origin:center center;cursor:zoom-in}
.lb-cap{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);max-width:92vw;background:rgba(8,16,40,.7);border:1px solid #223;border-radius:10px;padding:8px 12px;font-size:.88rem;color:#e9f1ff}

/* footer */
footer{border-top:1px solid rgba(255,255,255,.08);text-align:center;padding:44px 12px 96px;background:#090f22}
.links{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
.links a{color:#cfe0ff;text-decoration:none}
.links a:hover{color:#cbe0ff}
small{display:block;margin-top:8px;color:#9fb0d8}

/* mini social FAB (ì‘ì€ ì›í˜•) */
#socialFab{position:fixed;right:12px;bottom:calc(110px + env(safe-area-inset-bottom));display:flex;flex-direction:column;gap:8px;z-index:10}
#socialFab a{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;background:rgba(12,19,48,.45);border:1px solid rgba(230,199,119,.35);backdrop-filter:blur(6px);text-decoration:none;color:#cfe0ff}
#socialFab a:hover{color:#0a1230;background:linear-gradient(180deg,#f7e4a5,#e6c777)}

/* sound ctrl */
#ctrl{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(62px + env(safe-area-inset-bottom));display:flex;gap:8px;z-index:10}
.ctrlbtn{width:36px;height:36px;border-radius:50%;border:1px solid rgba(230,199,119,.35);background:rgba(12,19,48,.45);color:#fff;cursor:pointer}
.ctrlbtn[disabled]{opacity:.5;cursor:not-allowed}

/* lang visibility */
.en,.ko{display:none}
body.korean .ko{display:initial}
body.english .en{display:initial}
body.hybrid .ko,body.hybrid .en{display:initial}

/* reduce motion */
@media (prefers-reduced-motion: reduce){#waves,#trail{display:none}}
</style>
</head>
<body class="korean">

<!-- BG -->
<canvas id="waves" aria-hidden="true"></canvas>
<canvas id="trail" aria-hidden="true"></canvas>

<header>
  <div class="brand">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Lightflow Î©.6.6 Hybrid</div>
  <nav class="primary">
    <button data-target="poem" class="active">Poem</button>
    <button data-target="bio">Bio</button>
    <button data-target="works">Works</button>
    <button data-target="reports">Reports</button>
  </nav>
  <div class="lang" aria-label="Language">
    <button id="koBtn" class="active">KR</button>
    <button id="enBtn">EN</button>
    <button id="hyBtn">KR+EN</button>
  </div>
</header>

<main>
  <!-- Poem -->
  <section id="poem" class="hero">
    <div>
      <h1 class="ko">ë¹› Â· ê¸°ì–µ Â· ì¡´ì¬</h1>
      <h1 class="en">Light Â· Memory Â· Being</h1>
      <p class="ko">ë“±ì‘ê³¼ ë£¨ë©”ë¼ì˜ ì§€íœ˜ë¡œ â€” ë“±ì‘ DUNGZAK CESTLAVIE</p>
      <p class="en">Conducted by DUNGZAK and Lumera â€” DUNGZAK CESTLAVIE</p>

      <div class="poem-wrap">
        <div class="poem">
          <div class="row ko">
            <p>ì„¼ëŠê°• ë‹¤ë¦¬ ì•„ë˜, ë…¸íŠ¸ë¥´ë‹´ ì„±ë‹¹ì˜ ì´›ë¶ˆì´ ì¼œì§ˆ ë¬´ë µâ€”</p>
            <p>ì†Œë°•í•œ ê¿ˆë“¤ì„ ì•ˆê³  ì‚¬ëŠ” ì‚¬ëŒë“¤ì´ ëª¨ì—¬ ì¶¤ì¶˜ë‹¤.</p>
            <p>ë°”ì´ì˜¬ë¦°ì´ ìƒˆíŒŒë—ê³  ìƒ›ë…¸ë‘ì˜ ë¹›ì„ í©ë¿Œë¦¬ë©° ì›ƒëŠ”ë‹¤.</p>
            <p>ê¿ˆê¾¸ëŠ” ì—¬ì¸ë“¤ê³¼ ê¿ˆê¾¸ëŠ” ë‚¨ì„±ë“¤ì´ ì†ì„ ì¡ê³ ,</p>
            <p>ì‚¬ëŒì˜ í–¥ê¸°ë¥¼ ë§¡ìœ¼ë©° ì¬ë¹ ë¥¸ ìŒë¥ ì— ëª¸ì„ ë§¡ê¸´ë‹¤.</p>
            <p>ì´ˆìŠ¹ë‹¬ì€ ì–´ì—¬ìœ í•˜ì–€ ë¯¸ì†Œë¥¼ í˜ë¦¬ê³ , ì‚¬ë‘ì€ ê·¸ ë¹›ìœ¼ë¡œ íë¥¸ë‹¤.</p>
          </div>
          <div class="row en">
            <p>Beneath the bridge of the Seine, as Notre-Dameâ€™s candles begin to glowâ€”</p>
            <p>Those who live with humble dreams gather to dance.</p>
            <p>Violins scatter blue and golden light, laughing in brilliance.</p>
            <p>Dreaming women and men clasp hands,</p>
            <p>breathe the scent of humanity, and yield to loveâ€™s rhythm.</p>
            <p>The crescent moon spills a tender smile; love flows within its light.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bio -->
  <section id="bio" style="display:none">
    <h2 class="ko">ì‘ê°€ ì†Œê°œ</h2>
    <h2 class="en">Artist Bio</h2>
    <div class="box">
      <p class="ko">ë¹›ì˜ ì² í•™ê³¼ ì¸ê°„ì˜ ê°ì •ì„ í™”í­ì— ë‹´ëŠ” í˜„ëŒ€ ì˜ˆìˆ ê°€. DCAR(1â€“8)ë¡œ ì² í•™Â·ë‡Œê³¼í•™Â·ì˜ˆìˆ ì„ ìœµí•©í•œë‹¤.</p>
      <p class="en">A contemporary artist exploring the philosophy of light and feeling. The DCAR (1â€“8) series unites philosophy, neuroscience, and art.</p>
    </div>
  </section>

  <!-- Works -->
  <section id="works" style="display:none">
    <h2>Artworks â€” ì‘í’ˆ ì•„ì¹´ì´ë¸Œ</h2>
    <div class="tabs" role="tablist" aria-label="Art Sections">
      <button class="tab active" data-panel="pray">â…  ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” â€” Pray for Us</button>
      <button class="tab" data-panel="human">â…¡ ì¸ê°„ â€” Human Being</button>
      <button class="tab" data-panel="rebirth">â…¢ ì •ì‹ ì˜ ì¬íƒ„ìƒ â€” Rebirth of Mind</button>
      <button class="tab" data-panel="exist">â…£ ì¡´ì¬ì˜ íšŒë³µ â€” Restoration of Being</button>
      <button class="tab" data-panel="cosmos">â…¤ ë¹›ì˜ ì´ˆì˜ì‹ â€” Metaconsciousness of Light</button>
    </div>
    <div id="panel-pray" class="tabpanel active"></div>
    <div id="panel-human" class="tabpanel"></div>
    <div id="panel-rebirth" class="tabpanel"></div>
    <div id="panel-exist" class="tabpanel"></div>
    <div id="panel-cosmos" class="tabpanel"></div>

    <div style="margin-top:14px;text-align:center;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
      <button id="exportMeta">Export JSON</button>
      <button id="importMeta">Import JSON</button>
      <button id="clearMeta"  title="ë¸Œë¼ìš°ì € ì €ì¥ ì´ˆê¸°í™”">Clear(Local)</button>
    </div>
    <p class="sub" style="text-align:center;margin-top:6px;opacity:.85">ë”ë¸”í´ë¦­/ë”ë¸”íƒ­ â†’ ë©”íƒ€ í¸ì§‘ Â· ì €ì¥ ì¦‰ì‹œ ë°˜ì˜(ë¸Œë¼ìš°ì € ì €ì¥)</p>
  </section>

  <!-- Reports -->
  <section id="reports" style="display:none">
    <h2 class="ko">ë¯¸í•™ ë³´ê³ ì„œ (DCAR ì‹œë¦¬ì¦ˆ)</h2>
    <h2 class="en">Aesthetic Reports (DCAR Series)</h2>
    <div class="accordion" id="dcarAcc">
      <div class="accordion-item"><div class="accordion-header">DCAR-01-2025 Â· ì¡´ì¬ì˜ íšŒë³µ Â· The Restoration of Being</div><div class="accordion-content ko">ì¡´ì¬ì˜ íšŒë³µê³¼ ê°ê°ì˜ ìœ¤ë¦¬.</div><div class="accordion-content en">Restoration of being and the ethics of sensation.</div></div>
      <div class="accordion-item"><div class="accordion-header">DCAR-02-2025 Â· ê¸°ì–µì˜ ìœ¤ë¦¬ Â· The Ethics of Memory</div><div class="accordion-content ko">ê¸°ì–µì˜ êµ¬ì„±ê³¼ ê³µì¡´ì˜ ì±…ì„.</div><div class="accordion-content en">The construction of memory and responsibility for coexistence.</div></div>
      <div class="accordion-item"><div class="accordion-header">DCAR-03-2025 Â· ì •ì‹ ì˜ ì¬íƒ„ìƒ Â· The Rebirth of Mind</div><div class="accordion-content ko">ì§€ê°ì˜ ì§„í™”ì™€ ì˜ì‹ì˜ í™•ì¥.</div><div class="accordion-content en">Evolution of perception and the widening of consciousness.</div></div>
      <div class="accordion-item"><div class="accordion-header">DCAR-04-2025 Â· ë¹›ì˜ ìƒí” Â· The Scars of Light</div><div class="accordion-content ko">ìƒí”ì˜ ë¯¸í•™ê³¼ ì¡´ì—„.</div><div class="accordion-content en">The aesthetics and dignity of scars.</div></div>
    </div>
  </section>
</main>

<!-- Lightbox -->
<div id="lightbox" aria-hidden="true">
  <div class="frame"><img alt="Artwork view"></div>
  <div class="lb-cap" id="lbCap"></div>
</div>

<!-- Floating social (ì‘ì€ ì•„ì´ì½˜) -->
<div id="socialFab" aria-label="Quick social">
  <a href="https://flickr.com/photos/dungzak" target="_blank" title="Flickr">ğŸ“¸</a>
  <a href="https://instagram.com/dungzakcestlavie" target="_blank" title="Instagram">ğŸ“·</a>
  <a href="https://youtube.com/@dungzakcestlavie" target="_blank" title="YouTube">â–¶ï¸</a>
  <a href="https://naver.me/x95dk3l1" target="_blank" title="Naver Info">ğŸ§­</a>
  <a href="mailto:dungzakcestlavie@gmail.com" title="Email">âœ‰ï¸</a>
</div>

<!-- Sound controls -->
<div id="ctrl" aria-label="Cosmic Resonance controls">
  <button class="ctrlbtn" id="soundBtn" title="Play Prayer Resonance">âœ¨</button>
  <button class="ctrlbtn" id="soundStopBtn" title="Stop" disabled>ğŸ”‡</button>
</div>

<footer>
  <div class="links">
    <a href="#poem">â†‘ Poem</a> <a href="#works">Works</a> <a href="#reports">Reports</a>
  </div>
  <small class="ko">Â© 2025 ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· ë“±ì‘ê³¼ ë£¨ë©”ë¼ì˜ ì§€íœ˜ë¡œ</small>
  <small class="en">Â© 2025 DUNGZAK CESTLAVIE Â· Conducted by DUNGZAK and Lumera</small>
</footer>

<script>
/* ===== Lightflow Î©.6.6 Hybrid â€” Full JS ===== */
(function(){
  const $=(s,sc)=> (sc||document).querySelector(s);
  const $$=(s,sc)=> Array.from((sc||document).querySelectorAll(s));
  const store={get(k,d=null){try{const v=localStorage.getItem(k);return v?JSON.parse(v):d;}catch{return d}},
               set(k,v){try{localStorage.setItem(k,JSON.stringify(v));}catch{}}};

  /* ---------- Section switch (Poem/Bio/Works/Reports) ---------- */
  function showSection(id){
    ['poem','bio','works','reports'].forEach(x=>{const el=$('#'+x); if(el) el.style.display=(x===id)?'block':'none';});
    $$('nav.primary button').forEach(b=>b.classList.toggle('active', b.dataset.target===id));
    history.replaceState(null,'','#'+id);
  }
  $$('nav.primary button').forEach(b=> b.addEventListener('click',()=> showSection(b.dataset.target)));
  showSection(location.hash?location.hash.slice(1):'poem');

  /* ---------- Language toggle ---------- */
  const koBtn=$('#koBtn'), enBtn=$('#enBtn'), hyBtn=$('#hyBtn');
  function setLang(lang){
    document.body.classList.remove('korean','english','hybrid');
    if(lang==='ko') document.body.classList.add('korean');
    else if(lang==='en') document.body.classList.add('english');
    else document.body.classList.add('hybrid');
    [koBtn,enBtn,hyBtn].forEach(b=>b.classList.remove('active'));
    ({ko:koBtn,en:enBtn,hy:hyBtn}[lang]).classList.add('active');
    store.set('dz_lang',lang);
    // Works ìº¡ì…˜ ì¦‰ì‹œ ì¬ì¶œë ¥
    const cur=$('.tabs .tab.active'); if(cur) renderPanel(cur.dataset.panel);
    // Reports ì–¸ì–´ ë™ê¸°
    syncAccLang();
  }
  koBtn.onclick=()=>setLang('ko');
  enBtn.onclick=()=>setLang('en');
  hyBtn.onclick=()=>setLang('hy');
  setLang(store.get('dz_lang','ko'));

  /* ---------- Background: gentle but clear cosmic waves ---------- */
  try{
    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const waves=$('#waves').getContext('2d',{alpha:true});
    const trail=$('#trail').getContext('2d',{alpha:true});
    let DPR=1, vw=0, vh=0, t=0, px=innerWidth/2, py=innerHeight/2, tx=px, ty=py, visible=true;
    function resize(){
      DPR=Math.max(1,Math.min(2,devicePixelRatio||1));
      vw=waves.canvas.width=trail.canvas.width=Math.floor(innerWidth*DPR);
      vh=waves.canvas.height=trail.canvas.height=Math.floor(innerHeight*DPR);
      waves.setTransform(1,0,0,1,0,0); trail.setTransform(1,0,0,1,0,0);
      waves.scale(1/DPR,1/DPR); trail.scale(1/DPR,1/DPR);
    }
    resize(); addEventListener('resize',resize,{passive:true});
    document.addEventListener('visibilitychange',()=>visible=!document.hidden);
    addEventListener('mousemove',e=>{tx=e.clientX;ty=e.clientY},{passive:true});
    addEventListener('touchmove',e=>{const p=e.touches[0];tx=p.clientX;ty=p.clientY},{passive:true});

    const ease=x=>x*x*(3-2*x);
    function laneY(x,k){
      const f1=0.0032+k*0.0007,f2=0.0065+k*0.0006;
      const a1=26+k*12,a2=14+k*8;
      const drift=t*(0.76+k*0.16);
      const base=innerHeight*0.3+k*108+Math.sin(t*0.5+k)*12;
      const curve=0.9+ease(x/innerWidth)*0.2;
      return base+Math.sin(x*f1+drift*1.15+Math.sin(drift*0.7+k)*.25)*a1*curve
                 +Math.sin(x*f2+drift*.9)*a2;
    }
    function drawWaves(){
      waves.clearRect(0,0,innerWidth,innerHeight);
      const lanes=prefersReduced?2:4, hueBase=210+Math.sin(t*0.05)*15;
      for(let k=0;k<lanes;k++){
        waves.beginPath();
        for(let x=0;x<=innerWidth;x+=6){ const y=laneY(x,k); x?waves.lineTo(x,y):waves.moveTo(x,y); }
        const y0=laneY(0,k), g=waves.createLinearGradient(0,y0-140,0,y0+140);
        const hue=(hueBase+k*12)%360;
        g.addColorStop(0,`hsla(${hue},65%,70%,.10)`);
        g.addColorStop(.5,`hsla(45,70%,68%,.28)`);
        g.addColorStop(1,`hsla(${(hue+60)%360},60%,60%,.10)`);
        waves.strokeStyle=g; waves.lineWidth=1.15+k*0.45; waves.globalAlpha=.9-k*.12; waves.shadowBlur=16; waves.shadowColor='rgba(160,200,255,.18)';
        waves.stroke();
      }
      waves.globalAlpha=1; waves.shadowBlur=0;
    }
    function drawTrail(){
      px+=(tx-px)*(prefersReduced?0.10:0.15); py+=(ty-py)*(prefersReduced?0.10:0.15);
      const sp=Math.hypot(tx-px,ty-py), r=96+Math.min(sp*160,240);
      trail.fillStyle='rgba(0,0,0,.12)'; trail.fillRect(0,0,innerWidth,innerHeight);
      const g=trail.createRadialGradient(px,py,0,px,py,r);
      g.addColorStop(0,'rgba(230,199,119,.24)'); g.addColorStop(.55,'rgba(140,185,255,.14)'); g.addColorStop(1,'rgba(140,185,255,0)');
      trail.fillStyle=g; trail.beginPath(); trail.arc(px,py,r,0,Math.PI*2); trail.fill();
    }
    (function loop(){ if(visible){ t+=prefersReduced?0.003:0.008; drawWaves(); if(!prefersReduced) drawTrail(); } requestAnimationFrame(loop); })();
  }catch(e){console.warn('waves err',e);}

  /* ---------- Works render + meta edit + import/export ---------- */
  const SECTIONS=[
    {key:'pray',title:'Pray for Us'},
    {key:'human',title:'Human Being'},
    {key:'rebirth',title:'Rebirth of Mind'},
    {key:'exist',title:'Restoration of Being'},
    {key:'cosmos',title:'Metaconsciousness of Light'}
  ];
  let META=store.get('works_meta',{});
  function captionFor(secKey,i,secTitle){
    const m=META[secKey]?.[i]||{};
    const tko=m.title_ko||`ì‘í’ˆ ${i}`;
    const ten=m.title_en||`${secTitle} ${i}`;
    const info=[m.material,m.size,m.year].filter(Boolean).join(' Â· ');
    const showKo=document.body.classList.contains('korean');
    const showEn=document.body.classList.contains('english');
    if(showKo) return `<strong>${tko}</strong>${info?`<br>${info}`:''}`;
    if(showEn) return `<strong>${ten}</strong>${info?`<br>${info}`:''}`;
    return `<strong>${tko}</strong><br><em>${ten}</em>${info?`<br>${info}`:''}`;
  }
  function cardHTML(secKey,secTitle,i){
    return `<article class="card" tabindex="0" data-sec="${secKey}" data-id="${i}">
      <img loading="lazy" data-src="works/${secKey}/${i}.jpg" alt="${secTitle} ${i}">
      <div class="caption">${captionFor(secKey,i,secTitle)}</div>
    </article>`;
  }
  function renderPanel(secKey){
    const sec=SECTIONS.find(s=>s.key===secKey); const host=$('#panel-'+secKey); if(!host) return;
    const N=20;
    host.innerHTML=`<div class="grid">${Array.from({length:N},(_,k)=>cardHTML(sec.key,sec.title,k+1)).join('')}</div>`;
    try{
      const io=new IntersectionObserver(es=>{
        es.forEach(e=>{
          if(e.isIntersecting){
            const img=e.target; if(img.dataset.src){img.src=img.dataset.src; img.removeAttribute('data-src');}
            img.closest('.card')?.classList.add('visible'); io.unobserve(img);
          }
        });
      },{rootMargin:'220px'});
      $$('#panel-'+secKey+' img[loading][data-src]').forEach(img=>io.observe(img));
    }catch{}
  }
  SECTIONS.forEach(s=>renderPanel(s.key));
  $$('.tabs .tab').forEach(b=>{
    b.addEventListener('click',()=>{
      $$('.tabs .tab').forEach(x=>x.classList.remove('active')); b.classList.add('active');
      $$('.tabpanel').forEach(x=>x.classList.remove('active')); $('#panel-'+b.dataset.panel).classList.add('active');
      renderPanel(b.dataset.panel);
    });
  });

  // double click / double tap editor
  document.body.addEventListener('dblclick',e=>{
    const card=e.target.closest('.card'); if(card) openEditor(card.dataset.sec,card.dataset.id);
  });
  document.body.addEventListener('touchend',e=>{
    const now=performance.now(); if(document._lastTap && now-document._lastTap<300){ const card=e.target.closest('.card'); if(card) openEditor(card.dataset.sec,card.dataset.id); }
    document._lastTap=now;
  },{passive:true});
  function openEditor(secKey,id){
    const m=META[secKey]?.[id]||{};
    const wrap=document.createElement('div'); wrap.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:9999';
    wrap.innerHTML=`<div style="background:#0f1630;color:#e9efff;width:92vw;max-width:520px;border:1px solid #2a3a78;border-radius:12px;padding:16px">
      <h3 style="margin-bottom:8px">ì‘í’ˆ ì •ë³´ ìˆ˜ì • â€” ${secKey} / ${id}</h3>
      <div style="display:grid;gap:8px">
        <label>ì œëª©(KR)<br><input id="tk" style="width:100%" value="${m.title_ko||''}"></label>
        <label>Title(EN)<br><input id="te" style="width:100%" value="${m.title_en||''}"></label>
        <label>ì¬ë£Œ(Material)<br><input id="mat" style="width:100%" value="${m.material||''}"></label>
        <label>í¬ê¸°(Size)<br><input id="sz" style="width:100%" value="${m.size||''}"></label>
        <label>ì—°ë„(Year)<br><input id="yr" style="width:100%" value="${m.year||''}"></label>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="del" style="background:#3b2240;color:#fff;border:1px solid #5a3a6d;padding:6px 10px;border-radius:8px">Delete</button>
        <button id="cancel" style="background:#1b2548;color:#fff;border:1px solid #2a3a78;padding:6px 10px;border-radius:8px">Cancel</button>
        <button id="save" style="background:#d6b868;color:#0a1230;border:1px solid #d6b868;padding:6px 10px;border-radius:8px;font-weight:800">Save</button>
      </div></div>`;
    document.body.appendChild(wrap);
    wrap.querySelector('#cancel').onclick=()=>wrap.remove();
    wrap.querySelector('#del').onclick=()=>{ if(confirm('ì´ ì¹´ë“œì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')){ if(META[secKey]) delete META[secKey][id]; store.set('works_meta',META); renderPanel(secKey); wrap.remove(); } };
    wrap.querySelector('#save').onclick=()=>{
      META[secKey]=META[secKey]||{};
      META[secKey][id]={title_ko:wrap.querySelector('#tk').value.trim(),title_en:wrap.querySelector('#te').value.trim(),material:wrap.querySelector('#mat').value.trim(),size:wrap.querySelector('#sz').value.trim(),year:wrap.querySelector('#yr').value.trim()};
      store.set('works_meta',META); renderPanel(secKey); wrap.remove();
    };
  }
  // export/import/clear
  $('#exportMeta').onclick=()=>{ const blob=new Blob([JSON.stringify(META,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='works-metadata.json'; a.click(); URL.revokeObjectURL(a.href); };
  $('#importMeta').onclick=()=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='.json,application/json'; inp.onchange=e=>{const f=e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ META=JSON.parse(r.result)||{}; store.set('works_meta',META); SECTIONS.forEach(s=>renderPanel(s.key)); alert('ë©”íƒ€ë°ì´í„° ë°˜ì˜ ì™„ë£Œ'); }catch{ alert('JSON íŒŒì‹± ì˜¤ë¥˜'); } }; r.readAsText(f,'utf-8'); }; inp.click(); };
  $('#clearMeta').onclick=()=>{ if(confirm('ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ì‘í’ˆ ì •ë³´ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?')){ META={}; store.set('works_meta',META); SECTIONS.forEach(s=>renderPanel(s.key)); } };

  /* ---------- Reports accordion & lang sync ---------- */
  function syncAccLang(){
    const isKo=document.body.classList.contains('korean');
    const isHy=document.body.classList.contains('hybrid');
    $$('#dcarAcc .accordion-item').forEach(it=>{
      const kos=$$('.accordion-content.ko',it), ens=$$('.accordion-content.en',it);
      if(isHy){ kos.forEach(x=>x.style.display='block'); ens.forEach(x=>x.style.display='block'); }
      else { kos.forEach(x=>x.style.display=isKo?'block':'none'); ens.forEach(x=>x.style.display=isKo?'none':'block'); }
    });
  }
  syncAccLang();
  $$('#dcarAcc .accordion-header').forEach(h=> h.addEventListener('click',()=> h.parentElement.classList.toggle('active')));

  /* ---------- Lightbox ---------- */
  (function(){
    const lb=$('#lightbox'), img=lb.querySelector('img'), cap=$('#lbCap');
    let zoom=1, ox=0, oy=0, sx=0, sy=0, dragging=false;
    document.body.addEventListener('click',e=>{
      const card=e.target.closest('.card'); if(!card) return;
      const el=card.querySelector('img'); const src=el.getAttribute('src')||el.dataset.src;
      img.src=src; cap.textContent=card.querySelector('.caption')?.innerText||'';
      lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); zoom=1; ox=oy=0; img.style.transform='translate(0,0) scale(1)';
    });
    lb.addEventListener('click',e=>{ if(e.target===lb){ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); }});
    img.addEventListener('click',()=>{ if(zoom===1){zoom=2; img.style.cursor='grab';} else {zoom=1; ox=oy=0; img.style.cursor='zoom-in';} apply(); });
    img.addEventListener('mousedown',e=>{ if(zoom===1) return; dragging=true; sx=e.clientX-ox; sy=e.clientY-oy; img.style.cursor='grabbing';});
    window.addEventListener('mousemove',e=>{ if(!dragging) return; ox=e.clientX-sx; oy=e.clientY-sy; apply();});
    window.addEventListener('mouseup',()=>{ dragging=false; if(zoom>1) img.style.cursor='grab';});
    function apply(){ img.style.transform=`translate(${ox}px,${oy}px) scale(${zoom})`; }
    document.addEventListener('keydown',e=>{ if(e.key==='Escape'&&lb.classList.contains('open')){ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); }});
  })();

  /* ---------- Prayer Resonance (iOS unlock, fade) ---------- */
  (function(){
    const playBtn=$('#soundBtn'), stopBtn=$('#soundStopBtn'); if(!playBtn) return;
    let ac=null, nodes=null, on=false;
    async function ensureAC(){ if(!ac){ const C=(window.AudioContext||window.webkitAudioContext); ac=new C({latencyHint:'interactive'}); } if(ac.state==='suspended') await ac.resume(); return ac; }
    const unlock=async()=>{ try{await ensureAC();}catch{} window.removeEventListener('touchend',unlock); window.removeEventListener('click',unlock); };
    window.addEventListener('touchend',unlock,{once:true}); window.addEventListener('click',unlock,{once:true});
    function G(v){const g=ac.createGain(); g.gain.value=v; return g;}
    function O(type,f){const o=ac.createOscillator(); o.type=type; o.frequency.value=f; return o;}
    async function start(){
      if(on) return; await ensureAC();
      const base=G(.12), sub=G(.05), mid=G(.06), shim=G(.010);
      const l=O('sine',62), l2=O('sine',124), floor=O('sine',31), ch1=O('sine',432), ch2=O('sine',528);
      const lfo1=O('sine',7.83), lfo2=O('sine',5.0);
      const lpg=G(.07), lpg2=G(.05); lfo1.connect(lpg).connect(base.gain); lfo2.connect(lpg2).connect(base.gain);
      const lp=ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=900; lp.Q.value=.8;
      const bp=ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=120; bp.Q.value=.7;
      l.connect(base).connect(bp).connect(lp); l2.connect(mid).connect(bp); floor.connect(sub).connect(bp);
      ch1.connect(shim).connect(lp); ch2.connect(shim).connect(lp);
      lp.connect(ac.destination); bp.connect(ac.destination);
      [l,l2,floor,ch1,ch2,lfo1,lfo2].forEach(x=>x.start());
      [base.gain,sub.gain,mid.gain,shim.gain].forEach(g=>{const t=g.value; try{g.setValueAtTime(Math.max(.0001,t*.001),ac.currentTime); g.exponentialRampToValueAtTime(t,ac.currentTime+1.2);}catch{}});
      nodes={l,l2,floor,ch1,ch2,lfo1,lfo2,base,sub,mid,shim,lp,bp}; on=true; playBtn.disabled=true; stopBtn.disabled=false;
    }
    function stop(){
      if(!on||!nodes||!ac) return;
      const {l,l2,floor,ch1,ch2,lfo1,lfo2,base,sub,mid,shim,lp}=nodes; const t=ac.currentTime;
      [base.gain,sub.gain,mid.gain,shim.gain].forEach(g=>{try{g.cancelScheduledValues(0); g.exponentialRampToValueAtTime(.0001,t+1.8);}catch{}});
      try{lp.frequency.linearRampToValueAtTime(120,t+1.8);}catch{}
      setTimeout(()=>{[l,l2,floor,ch1,ch2,lfo1,lfo2].forEach(o=>{try{o.stop()}catch{}}); nodes=null;},1900);
      on=false; playBtn.disabled=false; stopBtn.disabled=true;
    }
    playBtn.onclick=start; stopBtn.onclick=stop;
    document.addEventListener('visibilitychange',async()=>{ if(!ac) return; if(document.hidden) try{await ac.suspend()}catch{}; else if(on) try{await ac.resume()}catch{}; });
  })();
})();
</script>
</body>
</html>