<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8">
  <title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.29 â€” Works Auto Manager v52</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="color-scheme" content="dark light">

  <style>
    :root{
      --bg:#050814;
      --panel:#0c1024;
      --panel-soft:#131838;
      --ink:#f3f4ff;
      --sub:#9faee6;
      --accent:#f4c96b;
      --accent-soft:rgba(244,201,107,.2);
      --danger:#ff5a7a;
      --ok:#6be6a8;
      --border:rgba(255,255,255,.08);
      --radius:18px;
      --shadow:0 24px 80px rgba(0,0,0,.7);
      --font-main:-apple-system,BlinkMacSystemFont,"Noto Sans KR","Apple SD Gothic Neo",system-ui,sans-serif;
      --mono:ui-monospace,Menlo,Monaco,Consolas,"SF Mono",monospace;
    }
    *{box-sizing:border-box;}
    html,body{
      margin:0;
      padding:0;
      background:radial-gradient(circle at 10% -10%,#233268 0,#050814 52%,#000000 100%);
      color:var(--ink);
      font-family:var(--font-main);
    }
    body{
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:32px 12px 40px;
    }
    .shell{
      width:100%;
      max-width:1024px;
      background:linear-gradient(145deg,rgba(9,12,30,.96),rgba(7,10,26,.98));
      border-radius:26px;
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.04);
      padding:22px 18px 26px;
      position:relative;
      overflow:hidden;
    }
    .shell::before{
      content:"";
      position:absolute;
      inset:-120px;
      background:
        radial-gradient(circle at 0 0,rgba(244,201,107,.18) 0,transparent 55%),
        radial-gradient(circle at 120% 20%,rgba(122,197,255,.22) 0,transparent 55%);
      opacity:.8;
      pointer-events:none;
      mix-blend-mode:screen;
    }
    .shell-inner{
      position:relative;
      z-index:1;
    }
    header{
      display:flex;
      flex-wrap:wrap;
      gap:6px 18px;
      justify-content:space-between;
      align-items:flex-end;
      margin-bottom:18px;
    }
    .title-block h1{
      font-size:18px;
      letter-spacing:.06em;
      margin:0;
      color:var(--accent);
    }
    .title-sub{
      margin-top:4px;
      font-size:11px;
      color:var(--sub);
    }
    .badge-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:8px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      font-size:10px;
      letter-spacing:.04em;
      text-transform:uppercase;
      border:1px solid rgba(244,201,107,.45);
      background:rgba(10,10,16,.7);
      backdrop-filter:blur(10px);
    }
    .pill span.icon{
      font-size:11px;
    }
    main{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    section.panel{
      background:radial-gradient(circle at 0 0,rgba(255,255,255,.04) 0,transparent 45%),
                 radial-gradient(circle at 120% 0,rgba(75,139,255,.12) 0,transparent 45%),
                 var(--panel);
      border-radius:var(--radius);
      border:1px solid var(--border);
      padding:14px 14px 16px;
      position:relative;
      overflow:hidden;
    }
    section.panel h2{
      margin:0 0 10px;
      font-size:13px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--sub);
    }
    section.panel h2 strong{
      color:var(--accent);
      font-weight:700;
    }
    .panel-caption{
      font-size:11px;
      color:var(--sub);
      margin-bottom:10px;
    }
    .grid{
      display:grid;
      grid-template-columns:1.15fr 1.7fr;
      gap:12px;
    }
    @media (max-width:768px){
      .shell{padding:20px 12px 20px;border-radius:0;}
      .grid{grid-template-columns:1fr;}
    }
    label{
      display:block;
      font-size:11px;
      color:var(--sub);
      margin-bottom:4px;
    }
    input[type="text"],
    input[type="number"],
    input[type="password"],
    textarea,
    select{
      width:100%;
      background:rgba(5,8,20,.9);
      border-radius:11px;
      border:1px solid rgba(255,255,255,.16);
      padding:7px 9px;
      font-size:12px;
      color:var(--ink);
      outline:none;
    }
    textarea{min-height:72px;resize:vertical;}
    input:focus,
    textarea:focus,
    select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(244,201,107,.4);
    }
    input[type="file"]{
      font-size:11px;
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .row.stretch > *{flex:1;}
    .hint{
      font-size:10px;
      color:var(--sub);
      margin-top:3px;
    }
    .btn{
      border-radius:999px;
      border:none;
      padding:7px 14px;
      font-size:12px;
      font-weight:600;
      letter-spacing:.06em;
      text-transform:uppercase;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition:transform .08s ease,box-shadow .08s ease,background .12s ease;
      white-space:nowrap;
    }
    .btn-primary{
      background:linear-gradient(120deg,#f4c96b,#ffdf9c);
      color:#2a1904;
      box-shadow:0 12px 30px rgba(0,0,0,.65);
    }
    .btn-primary:active{
      transform:translateY(1px) scale(.99);
      box-shadow:0 4px 14px rgba(0,0,0,.7);
    }
    .btn-ghost{
      background:rgba(8,10,22,.9);
      color:var(--sub);
      border:1px solid rgba(255,255,255,.18);
    }
    .btn-ghost:active{
      transform:translateY(1px) scale(.99);
    }
    .btn-danger{
      background:rgba(255,90,122,.1);
      border:1px solid var(--danger);
      color:#ffd6df;
    }
    .pill-mini{
      display:inline-flex;
      align-items:center;
      padding:3px 8px;
      border-radius:999px;
      font-size:10px;
      border:1px solid rgba(255,255,255,.16);
      color:var(--sub);
      gap:4px;
    }
    .status-bar{
      margin-top:10px;
      padding:7px 9px;
      border-radius:11px;
      font-size:11px;
      line-height:1.5;
      background:rgba(5,10,30,.94);
      border:1px solid rgba(255,255,255,.12);
      display:flex;
      gap:8px;
      align-items:flex-start;
      white-space:pre-line;
    }
    .status-bar strong{
      font-weight:600;
    }
    .status-icon{
      font-size:13px;
      margin-top:1px;
    }
    .status-ok{
      border-color:rgba(107,230,168,.7);
      background:radial-gradient(circle at 0 0,rgba(107,230,168,.25),transparent 55%),rgba(8,16,26,.96);
    }
    .status-error{
      border-color:rgba(255,90,122,.8);
      background:radial-gradient(circle at 0 0,rgba(255,90,122,.24),transparent 55%),rgba(16,8,14,.96);
    }
    .status-neutral{
      opacity:.9;
    }
    footer{
      margin-top:12px;
      font-size:10px;
      color:var(--sub);
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    footer span.emph{
      color:var(--accent);
    }
    .mono{font-family:var(--mono);}
    .pill-tabs{
      display:inline-flex;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      overflow:hidden;
      background:rgba(6,8,22,.9);
    }
    .pill-tabs button{
      border:none;
      background:none;
      padding:5px 10px;
      font-size:11px;
      color:var(--sub);
      cursor:pointer;
    }
    .pill-tabs button.active{
      background:var(--accent-soft);
      color:var(--accent);
      font-weight:600;
    }
    .divider{
      height:1px;
      margin:12px 0 10px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.26),transparent);
      opacity:.5;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="shell-inner">
      <header>
        <div class="title-block">
          <h1>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.29</h1>
          <div class="title-sub">
            Works(100) ìë™ ê´€ë¦¬ Â· DCAR ë¯¸í•™ ë³´ê³ ì„œ íŒŒì¼ì€ ìœ ì§€ Â· GitHub Pages ì—°ë™
          </div>
          <div class="badge-row">
            <div class="pill"><span class="icon">âš™ï¸</span><span>Auto GitHub Manager</span></div>
            <div class="pill"><span class="icon">ğŸ–¼</span><span>Works JSON êµ¬ì¡° ê³ ì •</span></div>
            <div class="pill"><span class="icon">ğŸ“„</span><span>DCAR Reports Â· Untouched</span></div>
          </div>
        </div>
        <div>
          <div class="pill-tabs">
            <button type="button" class="active" id="tab-works">Works</button>
            <button type="button" disabled>DCAR (ê³ ì •)</button>
          </div>
        </div>
      </header>

      <main>
        <!-- I. GitHub ì„¤ì • -->
        <section class="panel" id="panel-github">
          <h2><strong>I.</strong> GitHub ì—°ê²° ì„¤ì •</h2>
          <p class="panel-caption">
            ì•„ë˜ ê°’ì€ ë¸Œë¼ìš°ì € <span class="mono">localStorage</span>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.  
            í•œë²ˆ ì„¤ì •í•˜ë©´ ì´í›„ì—ëŠ” ë‹¤ì‹œ ì…ë ¥í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
          </p>
          <div class="grid">
            <div>
              <label for="ghOwner">GitHub Owner</label>
              <input id="ghOwner" type="text" placeholder="ì˜ˆ: dungzakcestlavie">

              <label for="ghRepo" style="margin-top:8px;">Repository</label>
              <input id="ghRepo" type="text" placeholder="ì˜ˆ: dungzakcestlavie.github.io">

              <label for="ghBranch" style="margin-top:8px;">Branch</label>
              <input id="ghBranch" type="text" value="main">
            </div>
            <div>
              <label for="ghToken">Personal Access Token</label>
              <input id="ghToken" type="password" autocomplete="off"
                placeholder="github_pat_ë¡œ ì‹œì‘í•˜ëŠ” í† í°ì„ ì…ë ¥í•˜ì„¸ìš”">
              <div class="hint">
                Â· ì´ í† í°ì€ <strong>ë¸Œë¼ìš°ì € ì•ˆì—ë§Œ ì €ì¥</strong>ë˜ë©°, ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                Â· ë ˆí¬ì§€í† ë¦¬ <span class="mono">contents</span> ê¶Œí•œë§Œ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤.
              </div>
              <div style="margin-top:10px;" class="row">
                <button type="button" class="btn btn-primary" id="btnSaveSettings">ì„¤ì • ì €ì¥</button>
                <button type="button" class="btn btn-ghost" id="btnLoadSettings">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button type="button" class="btn btn-danger" id="btnResetSettings">ì´ˆê¸°í™”</button>
              </div>
            </div>
          </div>
          <div id="status-settings" class="status-bar status-neutral" aria-live="polite">
            <div class="status-icon">â„¹ï¸</div>
            <div>
              <strong>ì•Œë¦¼</strong> GitHub ì„¤ì •ì„ ì €ì¥í•œ í›„ ì‘í’ˆ ì—…ë¡œë“œë¥¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.
            </div>
          </div>
        </section>

        <!-- II. ì‘í’ˆ ì—…ë¡œë“œ / ë©”íƒ€ë°ì´í„° ìë™ ê´€ë¦¬ -->
        <section class="panel" id="panel-works">
          <h2><strong>II.</strong> ì‘í’ˆ ì—…ë¡œë“œ Â· ë©”íƒ€ë°ì´í„° ìë™ ê´€ë¦¬</h2>
          <p class="panel-caption">
            í•œ ë²ˆì— 1ì ì”© ì—…ë¡œë“œí•©ë‹ˆë‹¤. ì´ë¯¸ì§€ëŠ” <span class="mono">/images/zoom/DZ-XXX.jpg</span>ë¡œ ì €ì¥ë˜ê³ ,  
            <span class="mono">data/works.json</span>ì— ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.
          </p>

          <div class="grid">
            <!-- ì™¼ìª½: íŒŒì¼ + ì„¹ì…˜ ì„ íƒ -->
            <div>
              <label for="workFile">ì‘í’ˆ ì´ë¯¸ì§€ íŒŒì¼</label>
              <input id="workFile" type="file" accept="image/*">
              <div class="hint">
                Â· ê°€ê¸‰ì  3000px ì´ìƒ JPG ì‚¬ìš©<br>
                Â· íŒŒì¼ ì´ë¦„ì€ ìë™ìœ¼ë¡œ <span class="mono">DZ-XXX.jpg</span>ë¡œ ì •ë¦¬ë©ë‹ˆë‹¤.
              </div>

              <label for="workSection" style="margin-top:10px;">ì„¹ì…˜ ì„ íƒ (Section)</label>
              <select id="workSection">
                <option value="I ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” Â· Pray for Us">I ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” Â· Pray for Us</option>
                <option value="II ì¸ê°„ Â· Human Being">II ì¸ê°„ Â· Human Being</option>
                <option value="III ì •ì‹ ì˜ ì¬íƒ„ìƒ Â· Rebirth of Mind">III ì •ì‹ ì˜ ì¬íƒ„ìƒ Â· Rebirth of Mind</option>
                <option value="IV ì¡´ì¬ì˜ íšŒë³µ Â· Restoration of Being">IV ì¡´ì¬ì˜ íšŒë³µ Â· Restoration of Being</option>
                <option value="V ë¹›ì˜ ì´ˆì˜ì‹ Â· Metaconsciousness of Light">V ë¹›ì˜ ì´ˆì˜ì‹ Â· Metaconsciousness of Light</option>
              </select>
              <div class="hint">
                Â· ì„¹ì…˜ ì´ë¦„ì€ ì‚¬ì´íŠ¸ Works ì„¹ì…˜ êµ¬ì¡°ì™€ ì™„ì „íˆ ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.
              </div>

              <div class="divider"></div>

              <div class="pill-mini">
                <span>ë‹¤ìŒ ì‘í’ˆ ID / íŒŒì¼ëª… ë¯¸ë¦¬ë³´ê¸°:</span>
                <span class="mono" id="nextIdPreview">DZ-???</span>
              </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ë©”íƒ€ë°ì´í„° -->
            <div>
              <div class="row stretch">
                <div>
                  <label for="titleKo">ì‘í’ˆëª… (KO)</label>
                  <input id="titleKo" type="text" placeholder="ì˜ˆ: ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš”">
                </div>
                <div>
                  <label for="titleEn">Title (EN)</label>
                  <input id="titleEn" type="text" placeholder="ì˜ˆ: Pray for Us">
                </div>
              </div>

              <div class="row stretch" style="margin-top:8px;">
                <div>
                  <label for="materialKo">ì¬ë£Œ (KO)</label>
                  <input id="materialKo" type="text" placeholder="ì˜ˆ: ìº”ë²„ìŠ¤ì— ì•„í¬ë¦´">
                </div>
                <div>
                  <label for="materialEn">Material (EN Â· ì†Œë¬¸ì)</label>
                  <input id="materialEn" type="text" placeholder="ì˜ˆ: acrylic on canvas">
                </div>
              </div>

              <div class="row stretch" style="margin-top:8px;">
                <div>
                  <label for="sizeKo">í¬ê¸° (KO)</label>
                  <input id="sizeKo" type="text" placeholder="ì˜ˆ: 162.2 Ã— 130.3 cm">
                </div>
                <div>
                  <label for="sizeEn">Size (EN)</label>
                  <input id="sizeEn" type="text" placeholder="ì˜ˆ: 162.2 Ã— 130.3 cm">
                </div>
              </div>

              <div class="row" style="margin-top:8px%;">
                <div style="flex:0 0 120px;">
                  <label for="year">ì œì‘ë…„ë„ (Year)</label>
                  <input id="year" type="number" min="1900" max="2100" value="2025">
                </div>
                <div style="flex:1;">
                  <label for="note">ë¹„ê³  / ë‚´ë¶€ ë©”ëª¨ (ì„ íƒ)</label>
                  <input id="note" type="text" placeholder="ì˜ˆ: êµ¬êµ¬ê°¤ëŸ¬ë¦¬ ì¶œí’ˆì‘, ì¸ì²œì•„íŠ¸ì‡¼ ë“±">
                </div>
              </div>

              <div style="margin-top:12px;" class="row">
                <button type="button" class="btn btn-primary" id="btnUploadWork">ì‘í’ˆ ì—…ë¡œë“œ</button>
                <button type="button" class="btn btn-ghost" id="btnDryRun">ë¯¸ë¦¬ë³´ê¸° (Dry Run)</button>
              </div>
            </div>
          </div>

          <div id="status-works" class="status-bar status-neutral" aria-live="polite">
            <div class="status-icon">ğŸŒ™</div>
            <div>
              <strong>ëŒ€ê¸° ì¤‘</strong> ì‘í’ˆì„ ì„ íƒí•˜ê³  ë©”íƒ€ë°ì´í„°ë¥¼ ì…ë ¥í•œ í›„  
              <strong>â€˜ì‘í’ˆ ì—…ë¡œë“œâ€™</strong>ë¥¼ ëˆ„ë¥´ë©´, ì´ë¯¸ì§€ì™€ <span class="mono">works.json</span>ì´ ìë™ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
            </div>
          </div>
        </section>

        <!-- III. DCAR ì•ˆë‚´ (êµ¬ì¡°ëŠ” ìœ ì§€, ì½”ë“œ ë³€ê²½ ì—†ìŒ) -->
        <section class="panel" id="panel-dcar">
          <h2><strong>III.</strong> DCAR ë¯¸í•™ ë³´ê³ ì„œ â€” êµ¬ì¡° ìœ ì§€ ì•ˆë‚´</h2>
          <p class="panel-caption">
            DCAR ë¯¸í•™ ë³´ê³ ì„œ(í…ìŠ¤íŠ¸, PDF, ë§ˆí¬ë‹¤ìš´ ë“±)ëŠ” ê¸°ì¡´ êµ¬ì¡°ë¥¼ <strong>ê·¸ëŒ€ë¡œ ìœ ì§€</strong>í•©ë‹ˆë‹¤.<br>
            ì´ Admin Î©.29ëŠ” <strong>ì‘í’ˆ(Works)ë§Œ</strong> ìë™ ê´€ë¦¬í•˜ë©°, DCAR íŒŒì¼ë“¤ì€ ìˆ˜ì •í•˜ê±°ë‚˜ ì¬êµ¬ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </p>
          <div class="status-bar status-neutral">
            <div class="status-icon">ğŸ“š</div>
            <div>
              <strong>ê³ ì • ê·œì¹™</strong>  
              Â· DCAR-01 ~ DCAR-09 ë° ì´í›„ ë³´ê³ ì„œë“¤ì˜ <strong>í…ìŠ¤íŠ¸ì™€ íŒŒì¼ êµ¬ì¡°ëŠ” ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŒ</strong>  
              Â· Index(Homepage)ëŠ” ê¸°ì¡´ DCAR ë¡œë”© ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©  
              Â· Adminì—ì„œ DCAR ê´€ë ¨ ìë™ í¸ì§‘ ê¸°ëŠ¥ì€ ì œê³µí•˜ì§€ ì•Šê³ , í•„ìš” ì‹œ ìˆ˜ë™ ì»¤ë°‹ìœ¼ë¡œë§Œ ê´€ë¦¬
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div>Â© ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· <span class="emph">Works Admin Î©.29 v52</span></div>
        <div>Orchestrated with Lumera â€” Light Â· Memory Â· Being.</div>
      </footer>
    </div>
  </div>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
  /********************************************
   * ê³µí†µ ìœ í‹¸
   ********************************************/
  const $ = (id) => document.getElementById(id);

  function setStatus(el, kind, icon, message){
    el.classList.remove("status-ok","status-error","status-neutral");
    if(kind === "ok") el.classList.add("status-ok");
    else if(kind === "error") el.classList.add("status-error");
    else el.classList.add("status-neutral");
    el.querySelector(".status-icon").textContent = icon;
    el.querySelector("div:nth-child(2)").innerHTML = message;
  }

  // UTF-8 ë¬¸ìì—´ì„ base64ë¡œ ì¸ì½”ë”©
  function encodeBase64(str){
    return btoa(unescape(encodeURIComponent(str)));
  }
  // base64 â†’ UTF-8
  function decodeBase64(str){
    return decodeURIComponent(escape(atob(str)));
  }

  /********************************************
   * GitHub ì„¤ì • ë¡œë“œ/ì €ì¥
   ********************************************/
  const LS_KEY = "dungzak_admin_github";

  function loadSettings(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      const cfg = JSON.parse(raw);
      $("ghOwner").value  = cfg.owner || "";
      $("ghRepo").value   = cfg.repo || "";
      $("ghBranch").value = cfg.branch || "main";
      $("ghToken").value  = cfg.token || "";
      setStatus($("status-settings"), "ok", "âœ…",
        "<strong>ì™„ë£Œ</strong> ì €ì¥ëœ GitHub ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
    }catch(e){
      console.error(e);
    }
  }

  function saveSettings(){
    const owner  = $("ghOwner").value.trim();
    const repo   = $("ghRepo").value.trim();
    const branch = $("ghBranch").value.trim() || "main";
    const token  = $("ghToken").value.trim();

    if(!owner || !repo || !branch || !token){
      setStatus($("status-settings"), "error", "âš ï¸",
        "<strong>ì˜¤ë¥˜</strong> Owner / Repository / Branch / Tokenì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      return;
    }

    const cfg = {owner, repo, branch, token};
    localStorage.setItem(LS_KEY, JSON.stringify(cfg));
    setStatus($("status-settings"), "ok", "âœ…",
      "<strong>ì €ì¥ë¨</strong> GitHub ì„¤ì •ì´ ë¸Œë¼ìš°ì €ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }

  function resetSettings(){
    localStorage.removeItem(LS_KEY);
    $("ghOwner").value  = "";
    $("ghRepo").value   = "";
    $("ghBranch").value = "main";
    $("ghToken").value  = "";
    setStatus($("status-settings"), "neutral", "â„¹ï¸",
      "<strong>ì´ˆê¸°í™”</strong> GitHub ì„¤ì •ì´ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
  }

  $("btnSaveSettings").addEventListener("click", saveSettings);
  $("btnLoadSettings").addEventListener("click", loadSettings);
  $("btnResetSettings").addEventListener("click", resetSettings);

  // ì´ˆê¸° ë¡œë“œ
  loadSettings();

  /********************************************
   * GitHub API ë˜í¼
   ********************************************/
  function getConfig(){
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return null;
    try{return JSON.parse(raw);}catch(e){return null;}
  }

  async function ghFetch(path, options = {}){
    const cfg = getConfig();
    if(!cfg){
      throw new Error("GitHub ì„¤ì •ì„ ë¨¼ì € ì €ì¥í•´ ì£¼ì„¸ìš”.");
    }
    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/${path}`;
    const headers = {
      "Accept":"application/vnd.github+json",
      "Authorization":`Bearer ${cfg.token}`
    };
    if(options.method && options.method !== "GET"){
      headers["Content-Type"] = "application/json";
    }
    const res = await fetch(url, {...options, headers});
    if(!res.ok){
      const text = await res.text();
      throw new Error(\`GitHub ì˜¤ë¥˜ (\${res.status}) : \${text}\`);
    }
    return res.json();
  }

  /********************************************
   * works.json í—¬í¼
   * êµ¬ì¡°:
   * {
   *   "I ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” Â· Pray for Us": [ {..ì‘í’ˆ..}, ... ],
   *   "II ì¸ê°„ Â· Human Being": [],
   *   ...
   * }
   ********************************************/
  const SECTION_KEYS = [
    "I ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” Â· Pray for Us",
    "II ì¸ê°„ Â· Human Being",
    "III ì •ì‹ ì˜ ì¬íƒ„ìƒ Â· Rebirth of Mind",
    "IV ì¡´ì¬ì˜ íšŒë³µ Â· Restoration of Being",
    "V ë¹›ì˜ ì´ˆì˜ì‹ Â· Metaconsciousness of Light"
  ];

  async function loadWorksJson(){
    try{
      const data = await ghFetch("contents/data/works.json");
      const jsonStr = decodeBase64(data.content);
      const parsed = JSON.parse(jsonStr);
      return {json: parsed, sha: data.sha};
    }catch(e){
      // íŒŒì¼ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ êµ¬ì¡°ë¡œ ìƒˆë¡œ ìƒì„±
      const base = {};
      SECTION_KEYS.forEach(k => base[k] = []);
      return {json: base, sha: null};
    }
  }

  function getNextIdFromWorks(worksJson){
    let max = 0;
    for(const key of Object.keys(worksJson)){
      const arr = worksJson[key] || [];
      arr.forEach(w=>{
        const m = String(w.id || "").match(/DZ-(\d+)/);
        if(m){
          const num = parseInt(m[1],10);
          if(num > max) max = num;
        }
      });
    }
    const next = max + 1;
    return "DZ-" + String(next).padStart(3,"0");
  }

  async function refreshNextIdPreview(){
    try{
      const {json} = await loadWorksJson();
      const nextId = getNextIdFromWorks(json);
      $("nextIdPreview").textContent = nextId + ".jpg";
    }catch(e){
      console.error(e);
      $("nextIdPreview").textContent = "DZ-???";
    }
  }
  refreshNextIdPreview();

  /********************************************
   * ì´ë¯¸ì§€ íŒŒì¼ â†’ base64 (ë³¸ë¬¸ë§Œ)
   ********************************************/
  function fileToBase64(file){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = () => {
        const res = reader.result;
        const base64 = String(res).split(",")[1]; // data:*/*;base64, ì´í›„ ë¶€ë¶„
        resolve(base64);
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  /********************************************
   * ì‘í’ˆ ì—…ë¡œë“œ ë©”ì¸ ë¡œì§
   ********************************************/
  let isUploading = false;

  $("btnUploadWork").addEventListener("click", async () => {
    if(isUploading) return;
    isUploading = true;

    const statusEl = $("status-works");
    setStatus(statusEl, "neutral", "ğŸŒ˜",
      "<strong>ì§„í–‰ ì¤‘</strong> GitHubì— ì´ë¯¸ì§€ì™€ works.jsonì„ ì—…ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...");

    try{
      const cfg = getConfig();
      if(!cfg) throw new Error("ë¨¼ì € GitHub ì„¤ì •ì„ ì €ì¥í•´ ì£¼ì„¸ìš”.");

      const file = $("workFile").files[0];
      if(!file) throw new Error("ì‘í’ˆ ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");

      const sectionKey = $("workSection").value;
      const titleKo = $("titleKo").value.trim();
      const titleEn = $("titleEn").value.trim();
      const materialKo = $("materialKo").value.trim();
      let materialEn = $("materialEn").value.trim();
      const sizeKo = $("sizeKo").value.trim();
      const sizeEn = $("sizeEn").value.trim();
      const year = $("year").value.trim();
      const note = $("note").value.trim();

      if(!titleKo || !titleEn || !materialKo || !materialEn || !sizeKo || !sizeEn || !year){
        throw new Error("ì‘í’ˆëª…, ì¬ë£Œ, í¬ê¸°, ì œì‘ì—°ë„ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      }

      // material_enì€ í•­ìƒ ì†Œë¬¸ìë¡œ
      materialEn = materialEn.toLowerCase();

      // 1) ê¸°ì¡´ works.json ë¶ˆëŸ¬ì˜¤ê¸° ë° ë‹¤ìŒ ID ê³„ì‚°
      const {json: worksJson, sha: worksSha} = await loadWorksJson();
      const nextId = getNextIdFromWorks(worksJson);
      const fileName = \`\${nextId}.jpg\`;
      const imagePath = \`images/zoom/\${fileName}\`;

      // 2) ì´ë¯¸ì§€ GitHub ì—…ë¡œë“œ
      const imgBase64 = await fileToBase64(file);
      await ghFetch(\`contents/\${imagePath}\`,{
        method:"PUT",
        body:JSON.stringify({
          message:\`Add image \${fileName}\`,
          content:imgBase64,
          branch:cfg.branch
        })
      });

      // 3) works.json ê°±ì‹ 
      if(!worksJson[sectionKey]) worksJson[sectionKey] = [];

      const newWork = {
        id: nextId,
        title_kr: titleKo,
        title_en: titleEn,
        material_ko: materialKo,
        material_en: materialEn,
        size_ko: sizeKo,
        size_en: sizeEn,
        year: year,
        image: \`/\${imagePath}\`,
        zoom: \`/\${imagePath}\`,
        note: note
      };

      worksJson[sectionKey].push(newWork);

      const newJsonStr = JSON.stringify(worksJson,null,2);
      const encoded = encodeBase64(newJsonStr);

      const body = {
        message:\`Update works.json â€” add \${nextId}\`,
        content: encoded,
        branch: cfg.branch
      };
      if(worksSha) body.sha = worksSha;

      await ghFetch("contents/data/works.json",{
        method:"PUT",
        body:JSON.stringify(body)
      });

      setStatus(statusEl,"ok","âœ¨",
        "<strong>ì™„ë£Œ</strong> ì‘í’ˆì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.<br>" +
        "Â· ID: <span class='mono'>" + nextId + "</span><br>" +
        "Â· ì´ë¯¸ì§€: <span class='mono'>/" + imagePath + "</span><br>" +
        "Â· ì„¹ì…˜: " + sectionKey + "<br><br>" +
        "GitHub Pages ë¹Œë“œê°€ ì™„ë£Œë˜ë©´ í™ˆí˜ì´ì§€ Worksì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.");

      // í¼ ì´ˆê¸°í™” ì¼ë¶€
      $("workFile")..value = "";
      $("titleKo").value = "";
      $("titleEn").value = "";
      $("materialKo").value = "";
      $("materialEn").value = "";
      $("sizeKo").value = "";
      $("sizeEn").value = "";
      $("note").value = "";

      refreshNextIdPreview();
    }catch(err){
      console.error(err);
      setStatus($("status-works"),"error","âš ï¸",
        "<strong>ì—…ë¡œë“œ ì‹¤íŒ¨</strong> " + (err.message || err));
    }finally{
      isUploading = false;
    }
  });

  /********************************************
   * Dry Run: ì‹¤ì œ ì—…ë¡œë“œ ì—†ì´ JSON êµ¬ì¡° ë¯¸ë¦¬ë³´ê¸°
   ********************************************/
  $("btnDryRun").addEventListener("click", async () => {
    const statusEl = $("status-works");
    try{
      const {json} = await loadWorksJson();
      const nextId = getNextIdFromWorks(json);

      const sectionKey = $("workSection").value;
      const titleKo = $("titleKo").value.trim() || "ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš”";
      const titleEn = $("titleEn").value.trim() || "Pray for Us";
      const materialKo = $("materialKo").value.trim() || "ìº”ë²„ìŠ¤ì— ì•„í¬ë¦´";
      const sizeKo = $("sizeKo").value.trim() || "162.2 Ã— 130.3 cm";
      const sizeEn = $("sizeEn").value.trim() || "162.2 Ã— 130.3 cm";
      const year = $("year").value.trim() || "2025";

      const materialEn = ( $("materialEn").value.trim() || "acrylic on canvas" ).toLowerCase();

      const sample = {
        id: nextId,
        title_kr: titleKo,
        title_en: titleEn,
        material_ko: materialKo,
        material_en: materialEn,
        size_ko: sizeKo,
        size_en: sizeEn,
        year: year,
        image: "/images/zoom/" + nextId + ".jpg",
        zoom: "/images/zoom/" + nextId + ".jpg"
      };

      const escaped = JSON.stringify(sample,null,2)
        .replace(/</g,"&lt;").replace(/>/g,"&gt;");

      setStatus(statusEl,"neutral","ğŸ”",
        "<strong>Dry Run</strong> ì‹¤ì œ ì—…ë¡œë“œ ì—†ì´ êµ¬ì¡°ë§Œ ë¯¸ë¦¬ ë´…ë‹ˆë‹¤.<br>" +
        "ì„¹ì…˜: " + sectionKey + "<br>" +
        "ì¶”ê°€ë  ê°ì²´ ì˜ˆì‹œ:<br>" +
        "<span class='mono'>" + escaped + "</span>");
    }catch(err){
      console.error(err);
      setStatus(statusEl,"error","âš ï¸",
        "<strong>ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨</strong> " + (err.message || err));
    }
  });

  /********************************************
   * íƒ­ UI (ì§€ê¸ˆì€ Worksë§Œ)
   ********************************************/
  $("tab-works").addEventListener("click", ()=>{
    $("tab-works").classList.add("active");
  });
  </script>
</body>
</html>