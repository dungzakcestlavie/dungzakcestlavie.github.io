<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUNGZAK CESTLAVIE — Report Manager</title>
<style>
  body {
    background: #0a0a0a;
    color: #e6e6e6;
    font-family: 'Pretendard', sans-serif;
    padding: 40px;
    line-height: 1.7;
  }
  h1 {
    font-size: 28px;
    color: #ffd86b;
    text-align: center;
    margin-bottom: 30px;
  }
  .upload-section {
    border: 1px solid #444;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
    background: #111;
  }
  label { display: block; margin: 10px 0 5px; color: #aaa; }
  input, textarea {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #333;
    background: #1a1a1a;
    color: #fff;
    font-size: 15px;
  }
  button {
    margin-top: 15px;
    background: #ffd86b;
    border: none;
    border-radius: 6px;
    padding: 10px 16px;
    cursor: pointer;
    color: #111;
    font-weight: bold;
  }
  .report-list {
    margin-top: 40px;
  }
  .report-item {
    border-bottom: 1px solid #333;
    padding: 15px 0;
  }
  .pdf-btn {
    background: #00c9a7;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    margin-left: 10px;
    cursor: pointer;
  }
</style>
</head>
<body>
  <h1>등작 燈酌 DUNGZAK CESTLAVIE — 미학 보고서 관리자</h1>

  <div class="upload-section">
    <h3>➕ 새 미학 보고서 업로드</h3>
    <label>Report ID</label>
    <input id="reportId" placeholder="예: dcar01">
    <label>Title (영문)</label>
    <input id="titleEn" placeholder="On Light, Memory, and Being">
    <label>Title (한글)</label>
    <input id="titleKo" placeholder="빛, 기억, 존재에 관하여">
    <label>Abstract</label>
    <textarea id="abstract" rows="4" placeholder="요약 내용을 입력하세요."></textarea>
    <label>Year</label>
    <input id="year" type="number" value="2025">
    <button onclick="saveReport()">Save Report</button>
  </div>

  <div class="report-list">
    <h3>📚 등록된 미학 보고서 목록</h3>
    <div id="reportList"></div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let reports = [];

async function loadReports() {
  const res = await fetch('../data/reports.json');
  const data = await res.json();
  reports = data.reports || [];
  renderReports();
}

function renderReports() {
  const list = document.getElementById('reportList');
  list.innerHTML = '';
  reports.forEach(r => {
    const div = document.createElement('div');
    div.className = 'report-item';
    div.innerHTML = `
      <strong>${r.id}</strong> · ${r.title_en}<br>
      ${r.title_ko}<br>
      <button class="pdf-btn" onclick="downloadPDF('${r.id}')">📄 PDF 다운로드</button>
    `;
    list.appendChild(div);
  });
}

async function saveReport() {
  const newReport = {
    id: document.getElementById('reportId').value.trim(),
    title_en: document.getElementById('titleEn').value.trim(),
    title_ko: document.getElementById('titleKo').value.trim(),
    abstract: document.getElementById('abstract').value.trim(),
    year: document.getElementById('year').value.trim()
  };
  reports.push(newReport);
  alert('✅ 보고서가 임시로 저장되었습니다. JSON 파일에 병합은 GitHub에서 수동 업데이트 필요합니다.');
  renderReports();
}

function downloadPDF(reportId) {
  const { jsPDF } = window.jspdf;
  const report = reports.find(r => r.id === reportId);
  if (!report) return alert('보고서를 찾을 수 없습니다.');
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  doc.setFontSize(18);
  doc.text(`DUNGZAK CESTLAVIE Aesthetic Report`, 40, 60);
  doc.setFontSize(14);
  doc.text(`ID: ${report.id}`, 40, 100);
  doc.text(`Title (EN): ${report.title_en}`, 40, 120);
  doc.text(`Title (KO): ${report.title_ko}`, 40, 140);
  doc.text(`Year: ${report.year}`, 40, 160);
  doc.setFontSize(12);
  doc.text(`Abstract:`, 40, 200);
  doc.text(report.abstract, 40, 220, { maxWidth: 500 });
  doc.save(`${report.id}.pdf`);
}
loadReports();
</script>
</body>
</html>
