<!doctype html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.20 â€” Reports Auto Manager</title>
<meta name="color-scheme" content="dark light">

<style>
:root{
  --bg:#0b1020; --panel:#111a37; --ink:#eaf0ff; --sub:#9faee6;
  --accent:#f4c96b; --accent-soft:rgba(244,201,107,0.16);
  --danger:#ff5c7a; --ok:#5dd39e; --border:#1f2750;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --sans:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",system-ui,sans-serif;
}

*{box-sizing:border-box;}

html,body{
  margin:0; padding:0;
  width:100%; height:100%;
  background:radial-gradient(circle at 10% 0%, #202c60 0, #050814 40%, #030510 100%);
  color:var(--ink);
  font-family:var(--sans);
}

body{
  -webkit-font-smoothing:antialiased;
  display:flex;
  justify-content:center;
  align-items:flex-start;
}

main{
  width:100%; max-width:1200px;
  padding:16px 12px 80px;
}

@media (min-width:768px){
  main{padding:24px 24px 96px;}
}

.hero-title{
  font-size:22px;
  font-weight:700;
  letter-spacing:.04em;
  color:var(--accent);
}
.hero-sub{
  margin-top:4px;
  font-size:13px;
  color:var(--sub);
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:3px 8px;
  border-radius:999px;
  border:1px solid rgba(244,201,107,0.5);
  background:rgba(0,0,0,.3);
  color:var(--accent);
  font-size:11px;
  margin-top:6px;
}

.grid{
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:16px;
}
@media (min-width:900px){
  .grid{
    display:grid;
    grid-template-columns:minmax(260px,320px) minmax(0,1fr);
    align-items:flex-start;
  }
}

.card{
  background:linear-gradient(145deg,rgba(17,26,55,0.95),rgba(5,9,30,0.98));
  border-radius:18px;
  border:1px solid var(--border);
  padding:14px 14px 16px;
  box-shadow:0 18px 40px rgba(0,0,0,0.55);
}

.card h2{
  font-size:15px;
  margin:0 0 8px;
}
.card p.helper{
  font-size:12px;
  color:var(--sub);
  margin:0 0 10px;
}

.field{
  margin-bottom:10px;
}
.field label{
  display:block;
  font-size:12px;
  margin-bottom:3px;
  color:var(--sub);
}
.field small{
  display:block;
  font-size:11px;
  color:var(--sub);
}
input,select,textarea{
  width:100%;
  border-radius:10px;
  border:1px solid #222a55;
  background:#050716;
  color:var(--ink);
  padding:7px 9px;
  font-size:13px;
  font-family:inherit;
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 1px rgba(244,201,107,0.3);
}
textarea{
  min-height:160px;
  resize:vertical;
}

.btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}
button{
  border-radius:999px;
  border:1px solid transparent;
  padding:7px 14px;
  font-size:13px;
  font-weight:500;
  cursor:pointer;
  background:var(--accent-soft);
  color:var(--accent);
}
button.primary{
  background:var(--accent);
  color:#050714;
}
button.subtle{
  background:transparent;
  border-color:#343c70;
  color:var(--sub);
}
button.danger{
  background:rgba(255,92,122,0.12);
  border-color:rgba(255,92,122,0.7);
  color:var(--danger);
}
button:disabled{
  opacity:0.5;
  cursor:default;
}

.status-bar{
  margin-top:10px;
  font-size:12px;
  padding:7px 9px;
  border-radius:999px;
  background:rgba(9,16,40,0.9);
  border:1px solid #202953;
  display:flex;
  align-items:center;
  gap:6px;
}
.status-dot{
  width:8px; height:8px; border-radius:50%;
  background:#666;
}
.status-bar.ok .status-dot{background:var(--ok);}
.status-bar.err .status-dot{background:var(--danger);}
.status-text{flex:1; color:var(--sub);}

.token-input{
  font-family:var(--mono);
  font-size:11px;
}

.list{
  border-radius:12px;
  border:1px solid #202953;
  background:rgba(2,5,20,0.7);
  max-height:360px;
  overflow:auto;
  margin-top:8px;
}
.list-item{
  padding:8px 10px;
  border-bottom:1px solid #151b3d;
  font-size:12px;
  display:flex;
  flex-direction:column;
  gap:2px;
}
.list-item:last-child{border-bottom:none;}
.list-item strong{
  font-size:13px;
}
.list-item span.meta{
  color:var(--sub);
}
.list-item button{
  margin-top:4px;
  align-self:flex-start;
  font-size:11px;
  padding:4px 10px;
}

.tag-pill{
  display:inline-flex;
  align-items:center;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid #343f7a;
  font-size:11px;
  color:var(--sub);
  margin-right:4px;
}

textarea.full-text{
  font-family:var(--mono);
  font-size:12px;
  line-height:1.5;
  white-space:pre-wrap;
}

/* mobile safe-area */
@supports(padding:max(0px)){
  body{
    padding-bottom:max(16px,env(safe-area-inset-bottom));
    padding-top:max(0px,env(safe-area-inset-top));
  }
}

/* prefers reduced motion */
@media (prefers-reduced-motion: reduce){
  *{scroll-behavior:auto !important; animation:none !important;transition:none !important;}
}
</style>
</head> <body>
<main>
  <header>
    <div class="hero-title">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.20</div>
    <div class="hero-sub">DCAR ë¯¸í•™ ë³´ê³ ì„œ Â· GitHub ìë™ ì—°ë™ Â· reports.json + Markdown ì™„ì „ ìë™ ê´€ë¦¬</div>
    <div class="badge">
      <span>âš™ï¸ GitHub Contents API</span>
      <span>reports/ + reports.json ìë™ ì—…ë°ì´íŠ¸</span>
    </div>
  </header>

  <section class="grid">
    <!-- ì™¼ìª½: GitHub ì—°ê²° & ë³´ê³ ì„œ ëª©ë¡ -->
    <section class="card">
      <h2>â… . GitHub ì—°ê²° & ë³´ê³ ì„œ ëª©ë¡</h2>
      <p class="helper">
        ì•„ë˜ ì„¤ì •ì€ í•œ ë²ˆë§Œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤. í† í°ì€ ë¸Œë¼ìš°ì € LocalStorageì—ë§Œ ì €ì¥ë˜ê³ , ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>

      <div class="field">
        <label>GitHub Owner</label>
        <input id="ownerInput" type="text" value="dungzakcestlavie" autocomplete="off">
      </div>

      <div class="field">
        <label>Repository</label>
        <input id="repoInput" type="text" value="dungzakcestlavie.github.io" autocomplete="off">
      </div>

      <div class="field">
        <label>Branch</label>
        <input id="branchInput" type="text" value="main" autocomplete="off">
      </div>

      <div class="field">
        <label>Personal Access Token (repo ê¶Œí•œ)</label>
        <input id="tokenInput" type="password" class="token-input" placeholder="ghp_...">
        <small>â€» GitHub &gt; Settings &gt; Developer settings &gt; Personal access tokens ì—ì„œ ìƒˆ í† í° ìƒì„± í›„ ì…ë ¥.</small>
      </div>

      <div class="btn-row">
        <button type="button" class="primary" id="btnSaveConfig">ğŸ” ì„¤ì • ì €ì¥</button>
        <button type="button" class="subtle" id="btnTestLoad">ğŸ“¥ GitHubì—ì„œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button type="button" class="danger" id="btnClearConfig">ì„¤ì •Â·í† í° ì´ˆê¸°í™”</button>
      </div>

      <div class="status-bar" id="statusBar">
        <div class="status-dot" id="statusDot"></div>
        <div class="status-text" id="statusText">ì¤€ë¹„ ì™„ë£Œ.</div>
      </div>

      <div style="margin-top:10px;font-size:12px;color:var(--sub);">
        <div class="tag-pill">JSON: <code>reports/reports.json</code></div>
        <div class="tag-pill">Markdown: <code>reports/DCAR-XX-2025.md</code></div>
      </div>

      <h3 style="margin-top:14px;font-size:13px;">ğŸ“š ì €ì¥ëœ ë³´ê³ ì„œ ëª©ë¡</h3>
      <div id="reportList" class="list">
        <!-- ë™ì  ìƒì„± -->
      </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: ë³´ê³ ì„œ í¸ì§‘ -->
    <section class="card">
      <h2>â…¡. ë³´ê³ ì„œ í¸ì§‘ / ìë™ ì €ì¥</h2>
      <p class="helper">
        Report IDëŠ” <strong>íŒŒì¼ ì´ë¦„</strong>ì…ë‹ˆë‹¤. ì˜ˆ: <code>DCAR-01-2025</code> â†’ <code>reports/DCAR-01-2025.md</code> ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
      </p>

      <div class="field">
        <label>Report ID (ì˜ˆ: DCAR-01-2025)</label>
        <input id="fieldId" type="text" placeholder="DCAR-01-2025">
      </div>

      <div class="field">
        <label>Category</label>
        <select id="fieldCategory">
          <option value="Theory">Theory</option>
          <option value="Archive">Archive</option>
          <option value="Practice">Practice</option>
        </select>
      </div>

      <div class="field">
        <label>Year</label>
        <input id="fieldYear" type="text" value="2025">
      </div>

      <div class="field">
        <label>Title (EN)</label>
        <input id="fieldTitleEn" type="text" placeholder="On Light, Memory, and Being">
      </div>

      <div class="field">
        <label>Title (KO)</label>
        <input id="fieldTitleKo" type="text" placeholder="ë¹›, ê¸°ì–µ, ì¡´ì¬ì— ê´€í•˜ì—¬">
      </div>

      <div class="field">
        <label>Summary (KO)</label>
        <textarea id="fieldSummaryKo" rows="2" placeholder="ìš”ì•½(í•œê¸€)ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
      </div>

      <div class="field">
        <label>Summary (EN)</label>
        <textarea id="fieldSummaryEn" rows="2" placeholder="Summary in English."></textarea>
      </div>

      <div class="field">
        <label>Full Text (KR/EN í˜¼ìš© Â· Markdown) â€” ì‹¤ì œ ë¯¸í•™ ë³´ê³ ì„œ ì›ë¬¸</label>
        <textarea id="fieldFullText" class="full-text" placeholder="ì—¬ê¸°ì— DCAR ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. (í•œì˜ í˜¼ìš© ê°€ëŠ¥)"></textarea>
      </div>

      <div class="btn-row">
        <button type="button" class="primary" id="btnSaveReport">ğŸ’¾ ë³´ê³ ì„œ ì €ì¥ (JSON + MD ìë™ ì—…ë¡œë“œ)</button>
        <button type="button" class="subtle" id="btnNewReport">ï¼‹ ìƒˆ ë³´ê³ ì„œ</button>
        <button type="button" class="subtle" id="btnReloadSelected">ì„ íƒëœ ë³´ê³ ì„œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      </div>

      <p class="helper" style="margin-top:10px;">
        ì €ì¥ ì‹œ ìˆœì„œ:
        <br>1) <code>reports/reports.json</code> ì„ ì—…ë°ì´íŠ¸
        <br>2) <code>reports/&lt;Report ID&gt;.md</code> ë¡œ ì „ë¬¸ í…ìŠ¤íŠ¸ ì €ì¥
      </p>
    </section>
  </section>
</main>

<script>
/* JSëŠ” ì•„ë˜ â‘¢ SCRIPT ë¸”ë¡ì— ì´ì–´ì§‘ë‹ˆë‹¤ */
</script>
</body>
</html> <script>
// ========== Admin Î©.20 â€” GitHub Auto Manager ==========

// DOM ì–»ê¸°
const ownerInput  = document.getElementById('ownerInput');
const repoInput   = document.getElementById('repoInput');
const branchInput = document.getElementById('branchInput');
const tokenInput  = document.getElementById('tokenInput');

const statusBar  = document.getElementById('statusBar');
const statusDot  = document.getElementById('statusDot');
const statusText = document.getElementById('statusText');

const reportListEl = document.getElementById('reportList');

// í¼ ìš”ì†Œ
const fieldId        = document.getElementById('fieldId');
const fieldCategory  = document.getElementById('fieldCategory');
const fieldYear      = document.getElementById('fieldYear');
const fieldTitleEn   = document.getElementById('fieldTitleEn');
const fieldTitleKo   = document.getElementById('fieldTitleKo');
const fieldSummaryKo = document.getElementById('fieldSummaryKo');
const fieldSummaryEn = document.getElementById('fieldSummaryEn');
const fieldFullText  = document.getElementById('fieldFullText');

const btnSaveConfig    = document.getElementById('btnSaveConfig');
const btnTestLoad      = document.getElementById('btnTestLoad');
const btnClearConfig   = document.getElementById('btnClearConfig');
const btnSaveReport    = document.getElementById('btnSaveReport');
const btnNewReport     = document.getElementById('btnNewReport');
const btnReloadSelected= document.getElementById('btnReloadSelected');

const REPORTS_JSON_PATH = 'reports/reports.json';

let reportsData = { reports: [] };
let reportsJsonSha = null;
let currentReportId = null;

// ---------- ìœ í‹¸ ----------

function setStatus(msg, type='info'){
  statusText.textContent = msg;
  statusBar.classList.remove('ok','err');
  if(type === 'ok') statusBar.classList.add('ok');
  if(type === 'err') statusBar.classList.add('err');
}

function getConfig(){
  return {
    owner: ownerInput.value.trim(),
    repo: repoInput.value.trim(),
    branch: branchInput.value.trim(),
    token: tokenInput.value.trim()
  };
}

function saveConfigToLocal(){
  const cfg = getConfig();
  localStorage.setItem('dz_admin_cfg', JSON.stringify({
    owner: cfg.owner, repo: cfg.repo, branch: cfg.branch
  }));
  if(cfg.token){
    localStorage.setItem('dz_admin_token', cfg.token);
  }
  setStatus('ì„¤ì •ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤. ì´ì œ GitHubì—ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.','ok');
}

function loadConfigFromLocal(){
  try{
    const rawCfg   = localStorage.getItem('dz_admin_cfg');
    const rawToken = localStorage.getItem('dz_admin_token');
    if(rawCfg){
      const cfg = JSON.parse(rawCfg);
      if(cfg.owner)  ownerInput.value  = cfg.owner;
      if(cfg.repo)   repoInput.value   = cfg.repo;
      if(cfg.branch) branchInput.value = cfg.branch;
    }
    if(rawToken){
      tokenInput.value = rawToken;
    }
  }catch(e){
    console.error(e);
  }
}

function clearConfig(){
  localStorage.removeItem('dz_admin_cfg');
  localStorage.removeItem('dz_admin_token');
  tokenInput.value = '';
  setStatus('ì €ì¥ëœ ì„¤ì •ê³¼ í† í°ì„ ëª¨ë‘ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.','ok');
}

function encodeBase64(str){
  return btoa(unescape(encodeURIComponent(str)));
}

function decodeBase64(str){
  return decodeURIComponent(escape(atob(str)));
}

// GitHub API í˜¸ì¶œ
async function ghFetch(path, options = {}){
  const {owner, repo, branch, token} = getConfig();
  if(!owner || !repo || !branch || !token){
    throw new Error('GitHub ì„¤ì •ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. Owner, Repo, Branch, Tokenì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
  }

  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`;

  const headers = Object.assign({
    'Accept':'application/vnd.github+json',
    'Authorization':`Bearer ${token}`
  }, options.headers || {});

  const res = await fetch(url, Object.assign({}, options, {headers}));
  return res;
}

// ---------- reports.json ë¡œë“œ / ì €ì¥ ----------

async function loadReportsJson(){
  setStatus('GitHubì—ì„œ reports.json ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
  reportsJsonSha = null;

  try{
    const res = await ghFetch(REPORTS_JSON_PATH, { method:'GET' });

    if(res.status === 404){
      // ìƒˆë¡œ ì‹œì‘
      reportsData = { reports: [] };
      reportsJsonSha = null;
      setStatus('reports.json ì´ ì•„ì§ ì—†ì–´ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤.','ok');
      renderReportList();
      return;
    }

    if(!res.ok){
      const err = await res.json().catch(()=>({}));
      throw new Error('reports.json ë¡œë“œ ì‹¤íŒ¨: ' + (err.message || res.status));
    }

    const data = await res.json();
    const content = decodeBase64(data.content.replace(/\n/g,''));
    reportsData = JSON.parse(content || '{"reports":[]}');
    if(!Array.isArray(reportsData.reports)){
      reportsData = { reports: [] };
    }
    reportsJsonSha = data.sha;
    setStatus(`reports.json ë¡œë“œ ì„±ê³µ (${reportsData.reports.length}ê°œ).`,'ok');
    renderReportList();
  }catch(e){
    console.error(e);
    setStatus(e.message || 'reports.json ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ','err');
  }
}

async function saveReportsJson(){
  const cfg = getConfig();
  const bodyObj = {
    path: REPORTS_JSON_PATH,
    message: 'Update reports.json via Admin Î©.20',
    content: encodeBase64(JSON.stringify(reportsData,null,2)),
    branch: cfg.branch
  };
  if(reportsJsonSha){
    bodyObj.sha = reportsJsonSha;
  }

  setStatus('reports.json GitHubì— ì €ì¥ ì¤‘â€¦');

  const res = await fetch(`https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent(REPORTS_JSON_PATH)}`, {
    method:'PUT',
    headers:{
      'Accept':'application/vnd.github+json',
      'Authorization':`Bearer ${cfg.token}`,
      'Content-Type':'application/json'
    },
    body: JSON.stringify(bodyObj)
  });

  if(!res.ok){
    const err = await res.json().catch(()=>({}));
    throw new Error('reports.json ì €ì¥ ì‹¤íŒ¨: ' + (err.message || res.status));
  }

  const data = await res.json();
  reportsJsonSha = data.content && data.content.sha || reportsJsonSha;
  setStatus('reports.json ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.','ok');
}

// ---------- Markdown (.md) ë¡œë“œ / ì €ì¥ ----------

async function loadMarkdownForId(reportId){
  const mdPath = `reports/${reportId}.md`;
  setStatus(`${mdPath} ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦`);

  const res = await ghFetch(mdPath, { method:'GET' });

  if(res.status === 404){
    setStatus(`${mdPath} ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. ìƒˆ íŒŒì¼ë¡œ ì €ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.`,'ok');
    fieldFullText.value = '';
    return { sha:null, content:'' };
  }

  if(!res.ok){
    const err = await res.json().catch(()=>({}));
    throw new Error('Markdown ë¡œë“œ ì‹¤íŒ¨: ' + (err.message || res.status));
  }

  const data = await res.json();
  const md = decodeBase64(data.content.replace(/\n/g,''));
  fieldFullText.value = md;
  setStatus(`${mdPath} ë¡œë“œ ì™„ë£Œ.`,'ok');
  return { sha:data.sha, content:md };
}

async function saveMarkdownForId(reportId, existingSha=null){
  const cfg = getConfig();
  const mdPath = `reports/${reportId}.md`;
  const bodyObj = {
    path: mdPath,
    message: `Update ${mdPath} via Admin Î©.20`,
    content: encodeBase64(fieldFullText.value || ''),
    branch: cfg.branch
  };
  if(existingSha){
    bodyObj.sha = existingSha;
  }

  setStatus(`${mdPath} GitHubì— ì €ì¥ ì¤‘â€¦`);

  const res = await fetch(`https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent(mdPath)}`, {
    method:'PUT',
    headers:{
      'Accept':'application/vnd.github+json',
      'Authorization':`Bearer ${cfg.token}`,
      'Content-Type':'application/json'
    },
    body: JSON.stringify(bodyObj)
  });

  if(!res.ok){
    const err = await res.json().catch(()=>({}));
    throw new Error('Markdown ì €ì¥ ì‹¤íŒ¨: ' + (err.message || res.status));
  }

  setStatus(`${mdPath} ì €ì¥ ì™„ë£Œ.`,'ok');
}

// ---------- UI ë Œë”ë§ ----------

function renderReportList(){
  reportListEl.innerHTML = '';
  if(!reportsData.reports.length){
    const empty = document.createElement('div');
    empty.className = 'list-item';
    empty.innerHTML = '<span class="meta">ì•„ì§ ë“±ë¡ëœ ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</span>';
    reportListEl.appendChild(empty);
    return;
  }

  reportsData.reports
    .slice()
    .sort((a,b)=> (a.id||'').localeCompare(b.id||''))
    .forEach(r=>{
      const div = document.createElement('div');
      div.className = 'list-item';

      const title = document.createElement('strong');
      title.textContent = `${r.id || ''} Â· ${r.title_ko || r.title_en || ''}`;
      div.appendChild(title);

      const meta = document.createElement('span');
      meta.className = 'meta';
      meta.textContent = `${r.year || ''} Â· ${r.category || ''}`;
      div.appendChild(meta);

      const btn = document.createElement('button');
      btn.textContent = 'ì´ ë³´ê³ ì„œ ë¶ˆëŸ¬ì˜¤ê¸°';
      btn.addEventListener('click', ()=>loadReportIntoForm(r.id));
      div.appendChild(btn);

      reportListEl.appendChild(div);
    });
}

function clearForm(){
  fieldId.value = '';
  fieldCategory.value = 'Theory';
  fieldYear.value = '2025';
  fieldTitleEn.value = '';
  fieldTitleKo.value = '';
  fieldSummaryKo.value = '';
  fieldSummaryEn.value = '';
  fieldFullText.value = '';
  currentReportId = null;
  setStatus('ìƒˆ ë³´ê³ ì„œ ì…ë ¥ ì¤€ë¹„ ì™„ë£Œ.');
}

async function loadReportIntoForm(reportId){
  const r = reportsData.reports.find(x=>x.id === reportId);
  if(!r){
    setStatus(`reports.json ì—ì„œ ${reportId} ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, 'err');
    return;
  }

  fieldId.value        = r.id || '';
  fieldCategory.value  = r.category || 'Theory';
  fieldYear.value      = r.year || '';
  fieldTitleEn.value   = r.title_en || '';
  fieldTitleKo.value   = r.title_ko || '';
  fieldSummaryKo.value = r.summary_kr || r.summary_ko || '';
  fieldSummaryEn.value = r.summary_en || '';
  currentReportId      = r.id || '';

  try{
    await loadMarkdownForId(currentReportId);
  }catch(e){
    console.error(e);
    setStatus(e.message || 'Markdown ë¡œë“œ ì¤‘ ì˜¤ë¥˜','err');
  }
}

// ---------- ì €ì¥ ì²˜ë¦¬ ----------

async function handleSaveReport(){
  const id = fieldId.value.trim();
  const titleEn = fieldTitleEn.value.trim();

  if(!id || !titleEn){
    setStatus('Report IDì™€ Title(EN)ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.','err');
    return;
  }

  const reportObj = {
    id,
    slug: id,
    year: fieldYear.value.trim() || '2025',
    category: fieldCategory.value || 'Theory',
    title_en: titleEn,
    title_ko: fieldTitleKo.value.trim(),
    summary_kr: fieldSummaryKo.value.trim(),
    summary_en: fieldSummaryEn.value.trim(),
    md_path: `reports/${id}.md`
  };

  // reportsData ê°±ì‹ 
  const idx = reportsData.reports.findIndex(r=>r.id === id);
  if(idx >= 0){
    reportsData.reports[idx] = reportObj;
  }else{
    reportsData.reports.push(reportObj);
  }

  try{
    btnSaveReport.disabled = true;
    await saveReportsJson();

    // ê¸°ì¡´ md sha ì–»ê¸°
    let mdSha = null;
    try{
      const res = await ghFetch(`reports/${id}.md`,{method:'GET'});
      if(res.ok){
        const data = await res.json();
        mdSha = data.sha;
      }
    }catch(e){
      console.warn('ê¸°ì¡´ md í™•ì¸ ì¤‘ ì˜¤ë¥˜ (ì—†ì„ ìˆ˜ ìˆìŒ):', e);
    }

    await saveMarkdownForId(id, mdSha);
    await loadReportsJson(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    currentReportId = id;
    setStatus(`ë³´ê³ ì„œ ${id} ê°€ JSON + Markdown ëª¨ë‘ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`,'ok');
  }catch(e){
    console.error(e);
    setStatus(e.message || 'ë³´ê³ ì„œ ì €ì¥ ì¤‘ ì˜¤ë¥˜','err');
  }finally{
    btnSaveReport.disabled = false;
  }
}

// ---------- ì´ë²¤íŠ¸ ë°”ì¸ë”© & ì´ˆê¸°í™” ----------

btnSaveConfig.addEventListener('click', saveConfigToLocal);
btnClearConfig.addEventListener('click', ()=>{
  if(confirm('ì €ì¥ëœ Owner/Repo/Branch/Tokenì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?')){
    clearConfig();
  }
});
btnTestLoad.addEventListener('click', loadReportsJson);
btnSaveReport.addEventListener('click', handleSaveReport);
btnNewReport.addEventListener('click', clearForm);
btnReloadSelected.addEventListener('click', ()=>{
  if(!currentReportId){
    setStatus('ë¨¼ì € ì™¼ìª½ ëª©ë¡ì—ì„œ ë³´ê³ ì„œë¥¼ ì„ íƒí•˜ê±°ë‚˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.','err');
    return;
  }
  loadReportIntoForm(currentReportId);
});

document.addEventListener('DOMContentLoaded', ()=>{
  loadConfigFromLocal();
  setStatus('Admin Î©.20 ë¡œë“œ ì™„ë£Œ. GitHub ì„¤ì •ì„ í™•ì¸í•œ ë’¤, "ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
});
</script>