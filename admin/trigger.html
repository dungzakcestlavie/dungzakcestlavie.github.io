<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Lightflow Admin Î©.11 â€” Trigger</title>
<meta name="theme-color" content="#070c1a" />
<meta name="description" content="DUNGZAK CESTLAVIE Â· Lightflow Admin Î©.11 Â· Trigger Â· Unified + iPhone Stable" />
<style>
:root{
  --bg:#070c1a;--panel:#0b1020;--soft:#0f1730;--fg:#e8edf7;--muted:#9fa8c0;
  --accent:#d4b97a;--ok:#74e0a1;--warn:#ffb04d;--bad:#ff6b6b;--border:#1e2744;--radius:14px;
}
/* Base */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{margin:0;background:var(--bg);color:var(--fg);
  font:16px/1.5 -apple-system,BlinkMacSystemFont,system-ui,"Apple SD Gothic Neo","Noto Sans KR",sans-serif}
.header{position:sticky;top:0;z-index:100;background:linear-gradient(180deg,#0a1022e6,#0a102200);
  padding:12px 14px 10px;border-bottom:1px solid var(--border);backdrop-filter:saturate(130%) blur(8px)}
.h1{margin:0;color:var(--accent);font-weight:800;font-size:22px}
.sub{font-size:13px;color:var(--muted);margin-top:4px}
.container{max-width:980px;margin:0 auto;padding:12px 12px 120px}
/* Nav (Global) */
.admin-nav{position:sticky;top:56px;z-index:90;background:rgba(10,16,34,.92);
  border-bottom:1px solid var(--border);backdrop-filter:blur(8px)}
.admin-nav .bar{max-width:980px;margin:0 auto;display:flex;gap:8px;overflow-x:auto;padding:8px 12px}
.admin-nav a{flex:0 0 auto;text-decoration:none;font-weight:700;font-size:14px;color:#cfe0ff;
  background:#0d142b;border:1px solid var(--border);border-radius:999px;padding:8px 12px}
.admin-nav a.active{background:var(--accent);color:#000}
/* Cards */
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin:12px 0}
.card h3{margin:0 0 12px;color:var(--accent);font-size:1.05rem;font-weight:800}
/* Buttons */
button{width:100%;min-height:48px;border-radius:12px;border:1px solid var(--border);
  background:var(--soft);color:var(--fg);padding:12px;font-size:15px;cursor:pointer;font-weight:800}
.btn{background:var(--accent);color:#08101f}
.btn-ok{background:var(--ok);color:#062519}
.btn-ghost{background:#203055;color:#e8edf7;border:1px solid rgba(255,255,255,.08)}
.btn-bad{background:var(--bad);color:#2a0000}
.btnbar{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.kv{display:grid;grid-template-columns:120px 1fr;gap:6px;font-size:14px}
.k{color:var(--muted)}
/* Toast */
.toast{position:fixed;left:50%;bottom:calc(18px + env(safe-area-inset-bottom));transform:translateX(-50%);
 background:#0b1223;border:1px solid var(--border);color:var(--fg);padding:10px 16px;border-radius:12px;
 opacity:0;transition:.22s;pointer-events:none;z-index:999}
.toast.show{opacity:1;transform:translate(-50%,-6px)}
</style>
</head>
<body>
<header class="header">
  <div class="h1">ğŸš€ Lightflow Admin Î©.11 â€” Trigger</div>
  <div class="sub">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Ã— Lumera Â· Unified + iPhone-Stable</div>
</header>

<nav class="admin-nav">
  <div class="bar">
    <a href="/admin/admin.html#home" data-k="home">Home</a>
    <a href="/admin/admin.html#artworks" data-k="artworks">Artworks</a>
    <a href="/admin/admin.html#dcar" data-k="dcar">DCAR</a>
    <a href="/admin/batch.html" data-k="upload">Upload</a>
    <a href="/admin/admin.html#settings" data-k="settings">Settings</a>
  </div>
</nav>

<main class="container">
  <!-- 0) ì—°ê²° ìƒíƒœ -->
  <section class="card">
    <h3>0ï¸âƒ£ ì—°ê²° ìƒíƒœ</h3>
    <div class="kv">
      <div class="k">Owner</div><div id="sOwner">â€”</div>
      <div class="k">Repo</div><div id="sRepo">â€”</div>
      <div class="k">Branch</div><div id="sBranch">â€”</div>
      <div class="k">Token</div><div id="sToken">â€”</div>
      <div class="k">Last Check</div><div id="sCheck">â€”</div>
    </div>
    <div class="btnbar" style="margin-top:10px">
      <button type="button" class="btn-ghost" id="refresh">â†» ê°±ì‹ </button>
      <button type="button" class="btn-ok" id="test">ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    </div>
    <small>ì„¤ì •ì€ <code>admin.html</code>ì—ì„œ ì €ì¥í•œ ê°’(localStorage)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</small>
  </section>

  <!-- 1) ê°•ì œ íŠ¸ë¦¬ê±° -->
  <section class="card">
    <h3>1ï¸âƒ£ ê°•ì œ íŠ¸ë¦¬ê±°</h3>
    <button type="button" class="btn" id="touch">ğŸ“ Commit Touch (ìºì‹œ ë¬´íš¨)</button>
    <div class="btnbar" style="margin-top:8px">
      <button type="button" class="btn" id="pages">ğŸš€ Pages Build ìš”ì²­</button>
      <button type="button" class="btn-bad" id="clear">ğŸ§¹ localStorage ì´ˆê¸°í™”</button>
    </div>
    <small>touch íŒŒì¼ ì»¤ë°‹ í›„ Pages ë¹Œë“œë¥¼ ìš”ì²­í•´ ìºì‹œë¥¼ ìµœì‹ í™”í•©ë‹ˆë‹¤.</small>
  </section>
</main>

<div id="toast" class="toast">Ready.</div>

<script>
/* ===== Helpers / Nav Active ===== */
const $=q=>document.querySelector(q), $$=q=>document.querySelectorAll(q);
const say=(m,err=false)=>{const t=$("#toast");t.textContent=m;t.style.borderColor=err?"#ff6b6b":"#22304f";
  t.classList.add("show");clearTimeout(say._t);say._t=setTimeout(()=>t.classList.remove("show"),1800);};
(function navActive(){
  // Trigger í˜ì´ì§€ì—ì„  Settings í•­ëª©ì„ í™œì„±í™” í‘œì‹œ
  $$(".admin-nav a").forEach(a=>a.classList.toggle("active", a.dataset.k==="settings"));
})();

/* ===== Local config ===== */
const KEY="lf_admin_cfg_v101";
function readCfg(){ try{return JSON.parse(localStorage.getItem(KEY)||"{}");}catch(e){return {};} }
function cfg(k){return (readCfg()[k]||"");}

/* ===== GitHub API ===== */
async function gh(method,path,body=null,isJson=true){
  const token=cfg("token"); if(!token) throw new Error("í† í° ì—†ìŒ");
  const r=await fetch(`https://api.github.com/${path}`,{
    method,
    headers:{ "Accept":"application/vnd.github+json", "Authorization":`token ${token}` },
    body:body?(isJson?JSON.stringify(body):body):null
  });
  if(!r.ok){const t=await r.text();throw new Error(`GitHub ${r.status}: ${t.slice(0,180)}`);}
  return r.json();
}
function b64(s){return btoa(unescape(encodeURIComponent(s)));}
async function getContent(p){
  const o=cfg("owner"),r=cfg("repo"),b=cfg("branch")||"main";
  try{const j=await gh("GET",`repos/${o}/${r}/contents/${encodeURIComponent(p)}?ref=${b}`);return {sha:j.sha,content:j.content?atob(j.content.replace(/\n/g,"")):null,exists:true};}
  catch(e){return {sha:null,content:null,exists:false};}
}
async function putFile(p,b64data,msg){
  const o=cfg("owner"),r=cfg("repo"),b=cfg("branch")||"main";
  const old=await getContent(p); const body={message:msg||`update ${p}`,content:b64data,branch:b};
  if(old.exists) body.sha=old.sha;
  return gh("PUT",`repos/${o}/${r}/contents/${encodeURIComponent(p)}`,body);
}

/* ===== UI / Actions ===== */
function hydrate(){
  $("#sOwner").textContent=cfg("owner")||"â€”";
  $("#sRepo").textContent=cfg("repo")||"â€”";
  $("#sBranch").textContent=cfg("branch")||"â€”";
  $("#sToken").textContent=cfg("token")?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":"â€”";
  $("#sCheck").textContent=new Date().toLocaleString();
}
async function testConn(){
  try{await gh("GET",`repos/${cfg("owner")}/${cfg("repo")}`);say("âœ… ì—°ê²° OK (200)");}
  catch(e){say("âš ï¸ ì—°ê²° ì‹¤íŒ¨: "+e.message,true);}
}
async function touch(){
  try{
    const stamp=new Date().toISOString();
    await putFile("data/.touch", b64("touch "+stamp), `touch ${stamp}`);
    await putFile("data/.pages-touch", b64("pages "+stamp), `pages-touch ${stamp}`);
    say("ğŸ“ touch commit ì™„ë£Œ");
  }catch(e){say("touch ì‹¤íŒ¨: "+e.message,true);}
}
async function pagesBuild(){
  try{
    await gh("POST",`repos/${cfg("owner")}/${cfg("repo")}/pages/builds`,{});
    say("ğŸš€ Pages ë¹Œë“œ ìš”ì²­ ì™„ë£Œ");
  }catch(e){say("âš ï¸ Pages API ì‹¤íŒ¨: "+e.message,true);}
}

/* ===== Events (iOS-safe: click + pointerup) ===== */
function bindTap(sel,fn){
  const el=$(sel);
  el.addEventListener("click",e=>{e.preventDefault();e.stopPropagation();fn();},{passive:false});
  el.addEventListener("pointerup",e=>{ if(e.pointerType==="touch"){e.preventDefault();e.stopPropagation();fn();}},{passive:false});
}

function boot(){
  hydrate();
  bindTap("#refresh", hydrate);
  bindTap("#test", testConn);
  bindTap("#touch", touch);
  bindTap("#pages", pagesBuild);
  bindTap("#clear", ()=>{ localStorage.removeItem(KEY); hydrate(); say("localStorage ì‚­ì œ ì™„ë£Œ"); });
}

window.addEventListener("error",e=>{try{say("JS ì˜¤ë¥˜: "+e.message,true);}catch{}});
window.addEventListener("load", boot);
</script>
</body>
</html>