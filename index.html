<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE â€” Lightflow Î©.6.6-fix</title>
<meta name="description" content="ë¹› Â· ê¸°ì–µ Â· ì¡´ì¬ â€” DUNGZAK CESTLAVIE Â· Lightflow Î©.6.6 Â· Gallery Â· Aesthetic Reports (DCAR)">
<meta property="og:title" content="DUNGZAK CESTLAVIE â€” Lightflow Î©.6.6">
<meta property="og:url" content="https://dungzak.art">
<meta name="theme-color" content="#060814">
<!-- ìºì‹œ ë¬´ì‹œ (ê¶Œì¥) -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='86'>âœ¨</text></svg>'>

<style>
:root{ --bg:#060814; --fg:#eaf0ff; --gold:#e6c777; --panel:#0f1630; --line:#1b2652; --max:1180px; }
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
html,body{height:100%}
body{
  background:radial-gradient(1000px 700px at 70% -10%,#152147 0,#060814 80%);
  color:var(--fg);font:16px/1.6 'Noto Sans KR',system-ui,sans-serif;
  overflow-x:hidden;
}

/* cosmic wave canvas */
#waves{position:fixed;inset:0;pointer-events:none;z-index:0}

/* header */
header{
  position:sticky;top:0;z-index:10;
  background:rgba(6,10,20,.85);backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:10px 12px;
}
.brand{text-align:center;font-weight:800;color:var(--gold);font-size:clamp(16px,5vw,22px)}
nav.primary{display:flex;justify-content:center;gap:10px;margin-top:6px;flex-wrap:wrap}
nav.primary a{color:var(--fg);text-decoration:none;font-weight:600;padding:6px 12px;border-radius:8px}
nav.primary a:hover,nav.primary a.active{background:linear-gradient(180deg,#f7e4a5,#e6c777);color:#0a1230}

/* language toggle */
.lang{display:flex;justify-content:center;gap:6px;margin-top:8px}
.lang button{all:unset;cursor:pointer;color:#cfe0ff;border:1px solid #2a335f;border-radius:6px;padding:4px 8px}
.lang button.active,.lang button:hover{background:#1b2348;color:var(--gold);border-color:#3a447a}

/* sections */
main{position:relative;z-index:2}
section{max-width:var(--max);margin:auto;padding:80px 16px}
h1,h2{color:var(--gold)}
h2{margin-bottom:12px}

/* poem */
.hero{text-align:center;min-height:70vh}
.hero h1{font-size:clamp(32px,6vw,64px);margin-bottom:6px}
.hero p{opacity:.85;margin-bottom:18px}
.poem p{margin-bottom:8px}

/* works */
.tabs{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:12px 0 16px}
.tab{padding:9px 14px;border-radius:18px;border:1px solid var(--line);background:#0f1838;color:#bbcaf8;cursor:pointer;font-size:.92rem;white-space:nowrap}
.tab.active{background:linear-gradient(180deg,var(--gold),#f0df9e);color:#0a1230;border-color:#d9c16a}
.tabpanel{display:none}
.tabpanel.active{display:block}

/* grid & cards */
.grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
@media(min-width:1024px){.grid{grid-template-columns:repeat(4,1fr)}}
.card{background:var(--panel);border:1px solid var(--line);border-radius:10px;overflow:hidden;
  transition:transform .3s,box-shadow .4s,opacity .4s; opacity:0; transform:translateY(8px)}
.card.visible{opacity:1;transform:translateY(0)}
.card:hover{transform:translateY(-3px);box-shadow:0 0 14px rgba(230,199,119,.3)}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block}
.caption{padding:8px 10px;background:#0f1630;font-size:.83rem}
.caption strong{color:var(--gold)}
.caption em{opacity:.85}

/* accordion */
.accordion{border:1px solid #2a3a78;border-radius:10px;overflow:hidden}
.accordion-header{background:#0f1838;color:var(--gold);padding:14px;cursor:pointer}
.accordion-content{display:none;background:#0b1020;padding:14px;color:#cfe0ff}
.accordion-item.active .accordion-content{display:block}

/* floating social mini icons */
.fab{position:fixed;right:12px;bottom:calc(100px + env(safe-area-inset-bottom));z-index:30;display:flex;flex-direction:column;gap:8px}
.fab a{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;
  background:rgba(12,19,48,.45);border:1px solid rgba(230,199,119,.35);
  font-size:16px;text-decoration:none;color:#cfe0ff;backdrop-filter:blur(6px)}
.fab a:hover{color:#0a1230;background:linear-gradient(180deg,#f7e4a5,#e6c777)}
</style>
</head>

<body class="korean">
<canvas id="waves"></canvas>

<header>
  <div class="brand">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Lightflow Î©.6.6</div>
  <nav class="primary">
    <a href="#poem"   class="active">Poem</a>
    <a href="#works">Works</a>
    <a href="#reports">Reports</a>
  </nav>
  <div class="lang">
    <button id="koBtn" class="active">KR</button>
    <button id="enBtn">EN</button>
    <button id="hyBtn">KR+EN</button>
  </div>
</header>

<main>
  <!-- Poem -->
  <section id="poem" class="hero">
    <div>
      <h1 class="ko">ë¹› Â· ê¸°ì–µ Â· ì¡´ì¬</h1>
      <h1 class="en" style="display:none">Light Â· Memory Â· Being</h1>
      <p class="ko">ë“±ì‘ê³¼ ë£¨ë©”ë¼ì˜ ì§€íœ˜ë¡œ â€” ë“±ì‘ DUNGZAK CESTLAVIE</p>
      <p class="en" style="display:none">Conducted by DUNGZAK and Lumera â€” DUNGZAK CESTLAVIE</p>

      <div class="poem" style="max-width:820px;margin:18px auto 0;text-align:left;background:rgba(16,22,48,.35);border:1px solid #223;border-radius:12px;padding:14px">
        <div class="poem-ko">
          <p>ì„¼ëŠê°• ë‹¤ë¦¬ ì•„ë˜, ë…¸íŠ¸ë¥´ë‹´ ì„±ë‹¹ì˜ ì´›ë¶ˆì´ ì¼œì§ˆ ë¬´ë µâ€”</p>
          <p>ì†Œë°•í•œ ê¿ˆë“¤ì„ ì•ˆê³  ì‚¬ëŠ” ì‚¬ëŒë“¤ì´ ëª¨ì—¬ ì¶¤ì¶˜ë‹¤.</p>
          <p>ë°”ì´ì˜¬ë¦°ì´ ìƒˆíŒŒë—ê³  ìƒ›ë…¸ë‘ì˜ ë¹›ì„ í©ë¿Œë¦¬ë©° ì›ƒëŠ”ë‹¤.</p>
          <p>ê¿ˆê¾¸ëŠ” ì—¬ì¸ë“¤ê³¼ ê¿ˆê¾¸ëŠ” ë‚¨ì„±ë“¤ì´ ì†ì„ ì¡ê³ ,</p>
          <p>ì‚¬ëŒì˜ í–¥ê¸°ë¥¼ ë§¡ìœ¼ë©° ì¬ë¹ ë¥¸ ìŒë¥ ì— ëª¸ì„ ë§¡ê¸´ë‹¤.</p>
          <p>ì´ˆìŠ¹ë‹¬ì€ ì–´ì—¬ìœ í•˜ì–€ ë¯¸ì†Œë¥¼ í˜ë¦¬ê³ , ì‚¬ë‘ì€ ê·¸ ë¹›ìœ¼ë¡œ íë¥¸ë‹¤.</p>
        </div>
        <div class="poem-en" style="display:none">
          <p>Beneath the bridge of the Seine, as Notre-Dameâ€™s candles begin to glowâ€”</p>
          <p>Those who live with humble dreams gather to dance.</p>
          <p>Violins scatter blue and golden lights, laughing in brilliance.</p>
          <p>Dreaming women and men clasp hands,</p>
          <p>breathe the scent of humanity, and yield to the rhythm of love.</p>
          <p>The crescent moon spills a tender smile, and love flows within its light.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Works -->
  <section id="works">
    <h2>Artworks â€” ì‘í’ˆ ì•„ì¹´ì´ë¸Œ</h2>
    <div class="tabs" role="tablist" aria-label="Art Sections">
      <button class="tab active" data-panel="pray">â…  ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” â€” Pray for Us</button>
      <button class="tab" data-panel="human">â…¡ ì¸ê°„ â€” Human Being</button>
      <button class="tab" data-panel="rebirth">â…¢ ì •ì‹ ì˜ ì¬íƒ„ìƒ â€” Rebirth of Mind</button>
      <button class="tab" data-panel="exist">â…£ ì¡´ì¬ì˜ íšŒë³µ â€” Restoration of Being</button>
      <button class="tab" data-panel="cosmos">â…¤ ë¹›ì˜ ì´ˆì˜ì‹ â€” Metaconsciousness of Light</button>
    </div>
    <div id="panel-pray" class="tabpanel active"></div>
    <div id="panel-human" class="tabpanel"></div>
    <div id="panel-rebirth" class="tabpanel"></div>
    <div id="panel-exist" class="tabpanel"></div>
    <div id="panel-cosmos" class="tabpanel"></div>

    <div style="margin-top:18px;text-align:center;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
      <button id="exportMeta">Export JSON</button>
      <button id="importMeta">Import JSON</button>
      <button id="clearMeta"  title="ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ì‘í’ˆ ì •ë³´ë¥¼ ì´ˆê¸°í™”">Clear (Local)</button>
    </div>
    <p class="sub" style="text-align:center;margin-top:8px;opacity:.8">â€¢ ë”ë¸”í´ë¦­/ë”ë¸”íƒ­ â†’ ì¹´ë“œ ë©”íƒ€ í¸ì§‘ì°½ Â· ì €ì¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜ Â· ë¸Œë¼ìš°ì €ì— ì €ì¥ë¨</p>
  </section>

  <!-- Reports -->
  <section id="reports">
    <h2>ë¯¸í•™ ë³´ê³ ì„œ (DCAR Series)</h2>
    <div class="accordion" id="dcarAcc">
      <div class="accordion-item">
        <div class="accordion-header">DCAR-01-2025 Â· ì¡´ì¬ì˜ íšŒë³µ â€” The Restoration of Being</div>
        <div class="accordion-content">ì¡´ì¬ì˜ íšŒë³µê³¼ ê°ê°ì˜ ìœ¤ë¦¬. Restoration of Being and the Ethics of Sensation.</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">DCAR-02-2025 Â· ê¸°ì–µì˜ ìœ¤ë¦¬ â€” The Ethics of Memory</div>
        <div class="accordion-content">ê¸°ì–µì˜ êµ¬ì„±ê³¼ ê³µì¡´ì˜ ì±…ì„. The Construction of Memory and Responsibility for Coexistence.</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">DCAR-03-2025 Â· ì •ì‹ ì˜ ì¬íƒ„ìƒ â€” The Rebirth of Mind</div>
        <div class="accordion-content">ì§€ê°ì˜ ì§„í™”ì™€ ì˜ì‹ì˜ í™•ì¥. Evolution of Perception and the Widening of Consciousness.</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">DCAR-04-2025 Â· ë¹›ì˜ ìƒí” â€” The Scars of Light</div>
        <div class="accordion-content">ìƒí”ì˜ ë¯¸í•™ê³¼ ì¡´ì—„. The Aesthetics and Dignity of Scars.</div>
      </div>
    </div>
  </section>
</main>

<!-- Lightbox -->
<div id="lightbox" aria-hidden="true" style="position:fixed;inset:0;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,.88);opacity:0;pointer-events:none;transition:.25s;z-index:20">
  <div class="frame" style="position:relative;max-width:92vw;max-height:88vh;overflow:hidden;border:2px solid var(--gold);border-radius:10px;padding:6px;background:#000">
    <img alt="Artwork view" style="display:block;max-width:100%;max-height:82vh;cursor:zoom-in">
  </div>
  <div class="lb-cap" id="lbCap" style="position:fixed;left:50%;bottom:18px;transform:translateX(-50%);max-width:92vw;background:rgba(8,16,40,.7);border:1px solid #223;border-radius:10px;padding:8px 12px;font-size:.88rem;color:#e9f1ff;text-align:center"></div>
</div>

<!-- Floating mini social -->
<div class="fab" id="socialFab" aria-label="quick social">
  <a href="https://flickr.com/photos/dungzak" target="_blank" rel="noopener" title="Flickr">ğŸ“¸</a>
  <a href="https://instagram.com/dungzakcestlavie" target="_blank" rel="noopener" title="Instagram">ğŸ“·</a>
  <a href="https://youtube.com/@dungzakcestlavie" target="_blank" rel="noopener" title="YouTube">â–¶ï¸</a>
  <a href="https://naver.me/x95dk3l1" target="_blank" rel="noopener" title="Naver Info">ğŸ§­</a>
  <a href="mailto:dungzakcestlavie@gmail.com" title="Email">âœ‰ï¸</a>
</div>

<!-- Sound controls -->
<div id="ctrl" style="position:fixed;left:50%;transform:translateX(-50%);bottom:calc(70px + env(safe-area-inset-bottom));display:flex;gap:8px;z-index:25">
  <button id="soundBtn" title="Play Prayer Resonance" style="width:36px;height:36px;border-radius:50%;border:1px solid rgba(230,199,119,.4);background:rgba(12,19,48,.45);color:#fff">âœ¨</button>
  <button id="soundStopBtn" title="Stop" disabled style="width:36px;height:36px;border-radius:50%;border:1px solid rgba(230,199,119,.4);background:rgba(12,19,48,.45);color:#fff">ğŸ”‡</button>
</div>

<footer style="border-top:1px solid rgba(255,255,255,.08);text-align:center;padding:48px 12px 96px;background:#090f22;margin-top:30px">
  <div class="links" style="display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-bottom:10px">
    <a href="#poem">â†‘ Poem</a><a href="#works">Works</a><a href="#reports">Reports</a>
  </div>
  <small class="ko">Â© 2025 ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· ë“±ì‘ê³¼ ë£¨ë©”ë¼ì˜ ì§€íœ˜ë¡œ</small>
  <small class="en" style="display:none">Â© 2025 DUNGZAK CESTLAVIE Â· Conducted by DUNGZAK and Lumera</small>
</footer>

<script>
(function(){
  const $=(s,sc)=> (sc||document).querySelector(s);
  const $$=(s,sc)=> Array.from((sc||document).querySelectorAll(s));
  const store={get(k,d=null){try{const v=localStorage.getItem(k);return v?JSON.parse(v):d}catch{return d}},set(k,v){try{localStorage.setItem(k,JSON.stringify(v))}catch{}}};

  /* ===== NAV: ì•µì»¤ í™œì„±í™” ìë™ í•˜ì´ë¼ì´íŠ¸ ===== */
  const links=$$('nav.primary a');
  const sections=['poem','works','reports'].map(id=>document.getElementById(id));
  const io=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        links.forEach(a=>a.classList.toggle('active', a.getAttribute('href')==='#'+e.target.id));
      }
    });
  },{rootMargin:'-45% 0px -45% 0px',threshold:0});
  sections.forEach(s=> io.observe(s));

  /* ===== Language toggle ===== */
  const koBtn=$('#koBtn'), enBtn=$('#enBtn'), hyBtn=$('#hyBtn');
  function setLang(lang){
    document.body.classList.remove('korean','english','hybrid');
    if(lang==='ko') document.body.classList.add('korean'); else
    if(lang==='en') document.body.classList.add('english'); else document.body.classList.add('hybrid');
    [koBtn,enBtn,hyBtn].forEach(b=>b.classList.remove('active'));
    ({ko:koBtn,en:enBtn,hy:hyBtn}[lang]).classList.add('active');
    store.set('dz_lang',lang);
    const act=$('.tabs .tab.active'); if(act) renderPanel(act.dataset.panel);
    // ì œëª©/ì‹œ í…ìŠ¤íŠ¸ show/hide
    $$('.ko').forEach(n=>n.style.display=(lang==='en'?'none':''));
    $$('.en').forEach(n=>n.style.display=(lang==='ko'?'none':''));
  }
  koBtn.onclick=()=>setLang('ko'); enBtn.onclick=()=>setLang('en'); hyBtn.onclick=()=>setLang('hy');
  setLang(store.get('dz_lang','ko'));

  /* ===== Background waves (trail ì—†ì´ë„ ì‘ë™) ===== */
  (function(){
    const ctx=$('#waves')?.getContext('2d',{alpha:true});
    if(!ctx) return;
    let DPR=1,W=0,H=0,t=0,px=innerWidth/2,py=innerHeight/2,tx=px,ty=py,visible=true;
    const prefersReduced=matchMedia('(prefers-reduced-motion: reduce)').matches;
    function resize(){DPR=Math.max(1,Math.min(2,devicePixelRatio||1));W=ctx.canvas.width=Math.floor(innerWidth*DPR);H=ctx.canvas.height=Math.floor(innerHeight*DPR);ctx.setTransform(1,0,0,1,0,0);ctx.scale(1/DPR,1/DPR)}
    resize(); addEventListener('resize',resize,{passive:true}); document.addEventListener('visibilitychange',()=>visible=!document.hidden);
    addEventListener('mousemove',e=>{tx=e.clientX;ty=e.clientY},{passive:true}); addEventListener('touchmove',e=>{const p=e.touches[0];tx=p.clientX;ty=p.clientY},{passive:true});
    const ease=x=>x*x*(3-2*x);
    function laneY(x,k){const f1=0.0030+k*0.0007,f2=0.0060+k*0.0006;const a1=26+k*12,a2=14+k*8;const drift=t*(0.75+k*0.15);const base=innerHeight*0.30+k*108+Math.sin(t*0.5+k)*12;const curve=0.9+ease(x/innerWidth)*0.2;return base+Math.sin(x*f1+drift*1.1+Math.sin(drift*0.7+k)*.25)*a1*curve+Math.sin(x*f2+drift*.85)*a2}
    function draw(){
      ctx.clearRect(0,0,innerWidth,innerHeight);
      const lanes=prefersReduced?2:4; const hueBase=210+Math.sin(t*0.05)*15;
      for(let k=0;k<lanes;k++){
        ctx.beginPath();
        for(let x=0;x<=innerWidth;x+=6){const y=laneY(x,k);x?ctx.lineTo(x,y):ctx.moveTo(x,y)}
        const y0=laneY(0,k); const g=ctx.createLinearGradient(0,y0-140,0,y0+140); const hue=(hueBase+k*12)%360;
        g.addColorStop(0,`hsla(${hue},65%,70%,.10)`); g.addColorStop(.5,`hsla(45,70%,68%,.28)`); g.addColorStop(1,`hsla(${(hue+60)%360},60%,60%,.10)`);
        ctx.strokeStyle=g; ctx.lineWidth=1.15+k*0.45; ctx.globalAlpha=0.88-k*0.12; ctx.shadowBlur=16; ctx.shadowColor='rgba(160,200,255,.18)'; ctx.stroke();
      }
      // soft glow (same canvas)
      px+=(tx-px)*(prefersReduced?0.10:0.15); py+=(ty-py)*(prefersReduced?0.10:0.15);
      if(!prefersReduced){
        const sp=Math.hypot(tx-px,ty-py), r=96+Math.min(sp*160,240);
        const g=ctx.createRadialGradient(px,py,0,px,py,r); g.addColorStop(0,'rgba(230,199,119,.24)'); g.addColorStop(.55,'rgba(140,185,255,.14)'); g.addColorStop(1,'rgba(140,185,255,0)');
        ctx.fillStyle=g; ctx.beginPath(); ctx.arc(px,py,r,0,Math.PI*2); ctx.fill();
      }
      ctx.globalAlpha=1; ctx.shadowBlur=0;
    }
    (function loop(){ if(visible){ t+=(prefersReduced?0.003:0.008); draw(); } requestAnimationFrame(loop) })();
  })();

  /* ===== Works: ë Œë”/íƒ­/ë©”íƒ€/IO ===== */
  const SECTIONS=[{key:'pray',title:'Pray for Us'},{key:'human',title:'Human Being'},{key:'rebirth',title:'Rebirth of Mind'},{key:'exist',title:'Restoration of Being'},{key:'cosmos',title:'Metaconsciousness of Light'}];
  let META=store.get('works_meta',{});
  function cardHTML(secKey,secTitle,i){
    const m=META[secKey]?.[i]||{}; const tko=m.title_ko||`ì‘í’ˆ ${i}`; const ten=m.title_en||`${secTitle} ${i}`;
    const info=[m.material||'',m.size||'',m.year||''].filter(Boolean).join(' Â· ');
    const lang=document.body.classList.contains('korean')?'ko':(document.body.classList.contains('english')?'en':'hy');
    let cap=''; if(lang==='ko') cap=`<strong>${tko}</strong>${info?`<br>${info}`:''}`; else if(lang==='en') cap=`<strong>${ten}</strong>${info?`<br>${info}`:''}`; else cap=`<strong>${tko}</strong><br><em>${ten}</em>${info?`<br>${info}`:''}`;
    return `<article class="card" tabindex="0" data-sec="${secKey}" data-id="${i}">
      <img loading="lazy" data-src="works/${secKey}/${i}.jpg" alt="${tko}">
      <div class="caption">${cap}</div></article>`;
  }
  function renderPanel(secKey){
    const sec=SECTIONS.find(s=>s.key===secKey); const host=document.getElementById('panel-'+secKey); if(!host) return;
    const N=20;
    host.innerHTML=`<div class="grid">${Array.from({length:N},(_,k)=>cardHTML(sec.key,sec.title,k+1)).join('')}</div>`;
    try{
      const io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){const img=e.target;if(img.dataset.src){img.src=img.dataset.src;img.removeAttribute('data-src')} img.closest('.card')?.classList.add('visible'); io.unobserve(img);}})},{rootMargin:'200px'});
      $$('#panel-'+secKey+' img[loading][data-src]').forEach(img=>io.observe(img));
    }catch{}
  }
  SECTIONS.forEach(s=>renderPanel(s.key));
  $$('.tabs .tab').forEach(b=> b.addEventListener('click',()=>{
    $$('.tabs .tab').forEach(x=>x.classList.remove('active')); b.classList.add('active');
    $$('.tabpanel').forEach(x=>x.classList.remove('active')); $('#panel-'+b.dataset.panel).classList.add('active');
    renderPanel(b.dataset.panel);
    window.scrollTo({top: $('#panel-'+b.dataset.panel).offsetTop-70, behavior:'smooth'});
  }));

  // í¸ì§‘/ë”ë¸”íƒ­
  document.body.addEventListener('dblclick',e=>{const c=e.target.closest('.card'); if(c) openMetaEditor(c.dataset.sec,c.dataset.id)});
  document.body.addEventListener('touchend',e=>{const now=performance.now(); if(document._lastTap && (now-document._lastTap)<300){const c=e.target.closest('.card'); if(c) openMetaEditor(c.dataset.sec,c.dataset.id)} document._lastTap=now},{passive:true});
  function openMetaEditor(secKey,id){
    const m=(META[secKey]&&META[secKey][id])||{}; const wrap=document.createElement('div');
    wrap.style.cssText='position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center';
    wrap.innerHTML=`<div style="background:#0f1630;color:#e9efff;width:92vw;max-width:520px;border:1px solid #2a3a78;border-radius:12px;padding:16px">
      <h3 style="margin-bottom:8px">ì‘í’ˆ ì •ë³´ ìˆ˜ì • â€” ${secKey}/${id}</h3>
      <div style="display:grid;gap:8px">
        <label>ì œëª©(KR)<br><input id="tk" style="width:100%" value="${m.title_ko||''}"></label>
        <label>Title(EN)<br><input id="te" style="width:100%" value="${m.title_en||''}"></label>
        <label>ì¬ë£Œ(Material)<br><input id="mat" style="width:100%" value="${m.material||''}"></label>
        <label>í¬ê¸°(Size)<br><input id="sz" style="width:100%" value="${m.size||''}"></label>
        <label>ì—°ë„(Year)<br><input id="yr" style="width:100%" value="${m.year||''}"></label>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="del" style="background:#3b2240;color:#fff;border:1px solid #5a3a6d;padding:6px 10px;border-radius:8px">Delete</button>
        <button id="cancel" style="background:#1b2548;color:#fff;border:1px solid #2a3a78;padding:6px 10px;border-radius:8px">Cancel</button>
        <button id="save" style="background:#d6b868;color:#0a1230;border:1px solid #d6b868;padding:6px 10px;border-radius:8px;font-weight:700">Save</button>
      </div></div>`;
    document.body.appendChild(wrap);
    wrap.querySelector('#cancel').onclick=()=>wrap.remove();
    wrap.querySelector('#del').onclick=()=>{if(confirm('ì´ ì¹´ë“œì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')){if(META[secKey]) delete META[secKey][id]; store.set('works_meta',META); renderPanel(secKey); wrap.remove();}};
    wrap.querySelector('#save').onclick=()=>{META[secKey]=META[secKey]||{}; META[secKey][id]={title_ko:wrap.querySelector('#tk').value.trim(),title_en:wrap.querySelector('#te').value.trim(),material:wrap.querySelector('#mat').value.trim(),size:wrap.querySelector('#sz').value.trim(),year:wrap.querySelector('#yr').value.trim()}; store.set('works_meta',META); renderPanel(secKey); wrap.remove();};
  }
  $('#exportMeta')?.addEventListener('click',()=>{const blob=new Blob([JSON.stringify(META,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='works-metadata.json'; a.click(); URL.revokeObjectURL(a.href);});
  $('#importMeta')?.addEventListener('click',()=>{const inp=document.createElement('input'); inp.type='file'; inp.accept='.json,application/json'; inp.onchange=e=>{const f=e.target.files?.[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{try{META=JSON.parse(r.result)||{}; store.set('works_meta',META); SECTIONS.forEach(s=>renderPanel(s.key)); alert('ë©”íƒ€ë°ì´í„°ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.')}catch{alert('JSON íŒŒì‹± ì˜¤ë¥˜')}}; r.readAsText(f,'utf-8')}; inp.click()});
  $('#clearMeta')?.addEventListener('click',()=>{if(confirm('ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ì‘í’ˆ ë©”íƒ€ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?')){META={}; store.set('works_meta',META); SECTIONS.forEach(s=>renderPanel(s.key));}});

  /* ===== Reports accordion ===== */
  $$('#dcarAcc .accordion-header').forEach(h=> h.addEventListener('click',()=> h.parentElement.classList.toggle('active')));

  /* ===== Lightbox ===== */
  (function(){
    const lb=$('#lightbox'); if(!lb) return; const img=lb.querySelector('img'); const cap=$('#lbCap');
    let zoom=1,ox=0,oy=0,sx=0,sy=0,drag=false;
    document.body.addEventListener('click',e=>{const c=e.target.closest('.card'); if(!c) return; const src=c.querySelector('img')?.getAttribute('src')||c.querySelector('img')?.dataset.src; if(!src) return; img.src=src; cap.textContent=c.querySelector('.caption')?.innerText||''; lb.style.opacity='1'; lb.style.pointerEvents='auto'; lb.setAttribute('aria-hidden','false'); zoom=1; ox=oy=0; img.style.transform='translate(0px,0px) scale(1)'});
    lb.addEventListener('click',e=>{if(e.target===lb){lb.style.opacity='0'; lb.style.pointerEvents='none'; lb.setAttribute('aria-hidden','true')}});
    img.addEventListener('click',()=>{if(zoom===1){zoom=2; img.style.cursor='grab'} else {zoom=1; ox=oy=0; img.style.cursor='zoom-in'} apply()});
    img.addEventListener('mousedown',e=>{if(zoom===1) return; drag=true; sx=e.clientX-ox; sy=e.clientY-oy; img.style.cursor='grabbing'}); 
    window.addEventListener('mousemove',e=>{if(!drag) return; ox=e.clientX-sx; oy=e.clientY-sy; apply()}); 
    window.addEventListener('mouseup',()=>{drag=false; if(zoom>1) img.style.cursor='grab'});
    function apply(){img.style.transform=`translate(${ox}px,${oy}px) scale(${zoom})`;}
    document.addEventListener('keydown',e=>{if(e.key==='Escape' && lb.style.pointerEvents==='auto'){lb.style.opacity='0'; lb.style.pointerEvents='none'; lb.setAttribute('aria-hidden','true')}})
  })();

  /* ===== Prayer Resonance ===== */
  (function(){
    const playBtn=$('#soundBtn'), stopBtn=$('#soundStopBtn'); if(!playBtn||!stopBtn) return;
    let ac=null,nodes=null,on=false;
    async function ensureAC(){ if(!ac){const C=window.AudioContext||window.webkitAudioContext; ac=new C({latencyHint:'interactive'})} if(ac.state==='suspended') await ac.resume(); return ac;}
    const unlock=async()=>{try{await ensureAC()}catch{} window.removeEventListener('touchend',unlock); window.removeEventListener('click',unlock)}; window.addEventListener('touchend',unlock,{once:true}); window.addEventListener('click',unlock,{once:true});
    function G(v){const g=ac.createGain(); g.gain.value=v; return g} function O(type,f){const o=ac.createOscillator(); o.type=type; o.frequency.value=f; return o}
    async function start(){ if(on) return; await ensureAC();
      const base=G(0.12),sub=G(0.05),mid=G(0.05),shim=G(0.010);
      const low=O('sine',62), low2=O('sine',124), floor=O('sine',31), ch1=O('sine',432), ch2=O('sine',528);
      const lfo1=O('sine',7.83), lfo2=O('sine',5.0);
      const lpg=G(0.07), lpg2=G(0.05); lfo1.connect(lpg).connect(base.gain); lfo2.connect(lpg2).connect(base.gain);
      const lp=ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=900; lp.Q.value=0.8;
      const bp=ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=120; bp.Q.value=0.7;
      low.connect(base).connect(bp).connect(lp); low2.connect(mid).connect(bp); floor.connect(sub).connect(bp); ch1.connect(shim).connect(lp); ch2.connect(shim).connect(lp);
      lp.connect(ac.destination); bp.connect(ac.destination);
      [low,low2,floor,ch1,ch2,lfo1,lfo2].forEach(x=>x.start());
      [base.gain,sub.gain,mid.gain,shim.gain].forEach(g=>{const v=g.value; g.setValueAtTime(Math.max(0.0001,v*0.001),ac.currentTime); g.exponentialRampToValueAtTime(v,ac.currentTime+1.2)});
      nodes={low,low2,floor,ch1,ch2,lfo1,lfo2,base,sub,mid,shim,lp,bp}; on=true; playBtn.disabled=true; stopBtn.disabled=false;
    }
    function stop(){ if(!on||!nodes||!ac) return; const {low,low2,floor,ch1,ch2,lfo1,lfo2,base,sub,mid,shim,lp}=nodes; const t=ac.currentTime;
      [base.gain,sub.gain,mid.gain,shim.gain].forEach(g=>{g.cancelScheduledValues(0); g.exponentialRampToValueAtTime(0.0001,t+1.8)}); try{lp.frequency.linearRampToValueAtTime(120,t+1.8)}catch{}
      setTimeout(()=>{[low,low2,floor,ch1,ch2,lfo1,lfo2].forEach(o=>{try{o.stop()}catch{}}); nodes=null},1900);
      on=false; playBtn.disabled=false; stopBtn.disabled=true;
    }
    playBtn.addEventListener('click',start); stopBtn.addEventListener('click',stop);
    document.addEventListener('visibilitychange',async()=>{if(!ac) return; if(document.hidden) try{await ac.suspend()}catch{} else if(on) try{await ac.resume()}catch{}});
  })();
})();
</script>
</html>