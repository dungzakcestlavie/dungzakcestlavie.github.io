<!doctype html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.21 â€” Works & Reports Auto Manager</title>
<meta name="color-scheme" content="dark light">

<style>
:root{
  --bg:#0b1020; --panel:#111a37; --ink:#eaf0ff; --sub:#9faee6;
  --accent:#f4c96b; --accent-soft:rgba(244,201,107,0.16);
  --danger:#ff5c7a; --ok:#5dd39e; --border:#1f2750;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --sans:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",system-ui,sans-serif;
}

*{box-sizing:border-box;}

html,body{
  margin:0; padding:0;
  width:100%; height:100%;
  background:radial-gradient(circle at 10% 0%, #202c60 0, #050814 40%, #030510 100%);
  color:var(--ink);
  font-family:var(--sans);
}

body{
  -webkit-font-smoothing:antialiased;
  display:flex;
  justify-content:center;
  align-items:flex-start;
}

main{
  width:100%; max-width:1240px;
  padding:16px 12px 80px;
}

@media (min-width:768px){
  main{padding:24px 24px 96px;}
}

.hero-title{
  font-size:22px;
  font-weight:700;
  letter-spacing:.04em;
  color:var(--accent);
}
.hero-sub{
  margin-top:4px;
  font-size:13px;
  color:var(--sub);
}

.badge-row{
  margin-top:6px;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:3px 8px;
  border-radius:999px;
  border:1px solid rgba(244,201,107,0.5);
  background:rgba(0,0,0,.3);
  color:var(--accent);
  font-size:11px;
}

.card{
  background:linear-gradient(145deg,rgba(17,26,55,0.96),rgba(5,9,30,0.98));
  border-radius:18px;
  border:1px solid var(--border);
  padding:14px 14px 16px;
  box-shadow:0 18px 40px rgba(0,0,0,0.55);
  margin-top:16px;
}

.card h2{
  font-size:15px;
  margin:0 0 8px;
}
.card h3{
  font-size:14px;
  margin:10px 0 6px;
}
.card p.helper{
  font-size:12px;
  color:var(--sub);
  margin:0 0 10px;
}

.field{
  margin-bottom:10px;
}
.field label{
  display:block;
  font-size:12px;
  margin-bottom:3px;
  color:var(--sub);
}
.field small{
  display:block;
  font-size:11px;
  color:var(--sub);
}
input,select,textarea{
  width:100%;
  border-radius:10px;
  border:1px solid #222a55;
  background:#050716;
  color:var(--ink);
  padding:7px 9px;
  font-size:13px;
  font-family:inherit;
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 1px rgba(244,201,107,0.3);
}
textarea{
  min-height:120px;
  resize:vertical;
}

textarea.full-text{
  font-family:var(--mono);
  font-size:12px;
  line-height:1.5;
  white-space:pre-wrap;
}

.token-input{
  font-family:var(--mono);
  font-size:11px;
}

/* ë²„íŠ¼ë“¤ */
.btn-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}
button{
  border-radius:999px;
  border:1px solid transparent;
  padding:7px 14px;
  font-size:13px;
  font-weight:500;
  cursor:pointer;
  background:var(--accent-soft);
  color:var(--accent);
}
button.primary{
  background:var(--accent);
  color:#050714;
}
button.subtle{
  background:transparent;
  border-color:#343c70;
  color:var(--sub);
}
button.danger{
  background:rgba(255,92,122,0.12);
  border-color:rgba(255,92,122,0.7);
  color:var(--danger);
}
button:disabled{
  opacity:0.5;
  cursor:default;
}

/* ìƒíƒœë°” */
.status-bar{
  margin-top:10px;
  font-size:12px;
  padding:7px 9px;
  border-radius:999px;
  background:rgba(9,16,40,0.9);
  border:1px solid #202953;
  display:flex;
  align-items:center;
  gap:6px;
}
.status-dot{
  width:8px; height:8px; border-radius:50%;
  background:#666;
}
.status-bar.ok .status-dot{background:var(--ok);}
.status-bar.err .status-dot{background:var(--danger);}
.status-text{flex:1; color:var(--sub);}

/* íƒœê·¸ / ë¦¬ìŠ¤íŠ¸ */
.tag-pill{
  display:inline-flex;
  align-items:center;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid #343f7a;
  font-size:11px;
  color:var(--sub);
  margin-right:4px;
  margin-top:6px;
}

.list{
  border-radius:12px;
  border:1px solid #202953;
  background:rgba(2,5,20,0.7);
  max-height:360px;
  overflow:auto;
  margin-top:8px;
}
.list-item{
  padding:8px 10px;
  border-bottom:1px solid #151b3d;
  font-size:12px;
  display:flex;
  flex-direction:column;
  gap:2px;
}
.list-item:last-child{border-bottom:none;}
.list-item strong{
  font-size:13px;
}
.list-item span.meta{
  color:var(--sub);
}
.list-item button{
  margin-top:4px;
  align-self:flex-start;
  font-size:11px;
  padding:4px 10px;
}

/* Works ì˜ì—­ 2ì—´ */
.works-grid{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
@media (min-width:880px){
  .works-grid{
    display:grid;
    grid-template-columns:minmax(240px,320px) minmax(0,1fr);
    align-items:flex-start;
  }
}

/* Reports ì¹´ë“œ ë ˆì´ì•„ì›ƒ */
.reports-grid{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
@media (min-width:880px){
  .reports-grid{
    display:grid;
    grid-template-columns:minmax(260px,340px) minmax(0,1fr);
    align-items:flex-start;
  }
}

/* mobile safe-area */
@supports(padding:max(0px)){
  body{
    padding-bottom:max(16px,env(safe-area-inset-bottom));
    padding-top:max(0px,env(safe-area-inset-top));
  }
}

/* prefers reduced motion */
@media (prefers-reduced-motion: reduce){
  *{scroll-behavior:auto !important; animation:none !important;transition:none !important;}
}
</style>
</head> <body data-theme="dark">
<main>

  <!-- HEADER -->
  <header class="top-head">
    <div class="hero-title">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.21</div>
    <div class="hero-sub">100 ì‘í’ˆ Â· DCAR ë¯¸í•™ ë³´ê³ ì„œ Â· GitHub ìë™ ì—°ë™ ì‹œìŠ¤í…œ</div>
    <div class="badge">
      <span>âš™ï¸ Auto GitHub Manager</span>
      <span>Works(100) + Reports(DCAR) ì™„ì „ ìë™í™”</span>
    </div>
  </header>

  <!-- GRID: ì™¼ìª½ ì„¤ì • / ì˜¤ë¥¸ìª½ ê´€ë¦¬ -->
  <section class="grid">

    <!-- LEFT: GitHub CONFIG + FILE STRUCTURE -->
    <section class="card left">
      <h2>â… . GitHub ì—°ê²° ì„¤ì •</h2>
      <p class="helper">
        í† í°ê³¼ ì €ì¥ ê²½ë¡œë¥¼ ì§€ì •í•˜ë©´ ì‘í’ˆ / ë³´ê³ ì„œê°€ ìë™ìœ¼ë¡œ ì—…ë¡œë“œë©ë‹ˆë‹¤.
      </p>

      <div class="field">
        <label>GitHub Owner</label>
        <input id="ownerInput" type="text" value="dungzakcestlavie">
      </div>

      <div class="field">
        <label>Repository</label>
        <input id="repoInput" type="text" value="dungzakcestlavie.github.io">
      </div>

      <div class="field">
        <label>Branch</label>
        <input id="branchInput" type="text" value="main">
      </div>

      <div class="field">
        <label>Personal Access Token</label>
        <input id="tokenInput" type="password" class="token-input" placeholder="ghp_...">
      </div>

      <div class="btn-row">
        <button id="btnSaveConfig" class="primary">ğŸ” ì„¤ì • ì €ì¥</button>
        <button id="btnLoadConfig" class="subtle">ğŸ“¥ ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button id="btnClearConfig" class="danger">ì´ˆê¸°í™”</button>
      </div>

      <div id="statusBar" class="status-bar">
        <div id="statusDot" class="status-dot"></div>
        <div id="statusText" class="status-text">ì¤€ë¹„ë¨</div>
      </div>

      <div class="tag-area">
        <div class="tag-pill">images/standard/*.jpg</div>
        <div class="tag-pill">images/zoom/*.jpg</div>
        <div class="tag-pill">reports/*.md</div>
        <div class="tag-pill">reports/reports.json</div>
        <div class="tag-pill">works/works.json</div>
      </div>
    </section>

    <!-- RIGHT: WORKS + REPORTS -->
    <section class="card right">

      <!-- TABS -->
      <div class="tab-bar">
        <button class="tab active" data-tab="works">ğŸ¨ ì‘í’ˆ(Works) 100 ìë™ê´€ë¦¬</button>
        <button class="tab" data-tab="reports">ğŸ“š ë¯¸í•™ ë³´ê³ ì„œ DCAR ìë™ê´€ë¦¬</button>
      </div>

      <!-- WORKS TAB -->
      <div id="tab-works" class="tab-content active">
        <h2>â…¡. ì‘í’ˆ ì—…ë¡œë“œ / ìë™ ë¶„ë¥˜</h2>
        <p class="helper">
          ì´ 100ì  ì‘í’ˆì„ 5ì„¹ì…˜ Ã— 20ì ìœ¼ë¡œ ìë™ ì •ë ¬í•©ë‹ˆë‹¤.<br>
          íŒŒì¼ëª…ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ë©° Indexì™€ 100% ì—°ë™ë©ë‹ˆë‹¤.
        </p>

        <!-- ì‘ì—… ì—…ë¡œë“œ -->
        <div class="field">
          <label>ì‘í’ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</label>
          <input id="worksFiles" type="file" accept="image/*" multiple>
        </div>

        <div class="field">
          <label>ì„¹ì…˜ ì„ íƒ</label>
          <select id="worksSection">
            <option value="lightmemory">Light & Memory</option>
            <option value="prayer">Human Prayer</option>
            <option value="rebirth">Rebirth</option>
            <option value="existence">Existence</option>
            <option value="cosmos">Cosmos</option>
          </select>
          <small>ì„¹ì…˜ë‹¹ 20ê°œì”© ìë™ ë²ˆí˜¸ ë°°ì •ë©ë‹ˆë‹¤.</small>
        </div>

        <div class="btn-row">
          <button id="btnUploadWorks" class="primary">ğŸ“¤ ì‘í’ˆ ì—…ë¡œë“œ</button>
          <button id="btnReloadWorks" class="subtle">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <h3 style="margin-top:14px;">ğŸ“‘ í˜„ì¬ ì—…ë¡œë“œëœ ì‘í’ˆ ëª©ë¡</h3>
        <div id="worksList" class="list"></div>
      </div>

      <!-- REPORTS TAB -->
      <div id="tab-reports" class="tab-content">
        <h2>â…¢. ë¯¸í•™ ë³´ê³ ì„œ ìë™ ê´€ë¦¬ (DCAR)</h2>
        <p class="helper">
          reports.json + markdown íŒŒì¼ ìë™ ìƒì„±/ì—…ë°ì´íŠ¸.<br>
          IndexëŠ” ì¦‰ì‹œ ì´ íŒŒì¼ë“¤ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
        </p>

        <div class="field">
          <label>Report ID (ì˜ˆ: DCAR-09-2025)</label>
          <input id="rId" type="text">
        </div>

        <div class="field">
          <label>Title (KO)</label>
          <input id="rTitleKo" type="text">
        </div>

        <div class="field">
          <label>Title (EN)</label>
          <input id="rTitleEn" type="text">
        </div>

        <div class="field">
          <label>Summary (KO)</label>
          <textarea id="rSummaryKo" rows="2"></textarea>
        </div>

        <div class="field">
          <label>Summary (EN)</label>
          <textarea id="rSummaryEn" rows="2"></textarea>
        </div>

        <div class="field">
          <label>ì „ì²´ ë³´ê³ ì„œ í…ìŠ¤íŠ¸ (KR/EN í˜¼ìš© Â· Markdown ê·¸ëŒ€ë¡œ)</label>
          <textarea id="rFull" class="full-text"></textarea>
        </div>

        <div class="btn-row">
          <button id="btnSaveReport" class="primary">ğŸ’¾ ë³´ê³ ì„œ ì €ì¥</button>
          <button id="btnNewReport" class="subtle">ì‹ ê·œ ë³´ê³ ì„œ</button>
        </div>

        <h3 style="margin-top:14px;">ğŸ“š ì €ì¥ëœ ë¯¸í•™ ë³´ê³ ì„œ ëª©ë¡</h3>
        <div id="reportsList" class="list"></div>
      </div>

    </section>
  </section>
</main>
</body> <script>
// ================================
// Admin Î©.21 â€” Works & Reports Auto Manager
// ================================
(function(){
  // ---------- DOM ----------
  const ownerInput   = document.getElementById('ownerInput');
  const repoInput    = document.getElementById('repoInput');
  const branchInput  = document.getElementById('branchInput');
  const tokenInput   = document.getElementById('tokenInput');

  const statusBar    = document.getElementById('statusBar');
  const statusDot    = document.getElementById('statusDot');
  const statusText   = document.getElementById('statusText');

  const worksFiles   = document.getElementById('worksFiles');
  const worksSection = document.getElementById('worksSection');
  const btnUploadWorks = document.getElementById('btnUploadWorks');
  const btnReloadWorks = document.getElementById('btnReloadWorks');
  const worksList    = document.getElementById('worksList');

  const rId          = document.getElementById('rId');
  const rTitleKo     = document.getElementById('rTitleKo');
  const rTitleEn     = document.getElementById('rTitleEn');
  const rSummaryKo   = document.getElementById('rSummaryKo');
  const rSummaryEn   = document.getElementById('rSummaryEn');
  const rFull        = document.getElementById('rFull');
  const btnSaveReport  = document.getElementById('btnSaveReport');
  const btnNewReport   = document.getElementById('btnNewReport');
  const reportsList    = document.getElementById('reportsList');

  const btnSaveConfig  = document.getElementById('btnSaveConfig');
  const btnLoadConfig  = document.getElementById('btnLoadConfig');
  const btnClearConfig = document.getElementById('btnClearConfig');

  const tabButtons   = document.querySelectorAll('.tab-bar .tab');
  const tabWorks     = document.getElementById('tab-works');
  const tabReports   = document.getElementById('tab-reports');

  // ---------- PATH & STATE ----------
  const WORKS_JSON_PATH   = 'data/works.json';       // Indexê°€ ì½ëŠ” ê²½ë¡œ
  const REPORTS_JSON_PATH = 'reports/reports.json';  // Index Reportsê°€ ì½ëŠ” ê²½ë¡œ

  let worksJsonSha   = null;
  let reportsJsonSha = null;

  // works.json ê¸°ë³¸ êµ¬ì¡° (100ê°œ / 5ì„¹ì…˜)
  let worksData = {
    "Light & Memory": [],
    "Human Prayer": [],
    "Rebirth": [],
    "Existence": [],
    "Cosmos": []
  };

  // reports.json ê¸°ë³¸ êµ¬ì¡°
  let reportsData = { reports: [] };
  let currentReportId = null;

  const SECTION_LABELS = {
    lightmemory: "Light & Memory",
    prayer     : "Human Prayer",
    rebirth    : "Rebirth",
    existence  : "Existence",
    cosmos     : "Cosmos"
  };
  const SECTION_CODES = {
    lightmemory: "LM",
    prayer     : "HP",
    rebirth    : "RB",
    existence  : "EX",
    cosmos     : "CO"
  };

  // ---------- Util ----------
  function setStatus(msg, type = 'info'){
    if(statusText) statusText.textContent = msg;
    if(!statusBar || !statusDot) return;
    statusBar.classList.remove('ok', 'err');
    if(type === 'ok') statusBar.classList.add('ok');
    if(type === 'err') statusBar.classList.add('err');
  }

  function getConfig(){
    return {
      owner : ownerInput.value.trim(),
      repo  : repoInput.value.trim(),
      branch: branchInput.value.trim(),
      token : tokenInput.value.trim()
    };
  }

  function saveConfigToLocal(){
    const cfg = getConfig();
    localStorage.setItem('dz_admin_cfg', JSON.stringify({
      owner: cfg.owner,
      repo : cfg.repo,
      branch: cfg.branch
    }));
    if(cfg.token){
      localStorage.setItem('dz_admin_token', cfg.token);
    }
    setStatus('GitHub ì„¤ì •ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤.', 'ok');
  }

  function loadConfigFromLocal(){
    try{
      const rawCfg   = localStorage.getItem('dz_admin_cfg');
      const rawToken = localStorage.getItem('dz_admin_token');
      if(rawCfg){
        const cfg = JSON.parse(rawCfg);
        if(cfg.owner)  ownerInput.value  = cfg.owner;
        if(cfg.repo)   repoInput.value   = cfg.repo;
        if(cfg.branch) branchInput.value = cfg.branch;
      }
      if(rawToken){
        tokenInput.value = rawToken;
      }
      setStatus('ì €ì¥ëœ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'ok');
    }catch(e){
      console.error(e);
      setStatus('ì €ì¥ëœ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
    }
  }

  function clearConfig(){
    localStorage.removeItem('dz_admin_cfg');
    localStorage.removeItem('dz_admin_token');
    tokenInput.value = '';
    setStatus('ì €ì¥ëœ ì„¤ì •ê³¼ í† í°ì„ ëª¨ë‘ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.', 'ok');
  }

  // ë¬¸ìì—´(Base64) ìœ í‹¸ (í•œê¸€ í¬í•¨)
  function encodeBase64(str){
    return btoa(unescape(encodeURIComponent(str)));
  }
  function decodeBase64(str){
    return decodeURIComponent(escape(atob(str)));
  }

  // íŒŒì¼ â†’ Base64 (ì´ë¯¸ì§€ ì—…ë¡œë“œìš©)
  function fileToBase64(file){
    return new Promise((resolve, reject) => {
      const fr = new FileReader();
      fr.onload = () => {
        const result = fr.result || '';
        const base64 = String(result).split(',')[1] || '';
        resolve(base64);
      };
      fr.onerror = reject;
      fr.readAsDataURL(file);
    });
  }

  // GitHub Contents API - GET / PUT ê³µí†µ
  async function ghGet(path){
    const cfg = getConfig();
    if(!cfg.owner || !cfg.repo || !cfg.branch || !cfg.token){
      throw new Error('GitHub ì„¤ì •ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. Owner / Repo / Branch / Tokenì„ í™•ì¸í•˜ì„¸ìš”.');
    }
    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(cfg.branch)}`;
    const res = await fetch(url, {
      method: 'GET',
      headers: {
        'Accept': 'application/vnd.github+json',
        'Authorization': `Bearer ${cfg.token}`
      }
    });
    return res;
  }

  async function ghPut(path, base64Content, message, sha){
    const cfg = getConfig();
    if(!cfg.owner || !cfg.repo || !cfg.branch || !cfg.token){
      throw new Error('GitHub ì„¤ì •ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. Owner / Repo / Branch / Tokenì„ í™•ì¸í•˜ì„¸ìš”.');
    }

    const body = {
      path,
      message,
      content: base64Content,
      branch : cfg.branch
    };
    if(sha){
      body.sha = sha;
    }

    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent(path)}`;
    const res = await fetch(url, {
      method: 'PUT',
      headers: {
        'Accept':'application/vnd.github+json',
        'Authorization':`Bearer ${cfg.token}`,
        'Content-Type':'application/json'
      },
      body: JSON.stringify(body)
    });

    if(!res.ok){
      const err = await res.json().catch(()=>({}));
      throw new Error((err && err.message) || `GitHub PUT ì‹¤íŒ¨ (${res.status})`);
    }
    return res.json();
  }

  // ========================
  //  WORKS â€” data/works.json
  // ========================
  async function loadWorksJson(){
    setStatus('GitHubì—ì„œ data/works.json ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');

    try{
      const res = await ghGet(WORKS_JSON_PATH);

      if(res.status === 404){
        // ìƒˆë¡œ ì‹œì‘
        worksJsonSha = null;
        worksData = {
          "Light & Memory": [],
          "Human Prayer": [],
          "Rebirth": [],
          "Existence": [],
          "Cosmos": []
        };
        setStatus('data/works.json ì´ ì—†ì–´ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤. (í˜„ì¬ 0ê°œ)', 'ok');
        renderWorksList();
        return;
      }

      if(!res.ok){
        const err = await res.json().catch(()=>({}));
        throw new Error('data/works.json ë¡œë“œ ì‹¤íŒ¨: ' + (err.message || res.status));
      }

      const json = await res.json();
      worksJsonSha = json.sha || null;
      const content = decodeBase64(String(json.content || '').replace(/\n/g,''));
      const parsed  = JSON.parse(content || '{}');

      // í‚¤ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ êµ¬ì¡°ë¡œ ë³´ì •
      worksData = Object.assign(
        {
          "Light & Memory": [],
          "Human Prayer": [],
          "Rebirth": [],
          "Existence": [],
          "Cosmos": []
        },
        parsed || {}
      );

      setStatus('data/works.json ë¡œë“œ ì™„ë£Œ.', 'ok');
      renderWorksList();
    }catch(e){
      console.error(e);
      setStatus(e.message || 'data/works.json ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
      renderWorksList();
    }
  }

  async function saveWorksJson(){
    const jsonStr = JSON.stringify(worksData, null, 2);
    const base64  = encodeBase64(jsonStr);
    setStatus('data/works.json ì €ì¥ ì¤‘â€¦');
    const result = await ghPut(
      WORKS_JSON_PATH,
      base64,
      'Update data/works.json via Admin Î©.21',
      worksJsonSha
    );
    worksJsonSha = result.content && result.content.sha || worksJsonSha;
    setStatus('data/works.json ì €ì¥ ì™„ë£Œ.', 'ok');
  }

  function renderWorksList(){
    worksList.innerHTML = '';
    const sections = Object.keys(worksData);

    let total = 0;
    sections.forEach(sec => {
      const arr = Array.isArray(worksData[sec]) ? worksData[sec] : [];
      total += arr.length;
    });

    if(total === 0){
      const div = document.createElement('div');
      div.className = 'list-item';
      div.innerHTML = '<span class="meta">ì•„ì§ ì—…ë¡œë“œëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤. (ì„¹ì…˜ë³„ ìµœëŒ€ 20ì )</span>';
      worksList.appendChild(div);
      return;
    }

    sections.forEach(sec => {
      const arr = Array.isArray(worksData[sec]) ? worksData[sec] : [];
      if(!arr.length) return;

      const header = document.createElement('div');
      header.className = 'list-item';
      header.innerHTML = `<strong>${sec}</strong><span class="meta">${arr.length} / 20 ì‘í’ˆ</span>`;
      worksList.appendChild(header);

      arr.forEach((w, idx) => {
        const row = document.createElement('div');
        row.className = 'list-item';
        const num = String(idx+1).padStart(2,'0');
        const title = (w.title_kr || w.title_en || '').trim();
        const metaTitle = title ? ` Â· ${title}` : '';
        row.innerHTML =
          `<span><strong>${num}</strong> â€” ${w.image || '(íŒŒì¼ëª… ì—†ìŒ)'}${metaTitle}</span>` +
          `<span class="meta">${w.year || ''}</span>`;
        worksList.appendChild(row);
      });
    });
  }

  async function handleUploadWorks(){
    const files = worksFiles.files;
    const sectionKey = worksSection.value;

    if(!files || !files.length){
      setStatus('ì—…ë¡œë“œí•  ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'err');
      return;
    }
    if(!SECTION_LABELS[sectionKey]){
      setStatus('ì„¹ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'err');
      return;
    }

    const label = SECTION_LABELS[sectionKey];
    const code  = SECTION_CODES[sectionKey] || 'W';
    if(!Array.isArray(worksData[label])){
      worksData[label] = [];
    }

    let currentCount = worksData[label].length;
    if(currentCount >= 20){
      setStatus(`${label} ì„¹ì…˜ì€ ì´ë¯¸ 20ì ì´ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.`, 'err');
      return;
    }

    const available = 20 - currentCount;
    const willUpload = Math.min(available, files.length);

    if(willUpload < files.length){
      setStatus(`ì´ ì„¹ì…˜ì—ëŠ” ${available}ì ë§Œ ë” ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì•ì—ì„œ ${willUpload}ì ë§Œ ì²˜ë¦¬)`, 'info');
    }

    try{
      btnUploadWorks.disabled = true;
      setStatus(`ì´ë¯¸ì§€ ${willUpload}ê°œ ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘â€¦`);

      for(let i = 0; i < willUpload; i++){
        const file = files[i];
        currentCount++;
        const indexStr = String(currentCount).padStart(2,'0');
        const ext = (file.name.split('.').pop() || 'jpg').toLowerCase();
        const safeExt = ext === 'jpeg' ? 'jpg' : ext;
        const fileName = `DZ-${code}-${indexStr}.${safeExt}`;

        setStatus(`[${i+1}/${willUpload}] ${fileName} ì—…ë¡œë“œ ì¤‘â€¦`);

        // íŒŒì¼ Base64 ë³€í™˜
        const base64 = await fileToBase64(file);

        // standard / zoom ë™ì¼ íŒŒì¼ë¡œ ì—…ë¡œë“œ (ì›ë³¸ ê·¸ëŒ€ë¡œ)
        await ghPut(
          `images/standard/${fileName}`,
          base64,
          `Upload standard image ${fileName} via Admin Î©.21`
        );
        await ghPut(
          `images/zoom/${fileName}`,
          base64,
          `Upload zoom image ${fileName} via Admin Î©.21`
        );

        // worksDataì— í•­ëª© ì¶”ê°€ (ë©”íƒ€ëŠ” ì¼ë‹¨ ë¹„ì›Œë‘ê³ , ë‚˜ì¤‘ì— ìˆ˜ë™ í¸ì§‘ ê°€ëŠ¥)
        worksData[label].push({
          image      : fileName,
          title_kr   : "",
          title_en   : "",
          material_kr: "",
          material_en: "",
          size_kr    : "",
          size_en    : "",
          year       : ""
        });
      }

      // JSON ì €ì¥
      await saveWorksJson();
      renderWorksList();
      setStatus(`ì„¹ì…˜ "${label}" ì— ì‘í’ˆ ${willUpload}ì ì„ ì¶”ê°€í•˜ê³  JSONê¹Œì§€ ì €ì¥í–ˆìŠµë‹ˆë‹¤.`, 'ok');
      worksFiles.value = '';
    }catch(e){
      console.error(e);
      setStatus(e.message || 'ì‘í’ˆ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
    }finally{
      btnUploadWorks.disabled = false;
    }
  }

  // ==========================
  //  REPORTS â€” reports.json
  // ==========================
  async function loadReportsJson(){
    setStatus('GitHubì—ì„œ reports/reports.json ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');

    try{
      const res = await ghGet(REPORTS_JSON_PATH);

      if(res.status === 404){
        reportsData = { reports: [] };
        reportsJsonSha = null;
        setStatus('reports.json ì´ ì—†ì–´ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤.', 'ok');
        renderReportsList();
        return;
      }

      if(!res.ok){
        const err = await res.json().catch(()=>({}));
        throw new Error('reports.json ë¡œë“œ ì‹¤íŒ¨: ' + (err.message || res.status));
      }

      const json = await res.json();
      reportsJsonSha = json.sha || null;
      const content = decodeBase64(String(json.content || '').replace(/\n/g,''));
      const parsed = JSON.parse(content || '{"reports":[]}');
      reportsData = parsed && Array.isArray(parsed.reports)
        ? parsed
        : { reports: [] };

      setStatus(`reports.json ë¡œë“œ ì™„ë£Œ. (${reportsData.reports.length}ê°œ)`, 'ok');
      renderReportsList();
    }catch(e){
      console.error(e);
      setStatus(e.message || 'reports.json ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
      renderReportsList();
    }
  }

  async function saveReportsJson(){
    const jsonStr = JSON.stringify(reportsData, null, 2);
    const base64  = encodeBase64(jsonStr);
    setStatus('reports.json ì €ì¥ ì¤‘â€¦');
    const result = await ghPut(
      REPORTS_JSON_PATH,
      base64,
      'Update reports.json via Admin Î©.21',
      reportsJsonSha
    );
    reportsJsonSha = result.content && result.content.sha || reportsJsonSha;
    setStatus('reports.json ì €ì¥ ì™„ë£Œ.', 'ok');
  }

  async function loadReportMarkdown(id){
    const mdPath = `reports/${id}.md`;
    setStatus(`${mdPath} ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦`);

    const res = await ghGet(mdPath);

    if(res.status === 404){
      setStatus(`${mdPath} ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'ok');
      rFull.value = '';
      return { sha:null, content:'' };
    }

    if(!res.ok){
      const err = await res.json().catch(()=>({}));
      throw new Error('Markdown ë¡œë“œ ì‹¤íŒ¨: ' + (err.message || res.status));
    }

    const data = await res.json();
    const md = decodeBase64(String(data.content || '').replace(/\n/g,''));
    rFull.value = md;
    setStatus(`${mdPath} ë¡œë“œ ì™„ë£Œ.`, 'ok');
    return { sha:data.sha, content:md };
  }

  async function saveReportMarkdown(id, existingSha){
    const mdPath  = `reports/${id}.md`;
    const base64  = encodeBase64(rFull.value || '');
    setStatus(`${mdPath} ì €ì¥ ì¤‘â€¦`);
    await ghPut(
      mdPath,
      base64,
      `Update ${mdPath} via Admin Î©.21`,
      existingSha || null
    );
    setStatus(`${mdPath} ì €ì¥ ì™„ë£Œ.`, 'ok');
  }

  function renderReportsList(){
    reportsList.innerHTML = '';
    if(!reportsData.reports.length){
      const div = document.createElement('div');
      div.className = 'list-item';
      div.innerHTML = '<span class="meta">ë“±ë¡ëœ ë¯¸í•™ ë³´ê³ ì„œê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</span>';
      reportsList.appendChild(div);
      return;
    }

    reportsData.reports
      .slice()
      .sort((a,b)=>(a.id||'').localeCompare(b.id||''))
      .forEach(r=>{
        const row = document.createElement('div');
        row.className = 'list-item';
        const title = r.title_ko || r.title_en || '';
        row.innerHTML =
          `<strong>${r.id || ''}</strong>` +
          `<span class="meta">${title}</span>`;

        const btn = document.createElement('button');
        btn.textContent = 'ì´ ë³´ê³ ì„œ ë¶ˆëŸ¬ì˜¤ê¸°';
        btn.addEventListener('click', () => loadReportIntoForm(r.id));
        row.appendChild(btn);

        reportsList.appendChild(row);
      });
  }

  function clearReportForm(){
    rId.value        = '';
    rTitleKo.value   = '';
    rTitleEn.value   = '';
    rSummaryKo.value = '';
    rSummaryEn.value = '';
    rFull.value      = '';
    currentReportId  = null;
    setStatus('ìƒˆ ë¯¸í•™ ë³´ê³ ì„œ ì…ë ¥ ì¤€ë¹„ ì™„ë£Œ.', 'ok');
  }

  async function loadReportIntoForm(id){
    const r = reportsData.reports.find(x => x.id === id);
    if(!r){
      setStatus(`reports.json ì— ${id} í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.`, 'err');
      return;
    }

    rId.value        = r.id || '';
    rTitleKo.value   = r.title_ko || '';
    rTitleEn.value   = r.title_en || '';
    rSummaryKo.value = r.summary_ko || r.summary_kr || '';
    rSummaryEn.value = r.summary_en || '';
    currentReportId  = r.id || '';

    try{
      await loadReportMarkdown(currentReportId);
    }catch(e){
      console.error(e);
      setStatus(e.message || 'Markdown ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
    }
  }

  function guessYearFromId(id){
    const m = /(\d{4})$/.exec(id || '');
    return m ? m[1] : String(new Date().getFullYear());
  }

  async function handleSaveReport(){
    const id    = rId.value.trim();
    const tEn   = rTitleEn.value.trim();
    const tKo   = rTitleKo.value.trim();
    const sKo   = rSummaryKo.value.trim();
    const sEn   = rSummaryEn.value.trim();

    if(!id || !tEn){
      setStatus('Report IDì™€ Title(EN)ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.', 'err');
      return;
    }

    const year = guessYearFromId(id);

    const obj = {
      id,
      slug       : id,
      year,
      category   : 'Theory',
      title_ko   : tKo,
      title_en   : tEn,
      summary_ko : sKo,
      summary_kr : sKo,
      summary_en : sEn,
      md_path    : `reports/${id}.md`
    };

    const idx = reportsData.reports.findIndex(x => x.id === id);
    if(idx >= 0){
      reportsData.reports[idx] = obj;
    }else{
      reportsData.reports.push(obj);
    }

    try{
      btnSaveReport.disabled = true;

      // 1) reports.json ì €ì¥
      await saveReportsJson();

      // 2) ê¸°ì¡´ md sha í™•ì¸
      let mdSha = null;
      try{
        const res = await ghGet(`reports/${id}.md`);
        if(res.ok){
          const data = await res.json();
          mdSha = data.sha;
        }
      }catch(e){
        console.warn('ê¸°ì¡´ md í™•ì¸ ì¤‘ ì˜¤ë¥˜ (ì—†ì„ ìˆ˜ ìˆìŒ):', e);
      }

      // 3) markdown ì €ì¥
      await saveReportMarkdown(id, mdSha);

      // 4) ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadReportsJson();
      currentReportId = id;
      setStatus(`ë³´ê³ ì„œ ${id} ê°€ JSON + Markdown ëª¨ë‘ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'ok');
    }catch(e){
      console.error(e);
      setStatus(e.message || 'ë³´ê³ ì„œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
    }finally{
      btnSaveReport.disabled = false;
    }
  }

  // ==========================
  //  TAB ì „í™˜
  // ==========================
  function switchTab(target){
    tabButtons.forEach(btn => {
      const t = btn.getAttribute('data-tab');
      const active = (t === target);
      btn.classList.toggle('active', active);
    });
    tabWorks.classList.toggle('active', target === 'works');
    tabReports.classList.toggle('active', target === 'reports');
  }

  tabButtons.forEach(btn => {
    btn.addEventListener('click', ()=>{
      const t = btn.getAttribute('data-tab');
      switchTab(t);
    });
  });

  // ==========================
  //  ì´ë²¤íŠ¸ ë°”ì¸ë”©
  // ==========================
  btnSaveConfig.addEventListener('click', saveConfigToLocal);
  btnLoadConfig.addEventListener('click', loadConfigFromLocal);
  btnClearConfig.addEventListener('click', ()=>{
    if(confirm('ì €ì¥ëœ Owner / Repo / Branch / Tokenì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?')){
      clearConfig();
    }
  });

  btnUploadWorks.addEventListener('click', handleUploadWorks);
  btnReloadWorks.addEventListener('click', loadWorksJson);

  btnSaveReport.addEventListener('click', handleSaveReport);
  btnNewReport.addEventListener('click', clearReportForm);

  // ==========================
  //  ì´ˆê¸°í™”
  // ==========================
  document.addEventListener('DOMContentLoaded', ()=>{
    // ì„¤ì • ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
    loadConfigFromLocal();
    // Works / Reports JSON ë¶ˆëŸ¬ì˜¤ê¸° (í† í° ì—†ìœ¼ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ë§Œ ì¶œë ¥)
    loadWorksJson().catch(e => console.error(e));
    loadReportsJson().catch(e => console.error(e));
    switchTab('works');
    setStatus('Admin Î©.21 ë¡œë“œ ì™„ë£Œ. GitHub ì„¤ì •ì„ í™•ì¸í•œ í›„ ì‚¬ìš©í•˜ì„¸ìš”.');
  });

})();
</script>