<!doctype html>
<html lang="ko" data-theme="dark">
<!-- â‘  HEAD / STYLE -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.30 â€” Works & DCAR Auto Manager</title>
  <meta name="color-scheme" content="dark light">
  <meta name="description" content="ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.30 â€” Works ìë™ ì—…ë¡œë“œ Â· DCAR ë¯¸í•™ ë³´ê³ ì„œ(100í¸ ì´ìƒ) ë¬´ì œí•œ ì—…ë¡œë“œ Â· GitHub Pages ì—°ë™ ê´€ë¦¬ì.">

  <style>
    :root{
      --bg:#0b1020; --panel:#111a37; --panel-soft:#151c3d;
      --ink:#eaf0ff; --sub:#9faee6;
      --accent:#f4c96b; --accent-soft:rgba(244,201,107,0.18);
      --danger:#ff5175; --muted:#6f7bb3;
      --border:#222b52;
      --radius-lg:18px; --radius-md:999px; --radius-sm:9px;
      --shadow-soft:0 22px 60px rgba(0,0,0,0.65);
      --font-main:-apple-system,BlinkMacSystemFont,"SF Pro Text","Noto Sans KR",system-ui,sans-serif;
    }

    *{box-sizing:border-box; margin:0; padding:0;}
    html,body{height:100%; background:radial-gradient(circle at top,#1b2450 0,#050814 55%,#02040a 100%); color:var(--ink); font-family:var(--font-main); -webkit-text-size-adjust:100%;}
    body{padding:14px 10px 40px; line-height:1.5;}

    .shell{
      max-width:960px;
      margin:0 auto;
      background:radial-gradient(circle at top left,#1b244b 0, #050816 52%,#02030a 100%);
      border-radius:24px;
      box-shadow:var(--shadow-soft);
      padding:18px 14px 32px;
      border:1px solid rgba(255,255,255,0.06);
    }

    header{
      padding:4px 4px 14px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      margin-bottom:14px;
    }
    .site-title{
      font-size:18px;
      letter-spacing:0.12em;
      font-weight:700;
      text-align:center;
    }
    .site-title small{
      display:block;
      font-size:11px;
      font-weight:500;
      color:var(--muted);
      margin-top:3px;
    }
    .admin-version{
      margin-top:8px;
      text-align:center;
      font-size:13px;
      color:var(--sub);
    }
    .chip-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:8px;
      margin-top:10px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 11px;
      border-radius:999px;
      font-size:11px;
      background:rgba(7,10,25,0.9);
      border:1px solid rgba(244,201,107,0.40);
      color:var(--accent);
      box-shadow:0 8px 20px rgba(0,0,0,0.45);
    }
    .chip span.icon{
      font-size:13px;
    }

    .mode-tabs{
      display:flex;
      gap:8px;
      margin-top:16px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .mode-tab{
      flex:0 1 auto;
      min-width:110px;
      text-align:center;
      padding:7px 12px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(2,4,15,0.7);
      color:var(--sub);
    }
    .mode-tab strong{font-weight:700;}
    .flag{
      background:rgba(255,255,255,0.06);
      border-radius:999px;
      padding:3px 8px;
      font-size:10px;
      margin-left:6px;
      color:var(--accent);
    }

    main{margin-top:18px;}

    .section-tabs{
      display:flex;
      gap:6px;
      margin-bottom:14px;
      padding:4px;
      background:rgba(2,5,16,0.9);
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.06);
    }
    .section-tab{
      flex:1;
      padding:8px 4px;
      font-size:13px;
      text-align:center;
      border-radius:999px;
      color:var(--muted);
      background:transparent;
      border:none;
    }
    .section-tab.active{
      background:linear-gradient(135deg,#f4c96b,#ffe08d);
      color:#1a1430;
      font-weight:700;
      box-shadow:0 10px 26px rgba(0,0,0,0.65);
    }

    .panel{
      background:linear-gradient(145deg,rgba(12,18,46,0.97),rgba(9,13,33,0.97));
      border-radius:var(--radius-lg);
      border:1px solid var(--border);
      padding:16px 14px 18px;
      margin-bottom:16px;
      position:relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-60%;
      background:radial-gradient(circle at 0% 0%,rgba(244,201,107,0.08),transparent 60%);
      opacity:0.9;
      pointer-events:none;
    }
    .panel-inner{position:relative;}

    .panel-title{
      font-size:15px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      margin-bottom:4px;
      display:flex;
      align-items:center;
      gap:7px;
    }
    .panel-title span.index{
      font-size:13px;
      color:var(--accent);
    }
    .panel-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
    }

    label{
      display:block;
      font-size:12px;
      margin-top:9px;
      margin-bottom:3px;
      color:var(--sub);
    }
    input[type="text"],
    input[type="number"],
    input[type="file"],
    textarea,
    select{
      width:100%;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.13);
      background:rgba(4,7,20,0.95);
      color:var(--ink);
      padding:8px 10px;
      font-size:13px;
      outline:none;
    }
    textarea{min-height:80px; resize:vertical;}
    input::placeholder,textarea::placeholder{color:#5c679c;}

    .hint{
      font-size:11px;
      color:var(--muted);
      margin-top:2px;
    }
    .small-hint{
      font-size:10px;
      color:var(--muted);
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:12px;
    }
    .btn{
      flex:0 0 auto;
      padding:8px 14px;
      border-radius:999px;
      font-size:13px;
      border:none;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .btn-primary{
      background:linear-gradient(135deg,#f4c96b,#ffd77f);
      color:#1a1430;
      font-weight:700;
      box-shadow:0 10px 24px rgba(0,0,0,0.7);
    }
    .btn-secondary{
      background:rgba(11,15,34,0.95);
      color:var(--sub);
      border:1px solid rgba(255,255,255,0.18);
    }
    .btn-danger{
      background:rgba(255,81,117,0.14);
      color:#ff89a5;
      border:1px solid rgba(255,81,117,0.7);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:3px 8px;
      font-size:10px;
      border-radius:999px;
      background:rgba(9,14,40,0.9);
      border:1px solid rgba(255,255,255,0.09);
      color:var(--muted);
      margin-top:6px;
    }

    .info-row{
      margin-top:10px;
      font-size:11px;
      color:var(--muted);
      display:flex;
      gap:8px;
      align-items:flex-start;
    }
    .info-row strong{color:var(--accent); font-weight:600;}

    .log{
      margin-top:12px;
      padding:10px;
      border-radius:10px;
      background:rgba(4,7,20,0.95);
      border:1px solid rgba(255,255,255,0.12);
      font-size:11px;
      max-height:180px;
      overflow:auto;
      white-space:pre-wrap;
    }
    .log b{color:var(--accent);}
    .log.error{border-color:var(--danger); color:#ffadbc;}

    .section-hidden{display:none;}

    .pill{
      display:inline-flex;
      align-items:center;
      padding:3px 8px;
      border-radius:999px;
      font-size:10px;
      background:rgba(10,15,40,0.9);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.08);
      gap:4px;
    }

    .list{
      margin-top:10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(4,7,20,0.95);
      max-height:220px;
      overflow:auto;
      font-size:12px;
    }
    .list-item{
      padding:7px 10px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }
    .list-item:last-child{border-bottom:none;}
    .list-item strong{font-weight:600;}
    .list-item span.meta{font-size:11px; color:var(--muted);}
    .list-empty{
      padding:10px;
      font-size:11px;
      color:var(--muted);
    }

    footer{
      text-align:center;
      margin-top:20px;
      font-size:11px;
      color:var(--muted);
    }
    footer span.brand{color:var(--accent);}
    footer small{display:block; margin-top:4px; font-size:10px;}

    @media (min-width:760px){
      body{padding:20px 18px 38px;}
      .shell{padding:22px 26px 34px;}
      header{padding-bottom:18px; margin-bottom:18px;}
      .panel{padding:18px 18px 20px;}
    }
  </style>
</head>

<!-- â‘¡ BODY / HTML -->
<body>
  <div class="shell">
    <header>
      <div class="site-title">
        ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.30
        <small>Works(100) Â· DCAR ë¯¸í•™ ë³´ê³ ì„œ ë¬´ì œí•œ Â· GitHub Pages ì—°ë™</small>
      </div>
      <div class="admin-version">
        Works & DCAR Auto Manager Â· Reports Untouched Â· Local-only Token Storage
      </div>
      <div class="chip-row">
        <div class="chip"><span class="icon">âš™ï¸</span><span>AUTO GITHUB MANAGER</span></div>
        <div class="chip"><span class="icon">ğŸ–¼</span><span>WORKS JSON êµ¬ì¡° ê³ ì •</span></div>
        <div class="chip"><span class="icon">ğŸ“‘</span><span>DCAR REPORTS Â· UNTOUCHED</span></div>
      </div>
      <div class="mode-tabs">
        <div class="mode-tab">
          <strong>Works</strong><span class="flag">100 Slots Â· Iâ€“V</span>
        </div>
        <div class="mode-tab">
          <strong>DCAR</strong><span class="flag">No.1â€“âˆ Â· Auto Index</span>
        </div>
      </div>
    </header>

    <main>
      <!-- Works / DCAR íƒ­ -->
      <div class="section-tabs">
        <button class="section-tab active" data-target="works-section">Works</button>
        <button class="section-tab" data-target="dcar-section">DCAR (ê³ ì •)</button>
      </div>

      <!-- ê³µí†µ: GitHub ì—°ê²° ì„¤ì • -->
      <section class="panel">
        <div class="panel-inner">
          <div class="panel-title">
            <span class="index">I.</span> GITHUB ì—°ê²° ì„¤ì •
          </div>
          <div class="panel-sub">
            ì•„ë˜ ê°’ì€ ë¸Œë¼ìš°ì € <b>localStorage</b>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šìœ¼ë©°, í•œ ë²ˆ ì €ì¥í•˜ë©´ ì´í›„ì—ëŠ” ë‹¤ì‹œ ì…ë ¥í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
          </div>

          <label for="gh-owner">GitHub Owner</label>
          <input id="gh-owner" type="text" placeholder="ì˜ˆ: dungzakcestlavie">

          <label for="gh-repo">Repository</label>
          <input id="gh-repo" type="text" placeholder="ì˜ˆ: dungzakcestlavie.github.io">

          <label for="gh-branch">Branch</label>
          <input id="gh-branch" type="text" placeholder="ì˜ˆ: main" value="main">

          <label for="gh-token">Personal Access Token (github_pat_â€¦)</label>
          <input id="gh-token" type="text" placeholder="github_pat_ ë¡œ ì‹œì‘í•˜ëŠ” í† í°ì„ ì…ë ¥í•˜ì„¸ìš”">

          <div class="btn-row">
            <button type="button" class="btn btn-primary" id="btn-save-gh">ì„¤ì • ì €ì¥</button>
            <button type="button" class="btn btn-secondary" id="btn-load-gh">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button type="button" class="btn btn-danger" id="btn-clear-gh">ì´ˆê¸°í™”</button>
          </div>

          <div class="info-row">
            <strong>i</strong>
            <div>
              GitHub í† í°ì—ëŠ” <b>repo â†’ contents: read/write</b> ê¶Œí•œë§Œ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤.<br>
              ì„¤ì •ì„ ì €ì¥í•œ ë’¤ ì•„ë˜ Works / DCAR ì—…ë¡œë“œë¥¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.
            </div>
          </div>
          <div class="badge">
            ğŸ”’ ì´ í˜ì´ì§€ëŠ” í† í°ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì•ˆ(localStorage)ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.
          </div>
          <div id="gh-log" class="log" aria-live="polite"></div>
        </div>
      </section>

      <!-- Works SECTION -->
      <section id="works-section" class="section-visible">
        <!-- Works ì—…ë¡œë“œ -->
        <section class="panel">
          <div class="panel-inner">
            <div class="panel-title">
              <span class="index">II.</span> ì‘í’ˆ ì—…ë¡œë“œ Â· ë©”íƒ€ë°ì´í„° ìë™ ê´€ë¦¬
            </div>
            <div class="panel-sub">
              í•œ ë²ˆì— 1ì ì”© ì—…ë¡œë“œí•©ë‹ˆë‹¤. ì´ë¯¸ì§€ëŠ” <code>/images/zoom/DZ-XXX.jpg</code>ë¡œ ì €ì¥ë˜ê³ ,
              <code>data/works.json</code>ì— ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. ê¸°ì¡´ êµ¬ì¡°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
            </div>

            <label for="work-file">ì‘í’ˆ ì´ë¯¸ì§€ íŒŒì¼</label>
            <input id="work-file" type="file" accept="image/jpeg,image/jpg">
            <p class="hint">Â· ê°€ê¸‰ì  3000px ì´ìƒ JPG ì‚¬ìš© Â· íŒŒì¼ ì´ë¦„ì€ ìë™ìœ¼ë¡œ <code>DZ-XXX.jpg</code> í˜•ì‹ìœ¼ë¡œ ì •ë¦¬ë©ë‹ˆë‹¤.</p>

            <label for="work-section">ì„¹ì…˜ ì„ íƒ (Section)</label>
            <select id="work-section">
              <option value="I ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” Â· Pray for Us">I ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” Â· Pray for Us</option>
              <option value="II ì¸ê°„ Â· Human Being">II ì¸ê°„ Â· Human Being</option>
              <option value="III ì •ì‹ ì˜ ì¬íƒ„ìƒ Â· Rebirth of Mind">III ì •ì‹ ì˜ ì¬íƒ„ìƒ Â· Rebirth of Mind</option>
              <option value="IV ì¡´ì¬ì˜ íšŒë³µ Â· Restoration of Being">IV ì¡´ì¬ì˜ íšŒë³µ Â· Restoration of Being</option>
              <option value="V ë¹›ì˜ ì´ˆì˜ì‹ Â· Metaconsciousness of Light">V ë¹›ì˜ ì´ˆì˜ì‹ Â· Metaconsciousness of Light</option>
            </select>

            <label for="work-title-kr">ì‘í’ˆ ì œëª© (KR)</label>
            <input id="work-title-kr" type="text" placeholder="ì˜ˆ: ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš”">

            <label for="work-title-en">Artwork Title (EN)</label>
            <input id="work-title-en" type="text" placeholder="ì˜ˆ: Pray for Us">

            <label for="work-year">ì—°ë„ (Year)</label>
            <input id="work-year" type="number" inputmode="numeric" placeholder="ì˜ˆ: 2025">

            <label for="work-size">ì‘í’ˆ ì‚¬ì´ì¦ˆ (Size)</label>
            <input id="work-size" type="text" placeholder="ì˜ˆ: 162.2Ã—130.3cm">

            <label for="work-material">ì¬ë£Œ (Material)</label>
            <input id="work-material" type="text" placeholder="ì˜ˆ: acrylic on canvas">

            <label for="work-note">ë©”ëª¨ / ë¹„ê³  (ì„ íƒ)</label>
            <textarea id="work-note" placeholder="ë‚´ë¶€ ê¸°ë¡ìš© ë©”ëª¨, ì„¤ì¹˜ ì¥ì†Œ, ì»¬ë ‰í„° ì •ë³´ ë“±"></textarea>

            <div class="btn-row">
              <button type="button" class="btn btn-primary" id="btn-upload-work">ì‘í’ˆ ì—…ë¡œë“œ</button>
            </div>

            <div class="info-row">
              <strong>i</strong>
              <div>
                AdminëŠ” <code>data/works.json</code>ì„ ë¶ˆëŸ¬ì™€ ë‹¤ìŒ ì‚¬ìš© ê°€ëŠ¥í•œ <code>DZ-XXX</code> ë²ˆí˜¸ë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•˜ê³ ,
                ê¸°ì¡´ êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•œ ì±„ ë§¨ ë’¤ì— 1ê°œ í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
              </div>
            </div>

            <div id="works-log" class="log" aria-live="polite"></div>
          </div>
        </section>
      </section>

      <!-- DCAR SECTION -->
      <section id="dcar-section" class="section-hidden">
        <!-- DCAR ì—…ë¡œë“œ -->
        <section class="panel">
          <div class="panel-inner">
            <div class="panel-title">
              <span class="index">II.</span> DCAR ë¯¸í•™ ë³´ê³ ì„œ ì—…ë¡œë“œ Â· íŒŒì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
            </div>
            <div class="panel-sub">
              Markdown íŒŒì¼ì„ <code>/reports/</code> í´ë”ì— ê·¸ëŒ€ë¡œ ì˜¬ë¦½ë‹ˆë‹¤.  
              ë‚´ìš©ì€ ìˆ˜ì •í•˜ì§€ ì•Šê³  íŒŒì¼ ìì²´ë§Œ ì €ì¥í•©ë‹ˆë‹¤. 1â€“âˆ, 100í¸ ì´ìƒê¹Œì§€ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </div>

            <label for="dcar-number">DCAR ë²ˆí˜¸ (ì˜ˆ: 10)</label>
            <input id="dcar-number" type="number" inputmode="numeric" placeholder="ì˜ˆ: 10">

            <label for="dcar-year">ì—°ë„ (Year)</label>
            <input id="dcar-year" type="number" inputmode="numeric" value="2025">

            <p class="hint">
              ì‹¤ì œ íŒŒì¼ëª…ì€ <code>DCAR-ë²ˆí˜¸-ì—°ë„.md</code> í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.  
              ì˜ˆ: <code>DCAR-10-2025.md</code>, <code>DCAR-103-2025.md</code>
            </p>

            <label for="dcar-file">ë³´ê³ ì„œ íŒŒì¼ (Markdown .md)</label>
            <input id="dcar-file" type="file" accept=".md,text/markdown">
            <p class="hint">Â· ë¯¸í•™ ë³´ê³ ì„œ ë³¸ë¬¸ì€ ì´ íŒŒì¼ ì•ˆì— ê·¸ëŒ€ë¡œ ë„£ì–´ ì£¼ì„¸ìš”. Adminì€ ë‚´ìš©ì„ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

            <div class="btn-row">
              <button type="button" class="btn btn-primary" id="btn-upload-dcar">DCAR íŒŒì¼ ì—…ë¡œë“œ</button>
              <button type="button" class="btn btn-secondary" id="btn-refresh-dcar">í˜„ì¬ DCAR ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="info-row">
              <strong>i</strong>
              <div>
                ì—…ë¡œë“œ ì´í›„, Index í˜ì´ì§€ì—ì„œëŠ” <code>/reports/</code> í´ë”ë¥¼ ìŠ¤ìº”í•˜ì—¬  
                <code>DCAR-XX-YYYY.md</code> íŒ¨í„´ íŒŒì¼ì„ ìë™ìœ¼ë¡œ ì°¾ì•„ Accordion ëª©ë¡ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
                ìŠ¬ë¡¯ ì—†ì´ 1â€“âˆê¹Œì§€ í™•ì¥ë©ë‹ˆë‹¤.
              </div>
            </div>

            <div id="dcar-log" class="log" aria-live="polite"></div>
          </div>
        </section>

        <!-- DCAR ëª©ë¡ ë·°ì–´ -->
        <section class="panel">
          <div class="panel-inner">
            <div class="panel-title">
              <span class="index">III.</span> í˜„ì¬ Repoì˜ DCAR ë³´ê³ ì„œ ëª©ë¡ (Untouched Files)
            </div>
            <div class="panel-sub">
              GitHubì˜ <code>/reports/</code> í´ë”ì—ì„œ <code>DCAR-*.md</code> íŒŒì¼ì„ ì½ì–´ì˜µë‹ˆë‹¤.  
              ì—¬ê¸°ì„œëŠ” íŒŒì¼ ì´ë¦„ê³¼ ê²½ë¡œë§Œ ë³´ì—¬ì£¼ë©°, ë‚´ìš©ì€ ì—´ì–´ ë³´ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>

            <div class="pill">ğŸ“‚ /reports/ Â· DCAR-*.md</div>

            <div id="dcar-list" class="list">
              <div class="list-empty">ì•„ì§ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìœ„ì˜ â€œëª©ë¡ ìƒˆë¡œê³ ì¹¨â€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</div>
            </div>
          </div>
        </section>
      </section>

      <footer>
        <span class="brand">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Admin Î©.30</span>
        <small>Orchestrated with Lumera â€” Light, Memory, and Being.</small>
      </footer>
    </main>
  </div>

  <!-- â‘¢ SCRIPTS -->
  <script>
    // ------------------------------
    // ê³µí†µ ë„ìš°ë¯¸
    // ------------------------------
    const $ = (sel) => document.querySelector(sel);

    function setLog(el, message, isError=false){
      if(!el) return;
      el.classList.toggle('error', !!isError);
      const time = new Date().toLocaleTimeString();
      el.textContent = "["+time+"] " + message;
    }

    function appendLog(el, message, isError=false){
      if(!el) return;
      el.classList.toggle('error', !!isError);
      const time = new Date().toLocaleTimeString();
      el.textContent += "\\n[" + time + "] " + message;
      el.scrollTop = el.scrollHeight;
    }

    // Base64 ì¸ì½”ë”© (íŒŒì¼ â†’ base64)
    function fileToBase64(file){
      return new Promise((resolve, reject)=>{
        const reader = new FileReader();
        reader.onload = () => {
          const result = reader.result;
          const base64 = result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // ë¬¸ìì—´ì„ Base64ë¡œ
    function textToBase64(str){
      return btoa(unescape(encodeURIComponent(str)));
    }

    // GitHub API ê¸°ë³¸ ì •ë³´
    function getGithubConfig(){
      const owner = $('#gh-owner').value.trim();
      const repo  = $('#gh-repo').value.trim();
      const branch= $('#gh-branch').value.trim() || 'main';
      const token = $('#gh-token').value.trim();
      if(!owner || !repo || !branch || !token) return null;
      return {owner, repo, branch, token};
    }

    function getGithubHeaders(token){
      return {
        'Authorization': 'Bearer ' + token,
        'Accept': 'application/vnd.github+json'
      };
    }

    function githubContentUrl({owner,repo,path}){
      return `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
    }

    // íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ (sha ì–»ê¸°ìš©)
    async function fetchGithubFileMeta(cfg, path){
      const url = githubContentUrl({owner:cfg.owner, repo:cfg.repo, path}) + `?ref=${encodeURIComponent(cfg.branch)}`;
      const res = await fetch(url, {headers:getGithubHeaders(cfg.token)});
      if(res.status === 404) return null;
      if(!res.ok) throw new Error('íŒŒì¼ ë©”íƒ€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + res.status);
      return await res.json();
    }

    // GitHubì— íŒŒì¼ PUT
    async function putGithubFile(cfg, path, base64Content, message, sha){
      const url = githubContentUrl({owner:cfg.owner, repo:cfg.repo, path});
      const body = {
        message,
        content: base64Content,
        branch: cfg.branch
      };
      if(sha) body.sha = sha;
      const res = await fetch(url,{
        method:'PUT',
        headers:Object.assign({'Content-Type':'application/json'}, getGithubHeaders(cfg.token)),
        body:JSON.stringify(body)
      });
      if(!res.ok){
        const text = await res.text();
        throw new Error('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + res.status + ' / ' + text);
      }
      return await res.json();
    }

    // GitHub JSON ë¶ˆëŸ¬ì˜¤ê¸°
    async function fetchJsonFile(cfg, path){
      const meta = await fetchGithubFileMeta(cfg,path);
      if(!meta || !meta.content) throw new Error('JSON íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: '+path);
      const decoded = decodeURIComponent(escape(atob(meta.content)));
      return {json:JSON.parse(decoded), sha:meta.sha};
    }

    // ------------------------------
    // GitHub ì„¤ì • ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    // ------------------------------
    const STORAGE_KEY = 'dungzak_admin_github';

    function loadGithubSettingsFromStorage(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return;
        const cfg = JSON.parse(raw);
        $('#gh-owner').value  = cfg.owner || '';
        $('#gh-repo').value   = cfg.repo || '';
        $('#gh-branch').value = cfg.branch || 'main';
        $('#gh-token').value  = cfg.token || '';
        setLog($('#gh-log'),'ì €ì¥ëœ GitHub ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
      }catch(e){
        setLog($('#gh-log'),'ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜: ' + e.message,true);
      }
    }

    function saveGithubSettingsToStorage(){
      const owner = $('#gh-owner').value.trim();
      const repo  = $('#gh-repo').value.trim();
      const branch= $('#gh-branch').value.trim() || 'main';
      const token = $('#gh-token').value.trim();
      if(!owner || !repo || !branch || !token){
        setLog($('#gh-log'),'ëª¨ë“  GitHub ì„¤ì • ê°’ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.',true);
        return;
      }
      const cfg = {owner, repo, branch, token};
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
      setLog($('#gh-log'),'GitHub ì„¤ì •ì´ localStorageì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function clearGithubSettings(){
      localStorage.removeItem(STORAGE_KEY);
      $('#gh-owner').value = '';
      $('#gh-repo').value = '';
      $('#gh-branch').value = 'main';
      $('#gh-token').value = '';
      setLog($('#gh-log'),'GitHub ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ------------------------------
    // Works ì—…ë¡œë“œ ë¡œì§
    // ------------------------------
    async function handleUploadWork(){
      const logEl = $('#works-log');
      const cfg = getGithubConfig();
      if(!cfg){
        setLog(logEl,'ë¨¼ì € GitHub ì„¤ì •ì„ ëª¨ë‘ ì…ë ¥Â·ì €ì¥í•´ ì£¼ì„¸ìš”.',true);
        return;
      }

      const fileInput = $('#work-file');
      const file = fileInput.files[0];
      if(!file){
        setLog(logEl,'ì—…ë¡œë“œí•  ì‘í’ˆ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.',true);
        return;
      }

      const section  = $('#work-section').value;
      const titleKR  = $('#work-title-kr').value.trim();
      const titleEN  = $('#work-title-en').value.trim();
      const year     = $('#work-year').value.trim();
      const size     = $('#work-size').value.trim();
      const material = $('#work-material').value.trim();
      const note     = $('#work-note').value.trim();

      if(!titleKR || !titleEN || !year || !size || !material){
        setLog(logEl,'ì œëª©(KR/EN), ì—°ë„, ì‚¬ì´ì¦ˆ, ì¬ë£ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.',true);
        return;
      }

      try{
        setLog(logEl,'data/works.jsonì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');

        const {json, sha} = await fetchJsonFile(cfg,'data/works.json');
        const works = Array.isArray(json) ? json : (json.works || []);

        // ë‹¤ìŒ DZ ë²ˆí˜¸ ê³„ì‚°
        let maxNum = 0;
        const re = /^DZ-(\d{3})/;
        works.forEach(w=>{
          const id = w.id || w.work_id || w.code;
          if(typeof id === 'string'){
            const m = id.match(re);
            if(m){
              const n = parseInt(m[1],10);
              if(n>maxNum) maxNum = n;
            }
          }
        });
        const next = maxNum + 1;
        const nextStr = String(next).padStart(3,'0');
        const workId = `DZ-${nextStr}`;

        // ì´ë¯¸ì§€ íŒŒì¼ëª…
        const imgFileName = `${workId}.jpg`;
        const imgPath = `images/zoom/${imgFileName}`;

        appendLog(logEl,`ë‹¤ìŒ ì‘í’ˆ ID: ${workId} / ì´ë¯¸ì§€: ${imgPath}`);

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ
        appendLog(logEl,'ì‘í’ˆ ì´ë¯¸ì§€ë¥¼ GitHubì— ì—…ë¡œë“œ ì¤‘â€¦');
        const imgBase64 = await fileToBase64(file);
        await putGithubFile(cfg,imgPath,imgBase64,`Add artwork image ${imgFileName}`);

        appendLog(logEl,'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ. works.json ì—…ë°ì´íŠ¸ ì¤‘â€¦');

        const newWork = {
          id: workId,
          section,
          title_kr: titleKR,
          title_en: titleEN,
          year,
          size,
          material,
          note,
          image: imgPath
        };

        // works êµ¬ì¡° ìœ ì§€: ë°°ì—´ì´ë¼ë©´ push, ê°ì²´ë¼ë©´ .worksì— push
        let newJson;
        if(Array.isArray(json)){
          json.push(newWork);
          newJson = json;
        }else{
          if(!Array.isArray(json.works)) json.works = [];
          json.works.push(newWork);
          newJson = json;
        }

        const updatedBase64 = textToBase64(JSON.stringify(newJson,null,2));
        await putGithubFile(cfg,'data/works.json',updatedBase64,`Add artwork ${workId}`,sha);

        appendLog(logEl,'works.json ì—…ë°ì´íŠ¸ ì™„ë£Œ. GitHub Actions ë°°í¬ í›„ ì‚¬ì´íŠ¸ì— ì‘í’ˆì´ í‘œì‹œë©ë‹ˆë‹¤.');
        fileInput.value = '';
      }catch(e){
        appendLog(logEl,'ì˜¤ë¥˜: '+e.message,true);
      }
    }

    // ------------------------------
    // DCAR ì—…ë¡œë“œ & ëª©ë¡
    // ------------------------------
    async function handleUploadDCAR(){
      const logEl = $('#dcar-log');
      const cfg = getGithubConfig();
      if(!cfg){
        setLog(logEl,'ë¨¼ì € GitHub ì„¤ì •ì„ ëª¨ë‘ ì…ë ¥Â·ì €ì¥í•´ ì£¼ì„¸ìš”.',true);
        return;
      }

      const numStr = $('#dcar-number').value.trim();
      const yearStr = $('#dcar-year').value.trim();
      const fileInput = $('#dcar-file');
      const file = fileInput.files[0];

      if(!numStr || !yearStr || !file){
        setLog(logEl,'DCAR ë²ˆí˜¸, ì—°ë„, Markdown íŒŒì¼ì„ ëª¨ë‘ ì…ë ¥Â·ì„ íƒí•´ ì£¼ì„¸ìš”.',true);
        return;
      }

      const n = parseInt(numStr,10);
      if(isNaN(n) || n <= 0){
        setLog(logEl,'DCAR ë²ˆí˜¸ëŠ” 1 ì´ìƒì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.',true);
        return;
      }

      const filename = `DCAR-${n}-${yearStr}.md`;
      const path = `reports/${filename}`;

      try{
        setLog(logEl,`${filename} ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘â€¦`);

        const existing = await fetchGithubFileMeta(cfg,path); // ìˆì„ ìˆ˜ë„, ì—†ì„ ìˆ˜ë„
        if(existing){
          appendLog(logEl,`ì£¼ì˜: ${filename} ì´(ê°€) ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ë‚´ìš©ì„ ë®ì–´ì”ë‹ˆë‹¤.`);
        }

        const base64 = await fileToBase64(file);
        await putGithubFile(cfg,path,base64,`Add/Update DCAR report ${filename}`, existing && existing.sha);

        appendLog(logEl,`${filename} ì—…ë¡œë“œ ì™„ë£Œ. DCAR IndexëŠ” /reports í´ë”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
        fileInput.value = '';
      }catch(e){
        appendLog(logEl,'ì˜¤ë¥˜: '+e.message,true);
      }
    }

    async function refreshDCARList(){
      const listEl = $('#dcar-list');
      const logEl = $('#dcar-log');
      const cfg = getGithubConfig();
      if(!cfg){
        setLog(logEl,'ë¨¼ì € GitHub ì„¤ì •ì„ ëª¨ë‘ ì…ë ¥Â·ì €ì¥í•´ ì£¼ì„¸ìš”.',true);
        return;
      }

      listEl.innerHTML = '<div class="list-empty">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>';

      try{
        const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${encodeURIComponent('reports')}?ref=${encodeURIComponent(cfg.branch)}`;
        const res = await fetch(url,{headers:getGithubHeaders(cfg.token)});
        if(res.status === 404){
          listEl.innerHTML = '<div class="list-empty">/reports í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € repoì— í´ë”ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.</div>';
          return;
        }
        if(!res.ok) throw new Error('ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: '+res.status);
        const data = await res.json();
        const files = (Array.isArray(data) ? data : []).filter(item=>{
          return item.type === 'file' && /^DCAR-\d+-\d+\.md$/i.test(item.name);
        }).sort((a,b)=> a.name.localeCompare(b.name,undefined,{numeric:true}));

        if(!files.length){
          listEl.innerHTML = '<div class="list-empty">DCAR ë³´ê³ ì„œ íŒŒì¼ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. ìƒˆ íŒŒì¼ì„ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.</div>';
          return;
        }

        listEl.innerHTML = '';
        files.forEach(file=>{
          const m = file.name.match(/^DCAR-(\d+)-(\d+)\.md$/i);
          const num = m ? m[1] : '?';
          const yr  = m ? m[2] : '';
          const item = document.createElement('div');
          item.className = 'list-item';
          const left = document.createElement('div');
          left.innerHTML = `<strong>No.${num}</strong> <span class="meta">${file.name}</span>`;
          const right = document.createElement('span');
          right.className = 'meta';
          right.textContent = yr ? yr : '';
          item.appendChild(left);
          item.appendChild(right);
          listEl.appendChild(item);
        });

        appendLog(logEl,`DCAR ëª©ë¡ ${files.length}ê±´ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
      }catch(e){
        listEl.innerHTML = '<div class="list-empty">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        appendLog(logEl,'ì˜¤ë¥˜: '+e.message,true);
      }
    }

    // ------------------------------
    // íƒ­ ì „í™˜
    // ------------------------------
    function setupTabs(){
      const tabs = document.querySelectorAll('.section-tab');
      tabs.forEach(tab=>{
        tab.addEventListener('click',()=>{
          tabs.forEach(t=>t.classList.remove('active'));
          tab.classList.add('active');

          const targetId = tab.getAttribute('data-target');
          const worksSection = $('#works-section');
          const dcarSection  = $('#dcar-section');

          if(targetId === 'works-section'){
            worksSection.classList.remove('section-hidden');
            dcarSection.classList.add('section-hidden');
          }else{
            dcarSection.classList.remove('section-hidden');
            worksSection.classList.add('section-hidden');
          }
        });
      });
    }

    // ------------------------------
    // ì´ˆê¸°í™”
    // ------------------------------
    document.addEventListener('DOMContentLoaded',()=>{
      // GitHub ì„¤ì • ë²„íŠ¼
      $('#btn-save-gh').addEventListener('click', saveGithubSettingsToStorage);
      $('#btn-load-gh').addEventListener('click', loadGithubSettingsFromStorage);
      $('#btn-clear-gh').addEventListener('click', clearGithubSettings);

      // Works ì—…ë¡œë“œ
      $('#btn-upload-work').addEventListener('click', ()=>{ handleUploadWork(); });

      // DCAR ì—…ë¡œë“œ & ëª©ë¡
      $('#btn-upload-dcar').addEventListener('click', ()=>{ handleUploadDCAR(); });
      $('#btn-refresh-dcar').addEventListener('click', ()=>{ refreshDCARList(); });

      // íƒ­
      setupTabs();

      // ì²« ì§„ì… ì‹œ localStorageì—ì„œ GitHub ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
      loadGithubSettingsFromStorage();
    });
  </script>
</body>
</html>