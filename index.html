<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE â€” Lightflow Î©.6.6</title>
<meta name="description" content="ë¹› Â· ê¸°ì–µ Â· ì¡´ì¬ â€” DUNGZAK CESTLAVIE Â· Lightflow Î©.6.6 Â· Gallery Â· Aesthetic Reports (DCAR)">
<meta property="og:title" content="DUNGZAK CESTLAVIE â€” Lightflow Î©.6.6">
<meta property="og:url" content="https://dungzak.art">
<meta name="theme-color" content="#060814">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='86'>âœ¨</text></svg>'>

<style>
:root{
  --bg:#060814;--fg:#eaf0ff;--gold:#e6c777;
  --panel:#0f1630;--line:#1b2652;--max:1180px;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  background:radial-gradient(1000px 700px at 70% -10%,#152147 0,#060814 80%);
  color:var(--fg);font:16px/1.6 'Noto Sans KR',system-ui,sans-serif;
  overflow-x:hidden;
}

/* cosmic wave canvas */
#waves{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.45;filter:blur(2px)}

/* header */
header{
  position:sticky;top:0;z-index:10;
  background:rgba(6,10,20,.85);backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:10px 12px;
}
.brand{text-align:center;font-weight:800;color:var(--gold);font-size:clamp(16px,5vw,22px)}
nav.primary{display:flex;justify-content:center;gap:10px;margin-top:6px;flex-wrap:wrap}
nav.primary a{color:var(--fg);text-decoration:none;font-weight:600;padding:6px 12px;border-radius:8px}
nav.primary a:hover,nav.primary a.active{background:linear-gradient(180deg,#f7e4a5,#e6c777);color:#0a1230}

/* language toggle */
.lang{display:flex;justify-content:center;gap:6px;margin-top:8px}
.lang button{all:unset;cursor:pointer;color:#cfe0ff;border:1px solid #2a335f;border-radius:6px;padding:4px 8px}
.lang button.active,.lang button:hover{background:#1b2348;color:var(--gold);border-color:#3a447a}

/* sections */
main{position:relative;z-index:2}
section{max-width:var(--max);margin:auto;padding:80px 16px}
h1,h2{color:var(--gold)}
h2{margin-bottom:12px}

/* poem */
.hero{text-align:center;min-height:70vh}
.hero h1{font-size:clamp(32px,6vw,64px);margin-bottom:6px}
.hero p{opacity:.85;margin-bottom:18px}
.poem p{margin-bottom:8px}

/* works grid */
.grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
@media(min-width:1024px){.grid{grid-template-columns:repeat(4,1fr)}}
.card{background:var(--panel);border:1px solid var(--line);border-radius:10px;overflow:hidden;
  transition:transform .3s,box-shadow .4s}
.card:hover{transform:translateY(-3px);box-shadow:0 0 14px rgba(230,199,119,.3)}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover;display:block}
.caption{padding:8px 10px;background:#0f1630;font-size:.83rem}
.caption div{margin-top:2px;color:#cde}
.caption .ko{color:var(--gold);font-weight:600}
.caption .en{opacity:.8}

/* accordion */
.accordion{border:1px solid #2a3a78;border-radius:10px;overflow:hidden}
.accordion-header{background:#0f1838;color:var(--gold);padding:14px;cursor:pointer}
.accordion-content{display:none;background:#0b1020;padding:14px;color:#cfe0ff}
.accordion-item.active .accordion-content{display:block}

/* floating social mini icons */
.fab{position:fixed;right:12px;bottom:calc(16px + env(safe-area-inset-bottom));
  z-index:30;display:flex;flex-direction:column;gap:8px}
.fab a{width:34px;height:34px;border-radius:50%;display:grid;place-items:center;
  background:rgba(12,19,48,.35);border:1px solid rgba(230,199,119,.35);
  font-size:16px;text-decoration:none;color:#cfe0ff}
.fab a:hover{color:#0a1230;background:linear-gradient(180deg,#f7e4a5,#e6c777)}
</style>
</head>

<body class="korean">
<canvas id="waves"></canvas>

<header>
  <div class="brand">ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· Lightflow Î©.6.6</div>
  <nav class="primary">
    <a href="#poem" class="active">Poem</a>
    <a href="#works">Works</a>
    <a href="#reports">Reports</a>
  </nav>
  <div class="lang">
    <button id="koBtn" class="active">KR</button>
    <button id="enBtn">EN</button>
    <button id="hyBtn">KR+EN</button>
  </div>
</header>

<main>
  <!-- Poem -->
  <section id="poem" class="hero">
    <div>
      <h1 class="ko">ë¹› Â· ê¸°ì–µ Â· ì¡´ì¬</h1>
      <h1 class="en" style="display:none">Light Â· Memory Â· Being</h1>
      <p class="ko">ë“±ì‘ê³¼ ë£¨ë©”ë¼ì˜ ì§€íœ˜ë¡œ â€” ë“±ì‘ DUNGZAK CESTLAVIE</p>
      <p class="en" style="display:none">Conducted by DUNGZAK and Lumera â€” DUNGZAK CESTLAVIE</p>

      <div class="poem" style="max-width:820px;margin:18px auto 0;text-align:left;background:rgba(16,22,48,.35);border:1px solid #223;border-radius:12px;padding:14px">
        <div class="poem-ko">
          <p>ì„¼ëŠê°• ë‹¤ë¦¬ ì•„ë˜, ë…¸íŠ¸ë¥´ë‹´ ì„±ë‹¹ì˜ ì´›ë¶ˆì´ ì¼œì§ˆ ë¬´ë µâ€”</p>
          <p>ì†Œë°•í•œ ê¿ˆë“¤ì„ ì•ˆê³  ì‚¬ëŠ” ì‚¬ëŒë“¤ì´ ëª¨ì—¬ ì¶¤ì¶˜ë‹¤.</p>
          <p>ë°”ì´ì˜¬ë¦°ì´ ìƒˆíŒŒë—ê³  ìƒ›ë…¸ë‘ì˜ ë¹›ì„ í©ë¿Œë¦¬ë©° ì›ƒëŠ”ë‹¤.</p>
          <p>ê¿ˆê¾¸ëŠ” ì—¬ì¸ë“¤ê³¼ ê¿ˆê¾¸ëŠ” ë‚¨ì„±ë“¤ì´ ì†ì„ ì¡ê³ ,</p>
          <p>ì‚¬ëŒì˜ í–¥ê¸°ë¥¼ ë§¡ìœ¼ë©° ì¬ë¹ ë¥¸ ìŒë¥ ì— ëª¸ì„ ë§¡ê¸´ë‹¤.</p>
          <p>ì´ˆìŠ¹ë‹¬ì€ ì–´ì—¬ìœ í•˜ì–€ ë¯¸ì†Œë¥¼ í˜ë¦¬ê³ , ì‚¬ë‘ì€ ê·¸ ë¹›ìœ¼ë¡œ íë¥¸ë‹¤.</p>
        </div>
        <div class="poem-en" style="display:none">
          <p>Beneath the bridge of the Seine, as Notre-Dameâ€™s candles begin to glowâ€”</p>
          <p>Those who live with humble dreams gather to dance.</p>
          <p>Violins scatter blue and golden lights, laughing in brilliance.</p>
          <p>Dreaming women and men clasp hands,</p>
          <p>breathe the scent of humanity, and yield to the rhythm of love.</p>
          <p>The crescent moon spills a tender smile, and love flows within its light.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Works (ì´ë¯¸ì§€ + ìº¡ì…˜. í¸ì§‘/ì •ë ¬/Import/ExportëŠ” Part 3 ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆ˜í–‰) -->
  <section id="works">
    <h2>Artworks â€” ì‘í’ˆ ì•„ì¹´ì´ë¸Œ</h2>

    <!-- ì„¹ì…˜ íƒ­ -->
    <div class="tabs" role="tablist" aria-label="Art Sections" style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:12px 0 16px">
      <button class="tab active" data-panel="pray">â…  ìš°ë¦¬ë¥¼ ìœ„í•´ ê¸°ë„í•´ ì£¼ì„¸ìš” â€” Pray for Us</button>
      <button class="tab" data-panel="human">â…¡ ì¸ê°„ â€” Human Being</button>
      <button class="tab" data-panel="rebirth">â…¢ ì •ì‹ ì˜ ì¬íƒ„ìƒ â€” Rebirth of Mind</button>
      <button class="tab" data-panel="exist">â…£ ì¡´ì¬ì˜ íšŒë³µ â€” Restoration of Being</button>
      <button class="tab" data-panel="cosmos">â…¤ ë¹›ì˜ ì´ˆì˜ì‹ â€” Metaconsciousness of Light</button>
    </div>

    <!-- ê° íŒ¨ë„ì€ Part 3ì—ì„œ ë™ì  ë Œë”ë§ -->
    <div id="panel-pray"   class="tabpanel active"></div>
    <div id="panel-human"  class="tabpanel"></div>
    <div id="panel-rebirth"class="tabpanel"></div>
    <div id="panel-exist"  class="tabpanel"></div>
    <div id="panel-cosmos" class="tabpanel"></div>

    <!-- ë©”íƒ€ë°ì´í„° ê´€ë¦¬ (ë¸Œë¼ìš°ì € ì €ì¥) -->
    <div style="margin-top:18px;text-align:center;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
      <button id="exportMeta">Export JSON</button>
      <button id="importMeta">Import JSON</button>
      <button id="clearMeta"  title="ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ì‘í’ˆ ì •ë³´ë¥¼ ì´ˆê¸°í™”">Clear (Local)</button>
    </div>

    <p class="sub" style="text-align:center;margin-top:8px;opacity:.8">
      â€¢ ë”ë¸”í´ë¦­/ë”ë¸”íƒ­ â†’ ì¹´ë“œ ë©”íƒ€ í¸ì§‘ì°½ Â· ì €ì¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜ Â· ë¸Œë¼ìš°ì €ì— ì €ì¥ë¨
    </p>
  </section>

  <!-- Reports (DCAR ì•„ì½”ë””ì–¸ ì „ìš©) -->
  <section id="reports">
    <h2>ë¯¸í•™ ë³´ê³ ì„œ (DCAR Series)</h2>
    <div class="accordion" id="dcarAcc">
      <div class="accordion-item">
        <div class="accordion-header">DCAR-01-2025 Â· ì¡´ì¬ì˜ íšŒë³µ â€” The Restoration of Being</div>
        <div class="accordion-content">ì¡´ì¬ì˜ íšŒë³µê³¼ ê°ê°ì˜ ìœ¤ë¦¬. Restoration of Being and the Ethics of Sensation.</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">DCAR-02-2025 Â· ê¸°ì–µì˜ ìœ¤ë¦¬ â€” The Ethics of Memory</div>
        <div class="accordion-content">ê¸°ì–µì˜ êµ¬ì„±ê³¼ ê³µì¡´ì˜ ì±…ì„. The Construction of Memory and Responsibility for Coexistence.</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">DCAR-03-2025 Â· ì •ì‹ ì˜ ì¬íƒ„ìƒ â€” The Rebirth of Mind</div>
        <div class="accordion-content">ì§€ê°ì˜ ì§„í™”ì™€ ì˜ì‹ì˜ í™•ì¥. Evolution of Perception and the Widening of Consciousness.</div>
      </div>
      <div class="accordion-item">
        <div class="accordion-header">DCAR-04-2025 Â· ë¹›ì˜ ìƒí” â€” The Scars of Light</div>
        <div class="accordion-content">ìƒí”ì˜ ë¯¸í•™ê³¼ ì¡´ì—„. The Aesthetics and Dignity of Scars.</div>
      </div>
    </div>
  </section>
</main>

<!-- Lightbox (ì´ë¯¸ì§€ í™•ëŒ€ + ìº¡ì…˜) -->
<div id="lightbox" aria-hidden="true" style="position:fixed;inset:0;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,.88);opacity:0;pointer-events:none;transition:.25s;z-index:20">
  <div class="frame" style="position:relative;max-width:92vw;max-height:88vh;overflow:hidden;border:2px solid var(--gold);border-radius:10px;padding:6px;background:#000">
    <img alt="Artwork view" style="display:block;max-width:100%;max-height:82vh;cursor:zoom-in">
  </div>
  <div class="lb-cap" id="lbCap"></div>
</div>

<!-- Floating mini social (ì‘ì€ ì›í˜• ì•„ì´ì½˜) -->
<div class="fab" id="socialFab" aria-label="quick social">
  <a href="https://flickr.com/photos/dungzak" target="_blank" rel="noopener" title="Flickr">ğŸ“¸</a>
  <a href="https://instagram.com/dungzakcestlavie" target="_blank" rel="noopener" title="Instagram">ğŸ“·</a>
  <a href="https://youtube.com/@dungzakcestlavie" target="_blank" rel="noopener" title="YouTube">â–¶ï¸</a>
  <a href="https://naver.me/x95dk3l1" target="_blank" rel="noopener" title="Naver Info">ğŸ§­</a>
  <a href="mailto:dungzakcestlavie@gmail.com" title="Email">âœ‰ï¸</a>
</div>

<!-- Cosmic Resonance controls (ì‘ì€ ì¤‘ì•™ í•˜ë‹¨ ë²„íŠ¼) -->
<div id="ctrl" style="position:fixed;left:50%;transform:translateX(-50%);bottom:calc(70px + env(safe-area-inset-bottom));display:flex;gap:8px;z-index:25">
  <button id="soundBtn" title="Play Prayer Resonance" style="width:36px;height:36px;border-radius:50%;border:1px solid rgba(230,199,119,.4);background:rgba(12,19,48,.45);color:#fff">âœ¨</button>
  <button id="soundStopBtn" title="Stop" disabled style="width:36px;height:36px;border-radius:50%;border:1px solid rgba(230,199,119,.4);background:rgba(12,19,48,.45);color:#fff">ğŸ”‡</button>
</div>

<footer style="border-top:1px solid rgba(255,255,255,.08);text-align:center;padding:48px 12px 96px;background:#090f22;margin-top:30px">
  <div class="links" style="display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-bottom:10px">
    <a href="#poem">â†‘ Poem</a>
    <a href="#works">Works</a>
    <a href="#reports">Reports</a>
  </div>
  <small class="ko">Â© 2025 ë“±ì‘ ç‡ˆé…Œ DUNGZAK CESTLAVIE Â· ë“±ì‘ê³¼ ë£¨ë©”ë¼ì˜ ì§€íœ˜ë¡œ</small>
  <small class="en" style="display:none">Â© 2025 DUNGZAK CESTLAVIE Â· Conducted by DUNGZAK and Lumera</small>
</footer>

<script>
/* =========================
   Lightflow Î©.6.x â€” Core JS
   ========================= */
(function(){
  /* ---------- ìœ í‹¸ & ìƒíƒœ ---------- */
  const $  = (s,sc)=> (sc||document).querySelector(s);
  const $$ = (s,sc)=> Array.from((sc||document).querySelectorAll(s));
  const store = {
    get(k,def=null){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):def; }catch{ return def; } },
    set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
  };
  // ìŠ¤í¬ë¡¤ ë³´ì¥ (ì¼ë¶€ ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì—ì„œ overflow ìš”ì¸ ë°©ì§€)
  document.documentElement.style.overflowY = 'auto';
  document.body.style.overflowY = 'auto';

  /* ---------- ë‚´ë¹„ê²Œì´ì…˜: ì„¹ì…˜ ì „í™˜ ---------- */
  function showSection(id){
    $$('#poem,#works,#reports').forEach(s=>{ s.style.display = (s.id===id)?'block':'none'; });
    $$('.primary button').forEach(b=> b.classList.toggle('active', b.dataset.target===id));
    // ì•µì»¤ í¬ì»¤ìŠ¤
    const sec = document.getElementById(id);
    if(sec){ sec.setAttribute('tabindex','-1'); sec.focus({preventScroll:true}); sec.removeAttribute('tabindex'); }
  }
  $$('.primary button').forEach(b=> b.addEventListener('click', ()=> showSection(b.dataset.target)));
  // ìµœì´ˆ ì§„ì…: í•´ì‹œ ìš°ì„  â†’ ê¸°ë³¸ poem
  showSection(location.hash ? location.hash.replace('#','') : 'poem');
  window.addEventListener('hashchange', ()=> showSection(location.hash.replace('#','')) );

  /* ---------- ì–¸ì–´ í† ê¸€ ---------- */
  const koBtn = $('#koBtn'), enBtn = $('#enBtn'), hyBtn = $('#hyBtn');
  function setLang(lang){
    document.body.classList.remove('korean','english','hybrid');
    if(lang==='ko') document.body.classList.add('korean');
    else if(lang==='en') document.body.classList.add('english');
    else document.body.classList.add('hybrid');
    [koBtn,enBtn,hyBtn].forEach(b=> b && b.classList.remove('active'));
    ({ko:koBtn,en:enBtn,hy:hyBtn}[lang])?.classList.add('active');
    store.set('dz_lang', lang);
    // ìº¡ì…˜ ì¦‰ì‹œ ë¦¬ë Œë” (ë³´ì´ëŠ” íŒ¨ë„ë§Œ)
    const activeTab = $('.tabs .tab.active');
    if(activeTab) renderPanel(activeTab.dataset.panel);
  }
  koBtn?.addEventListener('click', ()=> setLang('ko'));
  enBtn?.addEventListener('click', ()=> setLang('en'));
  hyBtn?.addEventListener('click', ()=> setLang('hy'));
  setLang(store.get('dz_lang','ko'));

  /* ---------- ë°°ê²½: ì€ì€í•˜ì§€ë§Œ ì„ ëª…í•œ ìš°ì£¼ íŒŒë™ ---------- */
  try{
    const waves = $('#waves')?.getContext('2d', {alpha:true});
    const trail = $('#trail')?.getContext('2d', {alpha:true});
    if(waves && trail){
      let DPR=1, W=0, H=0, t=0, visible=true;
      let px=innerWidth/2, py=innerHeight/2, tx=px, ty=py;
      const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;

      function resize(){
        DPR = Math.max(1, Math.min(2, devicePixelRatio||1));
        W = waves.canvas.width  = Math.floor(innerWidth  * DPR);
        H = waves.canvas.height = Math.floor(innerHeight * DPR);
        trail.canvas.width = W; trail.canvas.height = H;
        waves.setTransform(1,0,0,1,0,0); trail.setTransform(1,0,0,1,0,0);
        waves.scale(1/DPR,1/DPR); trail.scale(1/DPR,1/DPR);
      }
      resize(); addEventListener('resize', resize, {passive:true});
      document.addEventListener('visibilitychange', ()=> visible = !document.hidden );
      addEventListener('mousemove', e=>{tx=e.clientX; ty=e.clientY;}, {passive:true});
      addEventListener('touchmove', e=>{const p=e.touches[0]; tx=p.clientX; ty=p.clientY;}, {passive:true});

      const ease = x=> x*x*(3-2*x);
      function waveLaneY(x,k){
        const f1=0.0030+k*0.0007, f2=0.0060+k*0.0006;
        const a1=26+k*12, a2=14+k*8;
        const drift=t*(0.75+k*0.15);
        const base=innerHeight*0.30 + k*108 + Math.sin(t*0.5+k)*12;
        const curve = 0.9 + ease(x/innerWidth)*0.2;
        return base + Math.sin(x*f1+drift*1.1+Math.sin(drift*0.7+k)*.25)*a1*curve
                    + Math.sin(x*f2+drift*.85)*a2;
      }
      function drawWaves(){
        waves.clearRect(0,0,innerWidth,innerHeight);
        const lanes = prefersReduced?2:4;
        const hueBase = 210 + Math.sin(t*0.05)*15;
        for(let k=0;k<lanes;k++){
          waves.beginPath();
          for(let x=0;x<=innerWidth;x+=6){
            const y = waveLaneY(x,k);
            x?waves.lineTo(x,y):waves.moveTo(x,y);
          }
          const y0 = waveLaneY(0,k);
          const g = waves.createLinearGradient(0,y0-140,0,y0+140);
          const hue = (hueBase + k*12) % 360;
          g.addColorStop(0, `hsla(${hue},65%,70%,.10)`);
          g.addColorStop(.5, `hsla(45,70%,68%,.28)`);   // ê³¨ë“œ
          g.addColorStop(1, `hsla(${(hue+60)%360},60%,60%,.10)`);
          waves.strokeStyle = g;
          waves.lineWidth = 1.15 + k*0.45;
          waves.globalAlpha = 0.88 - k*0.12;
          waves.shadowBlur = 16; waves.shadowColor = 'rgba(160,200,255,.18)';
          waves.stroke();
        }
        waves.globalAlpha=1; waves.shadowBlur=0;
      }
      function drawTrail(){
        // ë§ˆìš°ìŠ¤/í„°ì¹˜ ë¶€ë“œëŸ¬ìš´ ê¸€ë¡œìš°
        px += (tx-px)*(prefersReduced?0.10:0.15);
        py += (ty-py)*(prefersReduced?0.10:0.15);
        const speed = Math.hypot(tx-px, ty-py);
        const r = 96 + Math.min(speed*160, 240);
        trail.fillStyle = 'rgba(0,0,0,.12)';
        trail.fillRect(0,0,innerWidth,innerHeight);
        const g = trail.createRadialGradient(px,py,0, px,py,r);
        g.addColorStop(0, 'rgba(230,199,119,.24)');
        g.addColorStop(.55,'rgba(140,185,255,.14)');
        g.addColorStop(1, 'rgba(140,185,255,0)');
        trail.fillStyle = g; trail.beginPath(); trail.arc(px,py,r,0,Math.PI*2); trail.fill();
      }
      (function loop(){
        if(visible){
          t += prefersReduced?0.003:0.008;
          drawWaves();
          if(!prefersReduced) drawTrail();
        }
        requestAnimationFrame(loop);
      })();
    }
  }catch(e){ console.warn('waves error', e); }

  /* ---------- Works: ë Œë” + Lazy + í¸ì§‘ + Import/Export ---------- */
  const SECTIONS = [
    { key:'pray',   title:'Pray for Us' },
    { key:'human',  title:'Human Being' },
    { key:'rebirth',title:'Rebirth of Mind' },
    { key:'exist',  title:'Restoration of Being' },
    { key:'cosmos', title:'Metaconsciousness of Light' }
  ];
  // ë©”íƒ€ êµ¬ì¡°: { [secKey]: { [id]: {title_ko,title_en,material,size,year} } }
  let META = store.get('works_meta', {});

  function cardHTML(secKey, secTitle, i){
    const m = META[secKey]?.[i] || {};
    const tko = m.title_ko || `ì‘í’ˆ ${i}`;
    const ten = m.title_en || `${secTitle} ${i}`;
    const mat = m.material || '';
    const sz  = m.size || '';
    const yr  = m.year || '';
    const info = [mat, sz, yr].filter(Boolean).join(' Â· ');
    // ì–¸ì–´ë³„ ìº¡ì…˜ êµ¬ì„±
    const lang = (document.body.classList.contains('korean') && 'ko') ||
                 (document.body.classList.contains('english') && 'en') || 'hy';
    let cap = '';
    if(lang==='ko') cap = `<strong>${tko}</strong>${info?`<br>${info}`:''}`;
    else if(lang==='en') cap = `<strong>${ten}</strong>${info?`<br>${info}`:''}`;
    else cap = `<strong>${tko}</strong><br><em>${ten}</em>${info?`<br>${info}`:''}`;

    // data-src ë¡œ ë ˆì´ì§€
    return `
    <article class="card" tabindex="0" data-sec="${secKey}" data-id="${i}">
      <img loading="lazy" data-src="works/${secKey}/${i}.jpg" alt="${tko}">
      <div class="caption">${cap}</div>
    </article>`;
  }

  function renderPanel(secKey){
    const sec = SECTIONS.find(s=>s.key===secKey);
    const host = document.getElementById('panel-'+secKey);
    if(!host) return;
    // 1~20 ê¸°ë³¸ ìŠ¬ë¡¯ (ì›í•˜ë©´ ê°œìˆ˜ ì¡°ì ˆ ê°€ëŠ¥)
    const N = 20;
    host.innerHTML = `<div class="grid">${
      Array.from({length:N}, (_,k)=>cardHTML(sec.key, sec.title, k+1)).join('')
    }</div>`;
    // lazy + í˜ì´ë“œ
    try{
      const io=new IntersectionObserver(entries=>{
        entries.forEach(ent=>{
          if(ent.isIntersecting){
            const img=ent.target;
            if(img.dataset.src){ img.src=img.dataset.src; img.removeAttribute('data-src'); }
            img.closest('.card')?.classList.add('visible');
            io.unobserve(img);
          }
        });
      }, {rootMargin:'200px'});
      $$('#panel-'+secKey+' img[loading][data-src]').forEach(img=> io.observe(img));
    }catch{}
  }
  // ìµœì´ˆ ë Œë”
  SECTIONS.forEach(s=> renderPanel(s.key));

  // íƒ­ ì „í™˜
  $$('.tabs .tab').forEach(tab=>{
    tab.addEventListener('click', ()=>{
      $$('.tabs .tab').forEach(x=>x.classList.remove('active'));
      tab.classList.add('active');
      $$('.tabpanel').forEach(x=>x.classList.remove('active'));
      $('#panel-'+tab.dataset.panel)?.classList.add('active');
      renderPanel(tab.dataset.panel); // ì–¸ì–´ ë³€ê²½ í›„ ì¬ì¶œë ¥ ì¼ê´€ì„±
      // ìŠ¤í¬ë¡¤ ì—¬ìœ 
      window.scrollTo({top: $('#panel-'+tab.dataset.panel).offsetTop-80, behavior:'smooth'});
    });
  });

  // ë”ë¸”í´ë¦­/ë”ë¸”íƒ­ â†’ ë©”íƒ€ í¸ì§‘
  document.body.addEventListener('dblclick', e=>{
    const card = e.target.closest('.card');
    if(!card) return;
    openMetaEditor(card.dataset.sec, card.dataset.id);
  });
  document.body.addEventListener('touchend', (e)=>{
    // ê°„ë‹¨ ë”ë¸”íƒ­ ê°ì§€
    const now = performance.now();
    if(document._lastTap && (now - document._lastTap) < 300){
      const card = e.target.closest('.card');
      if(card) openMetaEditor(card.dataset.sec, card.dataset.id);
    }
    document._lastTap = now;
  }, {passive:true});

  function openMetaEditor(secKey, id){
    const m = (META[secKey] && META[secKey][id]) || {};
    const wrap = document.createElement('div');
    wrap.style.cssText = 'position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center';
    wrap.innerHTML = `
      <div style="background:#0f1630;color:#e9efff;width:92vw;max-width:520px;border:1px solid #2a3a78;border-radius:12px;padding:16px">
        <h3 style="margin-bottom:8px">ì‘í’ˆ ì •ë³´ ìˆ˜ì • â€” ${secKey} / ${id}</h3>
        <div style="display:grid;gap:8px">
          <label>ì œëª©(KR)<br><input id="tk" style="width:100%" value="${m.title_ko||''}"></label>
          <label>Title(EN)<br><input id="te" style="width:100%" value="${m.title_en||''}"></label>
          <label>ì¬ë£Œ(Material)<br><input id="mat" style="width:100%" value="${m.material||''}"></label>
          <label>í¬ê¸°(Size)<br><input id="sz" style="width:100%" value="${m.size||''}"></label>
          <label>ì—°ë„(Year)<br><input id="yr" style="width:100%" value="${m.year||''}"></label>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button id="del" style="background:#3b2240;color:#fff;border:1px solid #5a3a6d;padding:6px 10px;border-radius:8px">Delete</button>
          <button id="cancel" style="background:#1b2548;color:#fff;border:1px solid #2a3a78;padding:6px 10px;border-radius:8px">Cancel</button>
          <button id="save" style="background:#d6b868;color:#0a1230;border:1px solid #d6b868;padding:6px 10px;border-radius:8px;font-weight:700">Save</button>
        </div>
      </div>
    `;
    document.body.appendChild(wrap);
    wrap.querySelector('#cancel').onclick = ()=> wrap.remove();
    wrap.querySelector('#del').onclick = ()=>{
      if(confirm('ì´ ì¹´ë“œì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')){
        if(META[secKey]) delete META[secKey][id];
        store.set('works_meta', META);
        renderPanel(secKey);
        wrap.remove();
      }
    };
    wrap.querySelector('#save').onclick = ()=>{
      META[secKey] = META[secKey] || {};
      META[secKey][id] = {
        title_ko: wrap.querySelector('#tk').value.trim(),
        title_en: wrap.querySelector('#te').value.trim(),
        material: wrap.querySelector('#mat').value.trim(),
        size:     wrap.querySelector('#sz').value.trim(),
        year:     wrap.querySelector('#yr').value.trim()
      };
      store.set('works_meta', META);
      renderPanel(secKey);
      wrap.remove();
    };
  }

  // Export / Import / Clear
  $('#exportMeta')?.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(META, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'works-metadata.json';
    a.click();
    URL.revokeObjectURL(a.href);
  });
  $('#importMeta')?.addEventListener('click', ()=>{
    const inp = document.createElement('input');
    inp.type = 'file'; inp.accept = '.json,application/json';
    inp.onchange = e=>{
      const f = e.target.files?.[0]; if(!f) return;
      const r = new FileReader();
      r.onload = ()=>{
        try{
          const obj = JSON.parse(r.result);
          META = obj || {};
          store.set('works_meta', META);
          // ëª¨ë“  íŒ¨ë„ ê°±ì‹ 
          SECTIONS.forEach(s=> renderPanel(s.key));
          alert('ë©”íƒ€ë°ì´í„°ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }catch(err){ alert('JSON íŒŒì‹± ì˜¤ë¥˜'); }
      };
      r.readAsText(f, 'utf-8');
    };
    inp.click();
  });
  $('#clearMeta')?.addEventListener('click', ()=>{
    if(confirm('ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ì‘í’ˆ ë©”íƒ€ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?')){
      META = {};
      store.set('works_meta', META);
      SECTIONS.forEach(s=> renderPanel(s.key));
    }
  });

  /* ---------- Reports: ì•„ì½”ë””ì–¸ ---------- */
  $$('#dcarAcc .accordion-header').forEach(h=>{
    h.addEventListener('click', ()=> h.parentElement.classList.toggle('active'));
  });

  /* ---------- ë¼ì´íŠ¸ë°•ìŠ¤ (ì¤Œ/ë“œë˜ê·¸) ---------- */
  (function(){
    const lb = $('#lightbox');
    if(!lb) return;
    const img = lb.querySelector('img');
    const cap = $('#lbCap');
    let zoom=1, ox=0, oy=0, sx=0, sy=0, dragging=false;

    document.body.addEventListener('click', e=>{
      const card = e.target.closest('.card');
      if(!card) return;
      const src = card.querySelector('img')?.getAttribute('src') || card.querySelector('img')?.dataset.src;
      if(!src) return;
      img.src = src;
      cap.textContent = card.querySelector('.caption')?.innerText || '';
      lb.style.opacity = '1'; lb.style.pointerEvents='auto'; lb.setAttribute('aria-hidden','false');
      zoom=1; ox=oy=0; img.style.transform='translate(0px,0px) scale(1)';
    });

    lb.addEventListener('click', e=>{
      if(e.target===lb){
        lb.style.opacity = '0'; lb.style.pointerEvents='none'; lb.setAttribute('aria-hidden','true');
      }
    });

    img.addEventListener('click', ()=>{
      if(zoom===1){ zoom=2; img.style.cursor='grab'; }
      else { zoom=1; ox=oy=0; img.style.cursor='zoom-in'; }
      apply();
    });

    img.addEventListener('mousedown', e=>{
      if(zoom===1) return;
      dragging=true; sx=e.clientX-ox; sy=e.clientY-oy; img.style.cursor='grabbing';
    });
    window.addEventListener('mousemove', e=>{
      if(!dragging) return; ox=e.clientX-sx; oy=e.clientY-sy; apply();
    });
    window.addEventListener('mouseup', ()=>{ dragging=false; if(zoom>1) img.style.cursor='grab'; });

    function apply(){ img.style.transform = `translate(${ox}px,${oy}px) scale(${zoom})`; }
  })();

  /* ---------- ê³µëª…ìŒ (Prayer Resonance) ---------- */
  (function(){
    const playBtn = $('#soundBtn'), stopBtn = $('#soundStopBtn');
    if(!playBtn || !stopBtn) return;

    let ac=null, nodes=null, on=false;

    async function ensureAC(){
      if(!ac){
        const Ctx = window.AudioContext || window.webkitAudioContext;
        ac = new Ctx({latencyHint:'interactive'});
      }
      if(ac.state==='suspended') await ac.resume();
      return ac;
    }
    // iOS Unlock: ì²« íƒ­ì—ì„œ resume
    const unlock = async()=>{ try{ await ensureAC(); }catch{} window.removeEventListener('touchend', unlock); window.removeEventListener('click', unlock); };
    window.addEventListener('touchend', unlock, {once:true});
    window.addEventListener('click',    unlock, {once:true});

    function G(v){ const g=ac.createGain(); g.gain.value=v; return g; }
    function O(type,f){ const o=ac.createOscillator(); o.type=type; o.frequency.value=f; return o; }

    async function start(){
      if(on) return;
      await ensureAC();

      // ì €ì£¼íŒŒ(ìŠˆë§Œ/ì„¸íƒ€)ë¡œ ì²œì²œíˆ ê²Œì¸ ë³€ì¡° + ë¶€ë“œëŸ¬ìš´ ì €ë² ì´ìŠ¤
      const base = G(0.12), sub=G(0.05), mid=G(0.05), shim=G(0.010);
      const low  = O('sine', 62);      // ì €ë² ì´ìŠ¤
      const low2 = O('sine', 124);     // ì˜¥íƒ€ë¸Œ
      const floor= O('sine', 31);      // ì•„ì£¼ ë‚®ì€ ë°”ë‹¥
      const ch1  = O('sine', 432);     // ë¯¸ì„¸ ë°˜ì§ì„
      const ch2  = O('sine', 528);     // ë¯¸ì„¸ ë°˜ì§ì„

      const lfo1 = O('sine', 7.83);    // ìŠˆë§Œ
      const lfo2 = O('sine', 5.0);     // Î¸

      // ë¼ìš°íŒ…
      const lpg = G(0.07), lpg2=G(0.05); // LFO â†’ ê²Œì¸ ë³€ì¡° ê¹Šì´
      lfo1.connect(lpg).connect(base.gain);
      lfo2.connect(lpg2).connect(base.gain);

      const lp = ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=900; lp.Q.value=0.8;
      const bp = ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=120; bp.Q.value=0.7;

      low.connect(base).connect(bp).connect(lp);
      low2.connect(mid).connect(bp);
      floor.connect(sub).connect(bp);
      ch1.connect(shim).connect(lp);
      ch2.connect(shim).connect(lp);

      lp.connect(ac.destination);
      bp.connect(ac.destination);

      [low,low2,floor,ch1,ch2,lfo1,lfo2].forEach(x=>x.start());

      // í˜ì´ë“œ ì¸
      [base.gain,sub.gain,mid.gain,shim.gain].forEach(g=>{
        const target=g.value; try{
          g.setValueAtTime(Math.max(0.0001, target*0.001), ac.currentTime);
          g.exponentialRampToValueAtTime(target, ac.currentTime+1.2);
        }catch{}
      });

      nodes = {low,low2,floor,ch1,ch2,lfo1,lfo2,base,sub,mid,shim,lp,bp};
      on=true; playBtn.disabled=true; stopBtn.disabled=false;
    }

    function stop(){
      if(!on || !nodes || !ac) return;
      const {low,low2,floor,ch1,ch2,lfo1,lfo2,base,sub,mid,shim,lp} = nodes;
      const t = ac.currentTime;
      [base.gain,sub.gain,mid.gain,shim.gain].forEach(g=>{
        try{ g.cancelScheduledValues(0); g.exponentialRampToValueAtTime(0.0001, t+1.8);}catch{}
      });
      try{ lp.frequency.linearRampToValueAtTime(120, t+1.8); }catch{}
      setTimeout(()=>{ [low,low2,floor,ch1,ch2,lfo1,lfo2].forEach(o=>{try{o.stop()}catch{}}); nodes=null; }, 1900);
      on=false; playBtn.disabled=false; stopBtn.disabled=true;
    }

    playBtn.addEventListener('click', start);
    stopBtn.addEventListener('click', stop);
    document.addEventListener('visibilitychange', async()=>{
      if(!ac) return;
      if(document.hidden) try{ await ac.suspend(); }catch{}
      else if(on) try{ await ac.resume(); }catch{}
    });
  })();

  /* ---------- ë¯¸ë‹ˆ ì†Œì…œ FAB ìœ„ì¹˜/ìŠ¤íƒ€ì¼ ë³´ê°•(ìŠ¤í¬ë¡¤ ê²¹ì¹¨ ë°©ì§€) ---------- */
  (function(){
    const fab = $('#socialFab');
    if(!fab) return;
    fab.style.position = 'fixed';
    fab.style.right = '12px';
    fab.style.bottom = 'calc(100px + env(safe-area-inset-bottom))';
    fab.style.display = 'flex';
    fab.style.flexDirection = 'column';
    fab.style.gap = '8px';
    fab.style.zIndex = '24';
    // ì•„ì´ì½˜ ìµœì†Œ ìŠ¤íƒ€ì¼
    fab.querySelectorAll('a').forEach(a=>{
      a.style.width='34px'; a.style.height='34px'; a.style.display='grid';
      a.style.placeItems='center'; a.style.borderRadius='50%';
      a.style.background='rgba(12,19,48,.45)';
      a.style.border='1px solid rgba(230,199,119,.35)';
      a.style.backdropFilter='blur(6px)';
      a.style.textDecoration='none'; a.style.fontSize='16px';
    });
  })();

  /* ---------- ë³´ì •: í‚¤ë³´ë“œ í¬ì»¤ìŠ¤ ì‹œ ìŠ¤í¬ë¡¤ ë§‰í˜ ë°©ì§€ ---------- */
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape'){
      const lb = $('#lightbox');
      if(lb && lb.style.pointerEvents==='auto'){
        lb.style.opacity='0'; lb.style.pointerEvents='none'; lb.setAttribute('aria-hidden','true');
      }
    }
  });

})();
</script>